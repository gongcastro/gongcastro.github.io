<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="Gonzalo Garcia-Castro">
<meta name="description" content="TL;DR: He creado un bot de Twitter que hace RT a cualquier menci√≥n a #psicotuiter. El c√≥digo est√° escrito en R usando el paquete {rtweet} para interactuar con la API de Twitter, y est√° alojado en una Raspberry Pi que ejecuta el c√≥digo cada 15 usando CRON, haciendo las veces de servidor.
Follow @psicotuiterbotEste es el timeline de [@psicotuiterbot](https://twitter.com/psicotuiterbot):
Tweets by psicotuiterbotLa comunidad de PsicotuiterPsicotuiter (aka." />
<meta name="keywords" content=", r, twitter" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="#fcba03" />
<link rel="canonical" href="http://gongcastro.github.io/2021/12/29/psicotuiterbot-un-bot-de-twitter-para-psicotuiter/" />


    <title>
        
            @psicotuiterbot: Un bot de Twitter para Psicotuiter :: Gonzalo Garc√≠a-Castro  ‚Äî Developmental sycholinguistics and R
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="/main.6fc0dda7eae4695eb0cc3ae224c0caa1661a01707aa87efdcae0334f7af73ef4.css">


    
        <link rel="stylesheet" type="text/css" href="/css/custom.css">
    





<meta itemprop="name" content="@psicotuiterbot: Un bot de Twitter para Psicotuiter">
<meta itemprop="description" content="TL;DR: He creado un bot de Twitter que hace RT a cualquier menci√≥n a #psicotuiter. El c√≥digo est√° escrito en R usando el paquete {rtweet} para interactuar con la API de Twitter, y est√° alojado en una Raspberry Pi que ejecuta el c√≥digo cada 15 usando CRON, haciendo las veces de servidor.
Follow @psicotuiterbotEste es el timeline de [@psicotuiterbot](https://twitter.com/psicotuiterbot):
Tweets by psicotuiterbotLa comunidad de PsicotuiterPsicotuiter (aka.">
<meta itemprop="datePublished" content="2021-12-29T00:00:00+00:00" />
<meta itemprop="dateModified" content="2021-12-30T12:48:32+01:00" />
<meta itemprop="wordCount" content="2475">



<meta itemprop="keywords" content="r,twitter," />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="@psicotuiterbot: Un bot de Twitter para Psicotuiter"/>
<meta name="twitter:description" content="TL;DR: He creado un bot de Twitter que hace RT a cualquier menci√≥n a #psicotuiter. El c√≥digo est√° escrito en R usando el paquete {rtweet} para interactuar con la API de Twitter, y est√° alojado en una Raspberry Pi que ejecuta el c√≥digo cada 15 usando CRON, haciendo las veces de servidor.
Follow @psicotuiterbotEste es el timeline de [@psicotuiterbot](https://twitter.com/psicotuiterbot):
Tweets by psicotuiterbotLa comunidad de PsicotuiterPsicotuiter (aka."/>






    <meta property="article:section" content="r" />



    <meta property="article:published_time" content="2021-12-29 00:00:00 &#43;0000 UTC" />










<link rel="stylesheet" href="http://gongcastro.github.io/css/github-dark.min.css" rel="stylesheet" id="theme-stylesheet">
<script src="http://gongcastro.github.io/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">$ cd /gongcastro/</span>
            <span class="logo__cursor" style=
                  "
                   background-color:lightsalmon;
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/post/">Posts</a></li><li><a href="/cv/">CV</a></li><li><a href="/about/">About</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="http://gongcastro.github.io/2021/12/29/psicotuiterbot-un-bot-de-twitter-para-psicotuiter/">@psicotuiterbot: Un bot de Twitter para Psicotuiter</a></h2>

            
            
            

            <div class="post-content">
                
<script src="http://gongcastro.github.io/2021/12/29/psicotuiterbot-un-bot-de-twitter-para-psicotuiter/index_files/header-attrs/header-attrs.js"></script>


<blockquote>
<p><strong>TL;DR</strong>: He creado un bot de Twitter que hace RT a cualquier menci√≥n a #psicotuiter. El c√≥digo est√° escrito en R usando el paquete {rtweet} para interactuar con la API de Twitter, y est√° alojado en una Raspberry Pi que ejecuta el c√≥digo cada 15 usando CRON, haciendo las veces de servidor.</p>
</blockquote>
<a href="https://twitter.com/psicotuiterbot?ref_src=twsrc%5Etfw" class="twitter-follow-button" data-size="large" data-lang="es" data-show-count="false">Follow <span class="citation">@psicotuiterbot</span></a>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>Este es el timeline de <span class="citation">[@psicotuiterbot]</span>(<a href="https://twitter.com/psicotuiterbot" class="uri">https://twitter.com/psicotuiterbot</a>):</p>
<a class="twitter-timeline" href="https://twitter.com/psicotuiterbot?ref_src=twsrc%5Etfw">Tweets by psicotuiterbot</a>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<div id="la-comunidad-de-psicotuiter" class="section level1">
<h1>La comunidad de Psicotuiter</h1>
<p><strong>Psicotuiter</strong> (aka. Psicotwitter) es una comunidad de perfiles de Twitter que hablan de Psicolog√≠a (entre otras cosas) en Twitter. No se trata de un grupo cerrado, sino de una etiqueta √∫til para mencionar a esta comunidad. Aunque sus l√≠mites son algo difusos (y ser√≠a absolutamente innecesario precisarlos), se podr√≠a considerar que esta comunidad existe de manera relativamente formal desde 2015 (aproximadamente).</p>
</div>
<div id="por-qu√©-un-bot" class="section level1">
<h1>Por qu√© un bot</h1>
<p>Uno de los problemas que muchas personas de esta comunidad verbalizaba durante los √∫ltimos meses (aunque probablemente se trate de un fen√≥meno c√≠clico) es <strong>lo f√°cilmente que un debate acalorado o incluso irrespetuoso entre dos personas o grupos de personas pod√≠a afecta al clima general de la comunidad</strong>. Independientemente de la legitimidad de la discusi√≥n en curso, no es ideal que la experiencia en Twitter de una persona promedio en el d√≠a a d√≠a sea dependiente de un n√∫mero de interacciones tan reducidas. Alicia Franco hizo es su momento una encuesta capturando el <strong>clima general de Psicotuiter</strong> en su momento (los resultados est√°n disponibles tambi√©n en un paquete de R que desarrollamos, llamado <a href="https://gongcastro.github.io/2021/11/14/creando-un-paquete-de-r-una-guia-informal-i/">{psicotuiteR}</a>, disponible en <a href="https://github.com/gongcastro/psicotuiteR">GitHub</a>):</p>
<blockquote class="twitter-tweet">
<p lang="es" dir="ltr">
¬°Hola, hola!üåø <br>¬øOs acord√°is del cuestionario que hicimos sobre ‚ÄúClima en (Psico)Twitter‚Äù?<br>üëá¬°Pues ya tenemos los resultados!üëá <a href="https://t.co/RbDM78LA0k">pic.twitter.com/RbDM78LA0k</a>
</p>
‚Äî Ali ‚òªÔ∏é (<span class="citation">@AliciaFrancoXVE</span>) <a href="https://twitter.com/AliciaFrancoXVE/status/1352342172750786560?ref_src=twsrc%5Etfw">January 21, 2021</a>
</blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>Mi opini√≥n y la de m√°s personas (aun no hemos mirado los datos, pero en alg√∫n momento nos gustar√≠a hacerlo), es que <strong>la estructura de esta comunidad est√° muy centralizada</strong>: muchas personas con relativamente pocos seguidores (0-400) siguen a unas pocas personas con relativamente muchos seguidores (5.000-20.000). Esto convertir√≠a a las segundas en poseedoras de una parte substancial del espacio de la comunidad. Recientemente hice un peque√±o hilo ampliando esta reflexi√≥n:</p>
<blockquote class="twitter-tweet">
<p lang="es" dir="ltr">
Yo tengo una experiencia parecida a la de <a href="https://twitter.com/IreneFPinto?ref_src=twsrc%5Etfw"><span class="citation">@IreneFPinto</span></a>. Mi TL es el mejor y recibo much√≠simo apoyo de la gente buena de aqu√≠. Pero esa es <em>mi</em> experiencia.<br><br>Ahora bien, tengo una peque√±a reflexi√≥n sobre la estructura de <a href="https://twitter.com/hashtag/psicotuiter?src=hash&amp;ref_src=twsrc%5Etfw">#psicotuiter</a> (importantes las aclaraciones al final): üßµ <a href="https://t.co/G77h8YRQdZ">https://t.co/G77h8YRQdZ</a>
</p>
‚Äî Gon Garc√≠a-Castro (<span class="citation">@gongcastro</span>) <a href="https://twitter.com/gongcastro/status/1472157574522888192?ref_src=twsrc%5Etfw">December 18, 2021</a>
</blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>Una de las consecuencias inmediatas de esto es que el contenido del timeline (TL) de la mayor√≠a de Psicotuiter depender√≠a de las <strong>interacciones entre un peque√±o grupo de personas con muchos seguidores</strong>. Teniendo en cuenta que las interacciones negativas tienden a extenderse m√°s r√°pido y llevarse m√°s atenci√≥n que las positivas o neutras (ej. <a href="https://psyarxiv.com/2er67/">Bellovary et al., 2021</a>), el impacto de la estructura centralizada de la comunidad sobre el clima del TL de la persona promedio en Psicotuiter es importante.</p>
<p>Otra consecuencia posiblemente menos comentada, y sin embargo m√°s importante en mi opini√≥n, es que para la persona promedio tambi√©n <strong>es m√°s dif√≠cil acceder a al resto de la comunidad</strong> (es decir, a conocer e interactuar con otras cuentas) si no es a trav√©s de la mediaci√≥n de cuentas m√°s grandes que amplifiquen sus mensajes y los hagan llegar a otras cuentas peque√±as que tambi√©n les siguen. Creo que esto puede ser frustrante si utilizas Twitter no s√≥lo para leer contenido sino tambi√©n para generarlo o extender tus redes de apoyo (muy importantes en muchos casos).</p>
<p>A principios de Octubre de 2021 se me ocurri√≥ posible forma de <strong>reducir el peso de las cuentas grandes sobre c√≥mo se distribuyen las interacciones en Psicotuiter</strong>: un <strong>bot que amplifica todos los mensajes potencialmente relevantes para la comunidad</strong>, sin atender al n√∫mero de seguidores de la cuenta que lo ha escrito, ni a qu√© otras cuentas siguien a esa cuenta. Esto, en combinaci√≥n con que una parte relevante de Psicotuiter siga al bot, podr√≠a permitir que cuentas peque√±as accedan a una comunidad m√°s grande sin mediaci√≥n de otras cuentas.</p>
</div>
<div id="creando-el-bot" class="section level1">
<h1>Creando el bot</h1>
<div id="escribiendo-el-c√≥digo" class="section level2">
<h2>Escribiendo el c√≥digo</h2>
<p>Un bot de Twitter no es m√°s que un <strong>c√≥digo que se ejecuta autom√°ticamente de forma peri√≥dica</strong> (ej., cada 15 minutos) y realiza una acci√≥n en Twitter a trav√©s de una cuenta (hacer un RT o responder a un tweet). Para poder realizar esta acci√≥n a trav√©s del c√≥digo, es necesario tener acceso a la <strong><a href="https://developer.twitter.com/en/portal/dashboard">API de Twitter</a></strong>. API es un acr√≥nimo para <em>Application Programming Interface</em> y como dice su nombre, es una plataforma desde la que podemos interactuar con una aplicaci√≥n (en este caso Twitter) a trav√©s de programaci√≥n con una serie de comandos que el equipo que ha dise√±ado la API ha definido.</p>
<p>Nunca hab√≠a hecho un bot de Twitter, pero sab√≠a de la existencia de bastantes tutoriales para hacerlo. La mayor√≠a de los bots de Twitter (y por tanto de los tutoriales) est√°n escritos en Python y JavaScript, pero yo me encuentro algo m√°s c√≥modo con R. Adem√°s gran parte de Psicotuiter (especialmente quienes est√°n relacionades con la metodolog√≠a) tambi√©n est√° m√°s familiarizado con R. Mi intenci√≥n era hacer el bot lo m√°s <strong>trasparente y accesible</strong> para la comunidad, as√≠ que me decant√© por R. En un pricipio segu√≠ el <a href="https://www.rostrum.blog/2020/09/21/londonmapbot/">tutorial de Matt Dray</a>, en el que utiliza el paquete de R <a href="https://docs.ropensci.org/rtweet/9">{rtweet}</a> para interactuar con la API de Twitter. Hay m√°s tutoriales que usan rtweet para crear un bot con R. Pero a diferencia de otros, este tutorial explicaba c√≥mo usar GitHub actions para ejecutar el c√≥digo de forma peri√≥dica. Ahora explico esto √∫ltimo. Mientras tanto, vamos al c√≥digo de R.</p>
<p>Primero cre√© un <strong><a href="https://github.com/gongcastro/psicotuiterbot">repositorio de GitHub</a></strong> donde alojar el c√≥digo (GitHub es como un Google Drive especializado en c√≥digo donde adem√°s podemos hacer control de versiones de los archivos que subimos). Puedes echar un vistazo al c√≥digo de R en la carpeta R/. El c√≥digo principalmente recoge los <strong>√∫ltimos tweets que se han escrito en las √∫ltimos 6 horas mencionando <a href="https://twitter.com/hashtag/psicotuiter?src=hashtag_click&amp;f=live">#psicotuiter</a> o <a href="https://twitter.com/search?q=%23psicotwitter&amp;src=typed_query&amp;f=live">#psicotwitter</a> y los retuitea</strong>. No me meter√© en detalle a explicar c√≥mo funciona el c√≥digo, pero aqu√≠ va un peque√±o resumen del programa. Si tienes curiosidad te recomiendo explorar el repositorio de GitHub, que contiene todo lo necesario para hacer funcionar el bot:</p>
<p>Primero cargamos el paquete de R <a href="https://dplyr.tidyverse.org/">{dplyr}</a>, que utilizamos en bastantes ocasiones en el programa, ajustamos un peque√±o detalle relacionado con el comportamiento de la API de Twitter, e instalamos los paquetes necesarios (en caso de que hayan cambiado) usando el pqeute de R <a href="https://rstudio.github.io/renv/articles/renv.html">{renv}</a> (si no lo conoces y te interesa la reproducibilidad computacional tienes que echarle un vistazo).</p>
<pre class="r"><code># bot R code
library(dplyr)

options(httr_oob_default = TRUE)

# restore packages
renv::restore()</code></pre>
<p>A continuaci√≥n extraemos las <strong>credenciales</strong> que necesitamos para acceder a la API de Twitter (las paso a como variables de entorno para evitar hacerlas p√∫blicas, ya que eso der√≠a acceso a cualquiera a la cuenta de Twitter del bot).</p>
<pre class="r"><code># authenticate Twitter API
my_token &lt;- rtweet::create_token(
    app = &quot;psicotuiterbot&quot;,  # the name of the Twitter app
    consumer_key = Sys.getenv(&quot;TWITTER_CONSUMER_API_KEY&quot;),
    consumer_secret = Sys.getenv(&quot;TWITTER_CONSUMER_API_KEY_SECRET&quot;),
    access_token = Sys.getenv(&quot;TWITTER_ACCESS_TOKEN&quot;),
    access_secret = Sys.getenv(&quot;TWITTER_ACCESS_TOKEN_SECRET&quot;), 
    set_renv = FALSE
)</code></pre>
<p>Luego <strong>extraemos los tweets</strong> usando rtweet, filtramos los que sean relevantes y no contengan posible contenido ofensivo (y alg√∫n otro filtro m√°s)</p>
<pre class="r"><code># define hashtags
hashtags_vct &lt;- c(&quot;#psicotuiter&quot;, &quot;#psicotwitter&quot;, &quot;#Psicotuiter&quot;, &quot;#Psicotwitter&quot;, &quot;#PsicoTuiter&quot;, &quot;#PsicoTwitter&quot;)
hashtags &lt;- paste(hashtags_vct, collapse = &quot; OR &quot;)
hate_words &lt;- unlist(strsplit(Sys.getenv(&quot;HATE_WORDS&quot;), &quot; &quot;)) # words banned from psicotuiterbot (separated by a space)
time_interval &lt;- lubridate::now(tzone = &quot;UCT&quot;)-lubridate::minutes(120)

# get mentions to #psicotuiter and others
all_tweets &lt;- rtweet::search_tweets(
    hashtags, 
    type = &quot;recent&quot;, 
    token = my_token, 
    include_rts = FALSE, 
    tzone = &quot;CET&quot;
) 

status_ids &lt;- all_tweets %&gt;% 
    filter(
        created_at &gt;=  time_interval, # 15 min
        !grepl(paste(hate_words, collapse = &quot;|&quot;), text), # filter out hate words
        stringr::str_count(text, &quot;#&quot;) &lt; 4 # no more than 3 hashtags
    ) %&gt;% 
    pull(status_id)


# get request ID
request_tweets &lt;- rtweet::get_mentions(
    token = my_token, 
    tzone = &quot;CET&quot;
) </code></pre>
<p>Finalmente, <strong>hacemos RT</strong> uno a uno usando rtweet (si ya hab√≠amos hecho RT a uno de ellos simplemente se ignora).</p>
<pre class="r"><code>if (nrow(request_tweets) &gt; 0) {
    request_ids &lt;- request_tweets %&gt;% 
        filter(
            created_at &gt;= time_interval, # 15 min
            grepl(&quot;@psicotuiterbot&quot;, text),
            grepl(&quot;rt|RT|Rt&quot;, text),
            !grepl(paste(hate_words, collapse = &quot;|&quot;), text) # filter out hate words
        ) %&gt;% 
        pull(status_in_reply_to_status_id)
    
    # get requested IDS
    if (length(request_ids) &gt; 0) {
        requested_ids &lt;- rtweet::lookup_statuses(request_ids, token = my_token) %&gt;% 
            filter(
                !grepl(paste(hate_words, collapse = &quot;|&quot;), text) # filter out hate words
            ) %&gt;% 
            pull(status_id)
    } else {
        requested_ids &lt;- NULL
    }
} else {
    requested_ids &lt;- NULL
}


# RT all IDs
if (length(status_ids) &gt; 0){
    for (i in 1:length(status_ids)){
        rtweet::post_tweet(
            retweet_id = unique(status_ids)[i], # vector with IDs
            token = my_token
        )
    }
    print(paste0(length(status_ids), &quot; RT(s): &quot;, paste(status_ids, collapse = &quot;, &quot;)))
} else {
    print(&quot;No tweets to RT&quot;)
}
</code></pre>
<p>Recientemente inclu√≠ un peque√±o bloque de c√≥digo para permitir que la gente solicitase un <strong>RT para tuits que no mencionaban #psicotuiter</strong>, pero podr√≠an ser de inter√©s para la comunidad. Para hacerlo solo hay que responder al tuit en cuesti√≥n mencionando a <span class="citation">@psicotuiterbot</span> junto con la palabra RT (ej., ‚ÄúRT <span class="citation">@psicotuiter</span> por favor‚Äù).</p>
<pre class="r"><code># tweet requests
if (length(requested_ids) &gt; 0){
    for (i in 1:length(requested_ids)){
        rtweet::post_tweet(
            retweet_id = unique(requested_ids)[i], # vector with IDs
            token = my_token
        )
    }
    print(paste0(length(requested_ids), &quot; request(s) posted: &quot;, paste(requested_ids, collapse = &quot;, &quot;)))
} else {
    print(&quot;No requests&quot;)
}</code></pre>
</div>
<div id="ejecutando-el-c√≥digo" class="section level2">
<h2>Ejecutando el c√≥digo</h2>
<p>Lo que hace ‚Äúbot‚Äù a un bot es que <strong>no requiere intervenci√≥n manual</strong> para que realice la acci√≥n que deseamos. Hay muchas opciones para conseguir esto, pero casi todas tienen un inconveniente: necesitamos que una m√°quina (ordenador/servidor, m√≥vil, etc.) est√© encendido en el momento en el que queremos ejecutar nuestro c√≥digo. En nuestro caso necesitamos que se ejecute cada 15 minutos, lo que implica que deber√≠amos tener un dispositivo conectado a la corrriente y funcionando todo el d√≠a. Tener mi ordenador personal haciendo esto no es una opci√≥n viable. Me encontr√© con dos alternativas.</p>
<div id="primer-intento-sale-mal-github-actions" class="section level3">
<h3>Primer intento (sale mal): GitHub actions</h3>
<p>Como mencion√© antes, en el tutorial de Matt Dray se ilustra c√≥mo usar <a href="https://github.com/features/actions"><strong>GitHub Actions</strong></a> para ejecutar nuestro c√≥digo una vez est√° alojado en un repositorio de GitHub. GitHub Actions es un servicio que ofrece GitHub que permite ejecutar ciertos comandos en determinadas condiciones o cada cierto tiempo usando un servidor que ponen a nuestra disposici√≥n (con ciertos l√≠mites). Este grupo de comandos se denominan <em>workflows</em> o flujos de trabajo, y si los incluimos en una carpeta de nuestro repositorio llamada .github/workflows/ siguiendo cierto formato en un archivo YAML (.yml), GitHub se encargar√° de ejecutarlo sin nuestra intervenci√≥n. Hay buenos <a href="https://www.youtube.com/watch?v=R8_veQiYBjI">tutoriales</a> sobre c√≥mo y cu√°ndo escribir <em>workflows</em> para GutHub Actions. El <em>workflow</em> principal era inicialmente este:</p>
<pre class="yml"><code>name: bot

on:
  push:
    branches:
      - main # run every time there is a push to main branch
      - test
jobs:

  psicotuiterbot-post:
    runs-on: macOS-latest
    env: #  twitter API keys (used to authenticate) defined in the gh actions environment
      TWITTER_CONSUMER_API_KEY: ${{ secrets.TWITTER_CONSUMER_API_KEY }}
      TWITTER_CONSUMER_API_KEY_SECRET: ${{ secrets.TWITTER_CONSUMER_API_KEY_SECRET }}
      TWITTER_ACCESS_TOKEN: ${{ secrets.TWITTER_ACCESS_TOKEN }}
      TWITTER_ACCESS_TOKEN_SECRET: ${{ secrets.TWITTER_ACCESS_TOKEN_SECRET }}
      
    steps:
      - uses: actions/checkout@v2
      - uses: r-lib/actions/setup-r@v1
      - uses: r-lib/actions/setup-renv@v1
        with:
          cache-version: 1
      - name: Restore packages using renv
        shell: Rscript {0}
        run: |
          if (!requireNamespace(&quot;renv&quot;, quietly = TRUE)) install.packages(&quot;renv&quot;)
          renv::restore()
      - name: Create and post tweet
        run: Rscript R/bot.R</code></pre>
<p>La gran ventaja de usar este sistema es que <strong>no necesitamos usar nuestro ordenador personal, ya que usamos el que que GitHub nos asigna</strong> (un servidor no deja de ser un ordenador). Pero tiene varios inconvenientes. El primero es que el proceso de establecer un <em>workflow</em> en GitHub Actions suele requerir varios intentos (en mi caso muchos). Esto suele deberse a problemas de reproducibilidad computacional: el c√≥digo funciona correctamente en mi ordenador porque en √©l tengo instalado todo el sofware del que depende. Cuando uso el servidor de GitHub, el sistema operativo suele necesitar que instalemos estas <strong>dependencias</strong> antes de ejecutar el c√≥digo. GitHub Actions permite cierta flexibilidad a la hora de seleccionar el software que viene instalado en el sistema operativo que vamos a usar (ej. R, dependencias de Linux, et.). El problema es que muchas veces ni siquiera somos conscientes de cu√°ntas dependencias requiere nuestro c√≥digo. Con paciencia y muchas b√∫squedas de Google es posible solventar este problema.</p>
<p>Un segundo inconveniente que encontr√© a la hora de implementar el bot en GitHub Actions tiene que ver con los tiempos: instalar todas las dependencias del c√≥digo en el servidor cada 15 minutos (la configuraci√≥n se pierde casi totalmente tras cada ejecuci√≥n) es <strong>poco eficiente</strong>. Instalar las dependencias puede tardar m√°s de 10 minutos (en el caso de este bot). Esto puede adem√°s hacer fallar en ocasiones el flujo de trabajo (GitHub Actions tampoco es lo m√°s consistente del mundo, aunque no deja de ser gratis).</p>
</div>
</div>
<div id="segundo-intento-sale-bien-raspberry-pi" class="section level2">
<h2>Segundo intento (sale bien): Raspberry Pi</h2>
<p>Tras varios problemas en la ejecuci√≥n del bot a trav√©s de GitHub Actions, decid√≠ cambiar el m√©todo. Por razones ajenas al bot, hac√≠a unos meses que ten√≠a muerta de aburrimiento una <a href="https://www.raspberrypi.com/products/raspberry-pi-4-model-b/"><strong>Raspberry Pi 4</strong></a> que compr√© con un amigo para jugar con ella. Este dispositivo es un mini-ordenador relativamente barato (~40‚Ç¨) que sali√≥ al mercado como herramienta educativa para ense√±ar a programar pero que poco a poco ha ido tomando espacio en lugares de producci√≥n. Tiene mil posibilidades por su simplicidad y, en nuestro caso, por su bajo consumo.</p>
<div class="figure">
<img src="/img/raspberry.jfif" alt="" />
<p class="caption">Aqu√≠ est√° alojado el <span class="citation">@psicotuiterbot</span></p>
</div>
<p>Tener una Raspberry Pi funcionando todo el d√≠a <strong>apenas tiene impacto sobre el consumo de luz</strong>. Primero instal√© el c√≥digo en la Raspberry con sus dependencias: b√°sicamente, clon√© el repositorio de GitHub en una carpeta dentro de home/Documents/. Para ejcutar el c√≥digo cada 15 minutos utilic√© una funci√≥n muy √∫til que incluye Linux (sistema operativo con el que funciona la Raspberry) llamado <strong>CRON</strong>. Simplemente consiste en un archivo en el que incluimos una serie de comandos que queremos que se ejecuten de forma peri√≥dica, junto con una c√≥digo que indica la periodicidad de la ejcuci√≥n de este comando. Aqu√≠ tienes unos <a href="https://crontab.guru/examples.html">ejemplos</a>. Inclu√≠ cuatro comandos (cada uno en su propio archivo con extensi√≥n .sh, que denota comandos de Linux):</p>
<pre class="sh"><code># descarga el c√≥digo de GitHub, por si ha habido cambios
git pull origin main

# ejecuta el c√≥digo principal del bot
TZ=&quot;Spain/Madrid&quot; Rscript -e &#39;source(&quot;R/bot.R&quot;)&#39;

# guarda los tweets detectados en un archivo y crea un gr√°fico
Rscript -e &#39;source(&quot;R/counts.R&quot;)&#39;
rm Rplots.pdf

# sube los nuevos datos a GitHub
git add .
git commit -m &quot;Update repository&quot;
git push</code></pre>
<p>Estos comandos se ejecutan en este orden cada 15 minutos.</p>
</div>
</div>
<div id="conclusiones" class="section level1">
<h1>Conclusiones</h1>
<p>De momento el bot est√° funcionando bastante bien y se le est√° dando bastante uso, especialmente por parte de cuentas peque√±as. A√∫n tengo pendiente hacer un an√°lisis m√°s profundo de qu√© tipo de actividad tiene lugar en el bot, pero mi impresi√≥n es que la mayor√≠a de usos consisten en petitiones de referencias de profesionales de psicolog√≠a en poblaciones concretas o de referencias bilbiogr√°ficas. Aqu√≠ est√° el gr√°fico de actividad hasta la fecha en la que est√°s leyendo este post (se actualiza cada dos semanas):</p>
<div class="figure">
<img src="https://github.com/gongcastro/psicotuiterbot/blob/main/img/counts.png?raw=true" alt="" />
<p class="caption">Actividad de <span class="citation">@psictuiterbot</span></p>
</div>
</div>

            </div>
        </article>

        <hr />

        <div class="post-info">
            
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>

        <span class="tag"><a href="http://gongcastro.github.io/tags/r/">r</a></span>
        <span class="tag"><a href="http://gongcastro.github.io/tags/twitter/">twitter</a></span>
        
    </p>

            
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>

        <span class="tag"><a href="http://gongcastro.github.io/categories/r/">r</a></span>
        
    </p>

			    <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"></circle><line x1="1.05" y1="12" x2="7" y2="12"></line><line x1="17.01" y1="12" x2="22.96" y2="12"></line></svg><a href="a5cba07aa3926119c4b8c27d28ecfef65c124fce" target="_blank" rel="noopener">a5cba07</a> @ 2021-12-30</p>
  		</div>
    </main>

            </div>

            
                <footer class="footer">
    
    
</footer>

            
        </div>

        



<script type="text/javascript" src="/bundle.min.ace63d93098bf623f7c286a9084a4c22bfc482944c734f87fe0b685c7c6c7fa0ad2edb028c3b4b60d3343720c8ab490b320ad7f8edf4f6e9a6b898fc529057a9.js" integrity="sha512-rOY9kwmL9iP3woapCEpMIr/EgpRMc0&#43;H/gtoXHxsf6CtLtsCjDtLYNM0NyDIq0kLMgrX&#43;O309ummuJj8UpBXqQ=="></script>





    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
    
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
            processEscapes: true,
            processEnvironments: true
        },
        // Center justify equations in code and markdown cells. Elsewhere
        // we use CSS to left justify single line equations in code cells.
        displayAlign: 'center',
        "HTML-CSS": {
            styles: {'.MathJax_Display': {"margin": 0}},
            linebreaks: { automatic: true }
        }
    });
    </script>
    
    </body>
</html>
