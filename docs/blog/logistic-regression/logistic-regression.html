<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Gonzalo Garcia-Castro">
<meta name="description" content="Logistic regression models provide information way beyond a p-value. Using the {palmerpenguins} dataset, I review the relationship between the logistic and the logit functions, and how to interpret the coefficients of a logistic regression model, capitalising on marginal effects.">
<title>Gonzalo Garcia-Castro</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../..//assets/media/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><style>
    .quarto-title-block .quarto-title-banner {
      background: #2DC9D2;
    }
    </style>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><link rel="stylesheet" href="../../assets/css/styles.css">
<meta property="og:title" content="Gonzalo Garcia-Castro">
<meta property="og:description" content="Language, stats, R">
<meta property="og:image" content="/assets/media/favicon.jpeg">
<meta property="og:site-name" content="Gonzalo García-Castro">
<meta name="twitter:title" content="Gonzalo Garcia-Castro">
<meta name="twitter:description" content="Language, stats, R">
<meta name="twitter:image" content="../../assets/media/favicon.jpeg">
<meta name="twitter:creator" content="@gongcastro">
<meta name="twitter:site" content="@cbcUPF">
<meta name="twitter:card" content="summary">
</head>
<body class="floating nav-fixed slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Gonzalo García-Castro</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../cv.html">
 <span class="menu-text">CV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html">
 <span class="menu-text">Blog</span></a>
  </li>  
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item compact">
    <a class="nav-link" href="https://github.com/gongcastro"><i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
<div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default blog-post page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">Getting the most out of logistic regression</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
                  <div>
        <div class="description">
          Logistic regression models provide information way beyond a <em>p</em>-value. Using the {palmerpenguins} dataset, I review the relationship between the logistic and the logit functions, and how to interpret the coefficients of a logistic regression model, capitalising on marginal effects.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">r</div>
                <div class="quarto-category">tidyverse</div>
                <div class="quarto-category">regression</div>
                <div class="quarto-category">statistics</div>
                <div class="quarto-category">logistic</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Gonzalo Garcia-Castro <a href="https://orcid.org/0000-0002-8553-4209" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">Sunday, January 22, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto"><nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Contents</h2>
   
  <ul>
<li><a href="#the-logistic-function" id="toc-the-logistic-function" class="nav-link active" data-scroll-target="#the-logistic-function">The logistic function</a></li>
  <li><a href="#the-logit-function" id="toc-the-logit-function" class="nav-link" data-scroll-target="#the-logit-function">The logit function</a></li>
  <li><a href="#our-dataset" id="toc-our-dataset" class="nav-link" data-scroll-target="#our-dataset">Our dataset</a></li>
  <li><a href="#fitting-the-model" id="toc-fitting-the-model" class="nav-link" data-scroll-target="#fitting-the-model">Fitting the model</a></li>
  <li>
<a href="#the-probability-scale" id="toc-the-probability-scale" class="nav-link" data-scroll-target="#the-probability-scale">The probability scale</a>
  <ul class="collapse">
<li><a href="#marginal-effects" id="toc-marginal-effects" class="nav-link" data-scroll-target="#marginal-effects">Marginal effects</a></li>
  </ul>
</li>
  <li><a href="#combining-our-findings" id="toc-combining-our-findings" class="nav-link" data-scroll-target="#combining-our-findings">Combining our findings</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/gongcastro/gongcastro.github.io/edit/main/blog/logistic-regression/logistic-regression.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/gongcastro/gongcastro.github.io/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full" id="quarto-document-content"><div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/ggtext/">ggtext</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidyverse/glue">glue</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org">scales</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org">stringr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/">tibble</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mjskay.github.io/ggdist/">ggdist</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/">palmerpenguins</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span></span>
<span>            axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">0.65</span><span class="op">)</span>,</span>
<span>            panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>        <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">clrs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#003f5c"</span>, <span class="st">"#58508d"</span>, <span class="st">"#bc5090"</span>, <span class="st">"#ff6361"</span>, <span class="st">"#ffa600"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="penguins.jpg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Some Adelie penguins ready to be logisticised.</figcaption><p></p>
</figure>
</div>
<blockquote class="blockquote">
<p><strong>Logistic regression</strong> is a conventional way to model binary outcomes. This post is an attempt to summarise my recent learning progress on this topic, addressed to my previous self who knew how to <em>use</em> logistic regression but had very superficial knowledge of what happens under the hood. Not to mention writing this post has been a fantastic learning experience. I hope its useful.</p>
</blockquote>
<section id="the-logistic-function" class="level1 page-columns page-full"><h1>The logistic function</h1>
<p>The <strong>logistic function</strong> is a mathematical function that defines how the values of an input variable <span class="math inline">\(x\)</span> that span the range of real values <span class="math inline">\(x \in (-\infty, +\infty)\)</span> are associated to an output variable <span class="math inline">\(y\)</span> that spans an interval of real values contained within the <span class="math inline">\([0, 1]\)</span> interval or narrower. This function is <strong>monotonic</strong>: <span class="math inline">\(y\)</span> increases for <span class="math inline">\(x &gt; 0\)</span> and increases for <span class="math inline">\(x &lt; 0\)</span>, or decreases for <span class="math inline">\(x &gt; 0\)</span> and increases for <span class="math inline">\(x &lt; 0\)</span>. This function takes the general form shown in <a href="#eq-logistic-three">Equation&nbsp;1</a>:</p>
<p><span id="eq-logistic-three"><span class="math display">\[
\text{Logistic(x)} = \frac{L}{1 + e^{(-\beta \ · \ (x-x_0))}}
\tag{1}\]</span></span></p>
<p>Where:</p>
<ul>
<li>
<span class="math inline">\(L\)</span> is the <strong>upper limit</strong> of <span class="math inline">\(y\)</span>, which is commonly assumed to be 1, where <span class="math inline">\(L \in (0, +\infty)\)</span>.</li>
<li>
<span class="math inline">\(\beta\)</span> is a coefficient that indicates the <strong>steepness</strong> of the logistic curve, or how fast the curve grows, where <span class="math inline">\(\beta \in (-\infty, +\infty)\)</span>. Positive values of this coefficient lead to the logistic curve growing as <span class="math inline">\(x\)</span> increases, to the logistic curve decays when <span class="math inline">\(x\)</span> decreases.</li>
<li>
<span class="math inline">\(x_0\)</span> is the <strong>mid-point</strong> of the logistic curve, indicating the value of <span class="math inline">\(x\)</span> where the maximum of <span class="math inline">\(\beta\)</span> is found, that is, when the logistic curve is steepest</li>
</ul>
<p>I first learnt about the logistic function and its parameters in <a href="https://www.tjmahr.com/anatomy-of-a-logistic-growth-curve/">this blog post by TJ Mahr</a> <span class="citation" data-cites="mahr2019anatomy">(<a href="#ref-mahr2019anatomy" role="doc-biblioref">Mahr, 2019</a>)</span>, in which he describes the different parameters of the function, and how they relate to its behaviour. Let’s take a look at how the logistic curve looks like for different values of these parameters. We can implement the logistic function in R like this:</p>
<div class="no-row-height column-margin column-container"><div id="ref-mahr2019anatomy" class="csl-entry" role="doc-biblioentry">
Mahr, T. (2019, February 15). <em>Anatomy of a logistic growth curve. Higher order functions</em>. <a href="https://www.tjmahr.com/anatomy-of-a-logistic-growth-curve/">https://www.tjmahr.com/anatomy-of-a-logistic-growth-curve/</a>
</div></div><div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">logistic</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">slope</span>, <span class="va">mid</span>, <span class="va">upper</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">upper</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">slope</span> <span class="op">*</span> <span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">mid</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we generate a logistic curve by applying <code>logistic()</code> to a numeric vector <code>x</code>. We will set the steepness (<span class="math inline">\(\beta\)</span>, <code>slope</code>), mid-point (<span class="math inline">\(x_0\)</span>, <code>mid</code>), and upper limit (<span class="math inline">\(L\)</span>, <code>upper</code>) at different values for illustration. In <a href="#fig-logistic-simulation">Figure&nbsp;1</a> we can see how larger values of <span class="math inline">\(L\)</span>, the asymptote of the logistic curve occurs at higher values, how larger values of <span class="math inline">\(\beta\)</span> make the curve steeper, and how larger values of <span class="math inline">\(x_0\)</span> make the mid-point of the curve occur at higher values of the <span class="math inline">\(x\)</span> variable.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">7</span>, <span class="fl">7</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">slope</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="va">mid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">upper</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.7</span>, <span class="fl">0.9</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">logistic_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand_grid.html">expand_grid</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">slope</span>, <span class="va">mid</span>, <span class="va">upper</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu">logistic</span><span class="op">(</span><span class="va">x</span>, <span class="va">slope</span>, <span class="va">mid</span>, <span class="va">upper</span><span class="op">)</span>,</span>
<span>           values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"slope = "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">slope</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>                           <span class="st">", mid = "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">mid</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">logistic_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, colour <span class="op">=</span> <span class="va">values</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">upper</span>, labeller <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labeller.html">labeller</a></span><span class="op">(</span>upper <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"upper = "</span>, <span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"Parameter values"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>panel.grid <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_line</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="st">"dotted"</span>, colour <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span>,</span>
<span>          panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>          legend.position <span class="op">=</span> <span class="st">"top"</span>,</span>
<span>          legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>          legend.justification <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"top"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-logistic-simulation" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="logistic-regression_files/figure-html/fig-logistic-simulation-1.png" class="img-fluid figure-img" width="4500"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;1: Logistic curves under different parameter values for the slope, the upper limit, and the mid-point.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>You might have seen the logistic function in different forms. This might be because it can parameterised in slightly different ways (as we’ll see later), or because someone decided to pick different symbols for the same parameters. Sometimes, you might even find a formula for the logistic form that includes less parameters. This is because it is common to assume that some of the parameters we have seen are constant. For instance, whenever we assume that <span class="math inline">\(y\)</span> ranges from 0 to 1 (e.g., proportions), <span class="math inline">\(L\)</span> can be assumed to be 1. See <a href="#eq-upper">Equation&nbsp;2</a> and note how we have replaced <span class="math inline">\(L\)</span> with 1.</p>
<p><span id="eq-upper"><span class="math display">\[
\text{Logistic(x)} = \frac{1}{1 + e^{(-\beta \ (x-x_0))}}
\tag{2}\]</span></span></p>
<p>This is called the <strong>two-parameter logistic function</strong> because, effectively, only two parameters are left to be estimated: the steepness of the curve (<span class="math inline">\(\beta\)</span>) and its mid-point (<span class="math inline">\(x_0\)</span>). The two-parameter logistic regression function is the one we usually encounter in logistic regression. More general cases like the three-parameter logistic function (<a href="#eq-logistic-three">Equation&nbsp;1</a>) are more flexible and are used when one is particularly interested in estimating them explicitly in a statistical model. This <a href="https://en.wikipedia.org/wiki/Logistic_function">Wikipedia article</a> suggests some historical uses of these functions, like Item Response Theory (IRT) in Psychology and Cognitive Sciences.</p>
<p>It is still not clear how <a href="#eq-upper">Equation&nbsp;2</a> relates to a regression model, right? The coefficients returned by a conventional linear regression model—the intercept and the slope of each predictor, usually noted as <span class="math inline">\(\beta_0 + \beta_1 x\)</span>—do not map perfectly into the coefficients of the logistic function in <a href="#eq-upper">Equation&nbsp;2</a>. These regression coefficients are meant to be in the exponential of <span class="math inline">\(e\)</span>, which is <span class="math inline">\(-\beta \ (x-x_0)\)</span>, but we must first make a simple change:</p>
<p><span class="math display">\[
\begin{aligned}
-\beta \ (x-x_0) = -(-\beta x_0 + \beta x) = -(\beta_0 + \beta_1x)
\end{aligned}
\]</span></p>
<p>We substitute this element in <a href="#eq-upper">Equation&nbsp;2</a>, and we get <a href="#eq-logistic-regression">Equation&nbsp;8</a>:</p>
<p><span id="eq-logistic-regression"><span class="math display">\[
\text{Logistic(x)} = \frac{1}{1 + e^{-(\beta_0 + \beta_1x)}}
\tag{3}\]</span></span></p>
<p>Where <span class="math inline">\(\beta_0 = -kx_0\)</span> and <span class="math inline">\(\beta_1 = k\)</span>. This is how the intercept and the slope of the predictors map onto the <strong>logistic regression equation</strong>! This regression equation, though, is not linear. The response variable and the parameters in the equation do not have a linear relationship. To be able to exploit the convenient properties of a linear model, we need to apply some transformation to the response variable, so that the outcome <em>does</em> hold a linear relationship with the parameters of the logistic function. Let’s talk about the <strong>logit</strong> function.</p>
</section><section id="the-logit-function" class="level1 page-columns page-full"><h1>The logit function</h1>
<p>The <em>logit</em> scale, or the <em>log odds</em> scale, was created by Joseph Berkson in 1944 as a solution to apply linear regression to a variable whose values ranged from 0 to 1 (e.g., proportions). The name <em>logit</em> scale was derived from <em><strong>log</strong>istic un<strong>it</strong></em>. The rationale behind this function was to transform the original variable contained in the <span class="math inline">\([0, 1]\)</span> interval, to a set of values ranging from <span class="math inline">\(-\infty\)</span> to <span class="math inline">\(\infty\)</span>. This way, it was possible to use linear regression to binary variables while holding the assumptions of linear regression. You will frequently see the logit function expressed as in <a href="#eq-logit">Equation&nbsp;4</a> next to the clarification that <span class="math inline">\(p\)</span> is a value comprehended between <span class="math inline">\([0, 1]\)</span>, and that this function is the the inverse of the logistic function.</p>
<p><span id="eq-logit"><span class="math display">\[
\text{Logit(x)} = \text{ln} \bigg( \frac{p}{1-p} \bigg)
\tag{4}\]</span></span></p>
<div class="page-columns page-full"><p>It can be a bit unclear how we ended up with this formula. Let’s try to reconstruct this process<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> <span class="citation" data-cites="lin2019gentle">(<a href="#ref-lin2019gentle" role="doc-biblioref">Lin, 2019</a>)</span>. Starting from <a href="#eq-logistic-regression">Equation&nbsp;8</a>:</p><div class="no-row-height column-margin column-container"><li id="fn1"><p><sup>1</sup>&nbsp;For a more detailed description of the derivation of the logit function from the logistic function—and also for a exhaustive explanation of logistic regression, see <a href="https://hausetutorials.netlify.app/posts/2019-04-13-logistic-regression/">this tutorial by Hause Lin</a>.</p></li><div id="ref-lin2019gentle" class="csl-entry" role="doc-biblioentry">
Lin, H. (2019, April 13). <em>Gentle intro to logistic regression. Data science</em>. <a href="https://hausetutorials.netlify.app/posts/2019-04-13-logistic-regression/">https://hausetutorials.netlify.app/posts/2019-04-13-logistic-regression/</a>
</div></div></div>
<p><span id="eq-logistic-alternative"><span class="math display">\[
\begin{aligned}
\text{Logistic}(x) &amp;= \frac{1}{1 + e^{-(\beta_0 + \beta_1x)}} \\
&amp;= \bigg(\frac{1}{1+e^{-\beta x}} \bigg) · \bigg( \frac{e^{\beta_0 + \beta_1x}}{e^{\beta_0 + \beta_1x}} \bigg) \\
&amp; =\frac{e^{\beta_0 + \beta_1x}}{e^{\beta_0 + \beta_1x}+1} \\
&amp;= \frac{e^{-(\beta_0 + \beta_1x)}}{e^{-(\beta_0 + \beta_1x)} + 1} \\
\end{aligned}
\tag{5}\]</span></span></p>
<p>The inverse of <span class="math inline">\(e^{\beta_0 + \beta_1x}\)</span> is the natural logarithm of <span class="math inline">\(\beta_0 + \beta_1x\)</span>, that is, <span class="math inline">\(\text{ln}(\beta_0 + \beta_1x)\)</span>. The inverse of the logistic function as expressed in <a href="#eq-logistic-alternative">Equation&nbsp;5</a>, and therefore the logit function, is:</p>
<p><span id="eq-logistic-inverse"><span class="math display">\[
\text{Logit}(x) = \text{Logistic}^{-1}(x) = \text{ln} \bigg( \frac{p}{1-p} \bigg)
\tag{6}\]</span></span></p>
<div class="page-columns page-full"><p>Here, <span class="math inline">\(p\)</span> is the outcome of the logistic function, or a value in the <span class="math inline">\([0, 1]\)</span> interval. This is how we get from the logistic function to the <em>logit</em> function! There are more transformations available to make variables in the <span class="math inline">\([0, 1]\)</span> interval suitable for linear regression, like <em>probit</em>, but we won’t get into them<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>. Let’s now see how this takes the form of logistic regression in real data.</p><div class="no-row-height column-margin column-container"><li id="fn2"><p><sup>2</sup>&nbsp;Maybe for an upcoming post Insha’Allah</p></li></div></div>
</section><section id="our-dataset" class="level1 page-columns page-full"><h1>Our dataset</h1>

<div class="no-row-height column-margin column-container"><div class="">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="https://allisonhorst.github.io/palmerpenguins/"><img src="palmerpenguins.png" class="img-fluid figure-img" width="100"></a></p>
</figure>
</div>
</div><div id="ref-horst2020palmerpenguins" class="csl-entry" role="doc-biblioentry">
Horst, A. M., Hill, A. P., &amp; Gorman, K. B. (2020). <em>Palmerpenguins: Palmer archipelago (antarctica) penguin data</em>. <a href="https://doi.org/10.5281/zenodo.3960218">https://doi.org/10.5281/zenodo.3960218</a>
</div></div><p>We’ll be using the <code>penguins</code> dataset from the <strong><a href="https://allisonhorst.github.io/palmerpenguins/">{palmerpenguins}</a> R package</strong> <span class="citation" data-cites="horst2020palmerpenguins">(<a href="#ref-horst2020palmerpenguins" role="doc-biblioref">Horst et al., 2020</a>)</span>. This dataset contains anatomical measurements by researchers at Palmer Station in Antarctica, of 344 penguins, together with some information about the sex, species, and island (for more details, see <code><a href="https://allisonhorst.github.io/palmerpenguins/reference/penguins.html">?palmerpenguins::penguins</a></code>). Let’s first load the data and take a look at them.</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/">palmerpenguins</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"penguins"</span>, package <span class="op">=</span> <span class="st">"palmerpenguins"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">penguins</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 344
Columns: 8
$ species           &lt;fct&gt; Adelie, Adelie, Adelie, Adelie, Adelie, Adelie, Adel…
$ island            &lt;fct&gt; Torgersen, Torgersen, Torgersen, Torgersen, Torgerse…
$ bill_length_mm    &lt;dbl&gt; 39.1, 39.5, 40.3, NA, 36.7, 39.3, 38.9, 39.2, 34.1, …
$ bill_depth_mm     &lt;dbl&gt; 18.7, 17.4, 18.0, NA, 19.3, 20.6, 17.8, 19.6, 18.1, …
$ flipper_length_mm &lt;int&gt; 181, 186, 195, NA, 193, 190, 181, 195, 193, 190, 186…
$ body_mass_g       &lt;int&gt; 3750, 3800, 3250, NA, 3450, 3650, 3625, 4675, 3475, …
$ sex               &lt;fct&gt; male, female, female, NA, female, male, female, male…
$ year              &lt;int&gt; 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007, 2007…</code></pre>
</div>
</div>
<p>Say we are interested in exploring <strong>how the flipper length of a penguin is associated to its sex</strong>. Depending on the specific research question at hand, we would model the data in different ways. Conventionally, we may compare the flipper length of male and female penguins using the latter as a predictor. But since we are interested in logistic regression, we will try to predict the sex of penguins (binary response variable, <code>female</code>/<code>male</code>), based on their flipper length (continuous predictor variable, in millimetres).</p>
<div class="page-columns page-full"><p>For simplicity, let’s say we are only interested in data from penguins of the <em>Adelie</em> species. We will create a data frame with only the relevant variables (<code>sex</code> and <code>flipper_length</code>) and observations (<code>Adelie</code> species and now missing data). We will remove rows with missing data in any of these variables<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>. Finally, we will explicitly recode the <code>sex</code> variable so that R assigns 0s to <code>female</code> and 1s to <code>male</code>. This should be the default behaviour, since R recodes categorical variables in the alphabetical order by default, but it is generally a good idea to double-check.</p><div class="no-row-height column-margin column-container"><li id="fn3"><p><sup>3</sup>&nbsp;Mind that removing observations with any missing values is a particular strategy to deal with missing data that should be taken with caution. Some other strategies (e.g., imputation) might be more appropriate in other occasions</p></li></div></div>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">my_data</span> <span class="op">&lt;-</span> <span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">species</span> <span class="op">==</span> <span class="st">"Adelie"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">flipper_length_mm</span>, <span class="va">sex</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tibble.tidyverse.org/reference/rownames.html">rownames_to_column</a></span><span class="op">(</span><span class="st">"id"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># assign a unique ID to each penguin</span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">sex</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"female"</span>, <span class="st">"male"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now let’s do some exploratory visualisation on the data (see <a href="#fig-descriptives">Figure&nbsp;2</a>). We can see that male penguins have slightly longer flippers. We will now model the association between both variables and perform some statistical inference on it. We will use logistic regression using the <code><a href="https://rdrr.io/r/stats/glm.html">glm()</a></code> function in base R.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">my_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">flipper_length_mm</span>, <span class="va">sex</span>, colour <span class="op">=</span> <span class="va">sex</span>, fill <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="http://mjskay.github.io/ggdist/reference/stat_slab.html">stat_slab</a></span><span class="op">(</span>trim <span class="op">=</span> <span class="cn">FALSE</span>, colour <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>              position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_nudge.html">position_nudge</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span>, scale <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.1</span>, fill <span class="op">=</span> <span class="st">"white"</span>, colour <span class="op">=</span> <span class="st">"black"</span>, size  <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>                 outlier.colour <span class="op">=</span> <span class="cn">NA</span>, position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_nudge.html">position_nudge</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">1</span>, stroke <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="fl">2.5</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>               position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_jitter.html">position_jitter</a></span><span class="op">(</span>height <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_colour_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Flipper length (mm)"</span>, y <span class="op">=</span> <span class="st">"Sex"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"none"</span>, fill <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-descriptives" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="logistic-regression_files/figure-html/fig-descriptives-1.png" class="img-fluid figure-img" width="4200"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2: Flipper length for female and male penguins in the <code>penguins</code> dataset from the {palmerpenguins} R package.</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section><section id="fitting-the-model" class="level1"><h1>Fitting the model</h1>
<p>Following <a href="#eq-logistic-inverse">Equation&nbsp;6</a>, we can express our regression model as:</p>
<p><span id="eq-linear-regression"><span class="math display">\[
\ln \bigg( \frac{p}{1-p} \bigg) = y = \beta_{0} + \beta_{1} \times \text{Flipper length}
\tag{7}\]</span></span></p>
<p>As a reminder, we can also express our regression model as part of the logistic function, replacing the exponential bit in the denominator with our regression model.</p>
<p><span id="eq-logistic-regression"><span class="math display">\[
p = \text{Logistic}(y) = \frac{1}{1 + e^{-(\beta_0 + \beta_1 · \ \text{Flipper length)}}}
\tag{8}\]</span></span></p>
<p>We can implement the model using the base R function <code>glm(..., family = binomial("logit"))</code> in which the <code>family</code> argument tells the function what type of generalised regression family we are interesting in using, and where <code>binomial("logit")</code> indicates that we want the logistic function to be used with the logit transformation (as opposed to probit).</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">sex</span> <span class="op">~</span> <span class="va">flipper_length_mm</span>, </span>
<span>           data <span class="op">=</span> <span class="va">my_data</span>, </span>
<span>           family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span><span class="st">"logit"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We have fitted a binomial logit regression model in which we estimate the probability of a given penguin being female or male, adjusting for their flipper length in millimetres. This is a <strong>generalised linear model</strong> (GLM): after we transform the response variable (sex, coded as 0s and 1s) to the logit scale, the resulting response variable is modelled as a conventional linear model. This means that we can interpret the coefficients of this model the same way we would in a linear model. These are our <strong>coefficients</strong>:</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      (Intercept) flipper_length_mm 
      -24.1696179         0.1271495 </code></pre>
</div>
</div>
<p>We can generate and visualise the <strong>predictions</strong> of our model using the <code>predict</code> function. By setting <code>type = "link"</code>, we are asking the function to return the predictions in the <strong>logit</strong> scale.</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># model predictions (on the probability scale by default)</span></span>
<span><span class="va">my_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">my_data</span>, sex_pred <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit</span>, type <span class="op">=</span> <span class="st">"link"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><a href="#fig-predictions-natural-logit">Figure&nbsp;3</a> shows the predictions of the model in the logit scale. The intercept informs us of the <strong>probability of an average penguin being male</strong> (<code>sex = 1</code>) in the logit scale when all predictors are set to zero: in our case, when <code>flipper_lenght_mm</code> = 0. The value of the intercept -24.17 is somewhat difficult to interpret for two reasons.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># predictions of model with unstandardised age</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">my_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">flipper_length_mm</span>, <span class="va">sex_pred</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>,</span>
<span>               colour <span class="op">=</span> <span class="st">"grey"</span>,</span>
<span>               linetype <span class="op">=</span> <span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">flipper_length_mm</span>, y <span class="op">=</span> <span class="va">sex_pred</span><span class="op">)</span>,</span>
<span>              linewidth <span class="op">=</span> <span class="fl">2</span>,</span>
<span>              colour <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, label <span class="op">=</span> <span class="st">"Male more likely"</span>, x <span class="op">=</span> <span class="fl">170</span>, y <span class="op">=</span> <span class="fl">2.2</span>,</span>
<span>             angle <span class="op">=</span> <span class="fl">90</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"segment"</span>, y <span class="op">=</span> <span class="fl">0.75</span>, yend <span class="op">=</span> <span class="fl">2.2</span>, x <span class="op">=</span> <span class="fl">172</span>, xend <span class="op">=</span> <span class="fl">172</span>,</span>
<span>             size <span class="op">=</span> <span class="fl">1</span>, arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, label <span class="op">=</span> <span class="st">"Female more likely"</span>, x <span class="op">=</span> <span class="fl">170</span>, y <span class="op">=</span> <span class="op">-</span><span class="fl">2.2</span>,</span>
<span>             angle <span class="op">=</span> <span class="fl">90</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"segment"</span>, y <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>, yend <span class="op">=</span> <span class="op">-</span><span class="fl">2.2</span>, x <span class="op">=</span> <span class="fl">172</span>, xend <span class="op">=</span> <span class="fl">172</span>,</span>
<span>             size <span class="op">=</span> <span class="fl">1</span>, arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Flipper length (mm)"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"P(male) [logit scale]"</span>,</span>
<span>         title <span class="op">=</span> <span class="st">"&lt;span style = 'color:#003f5c;'&gt;Slope (logit scale)&lt;/span&gt;"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>          plot.title <span class="op">=</span> <span class="fu"><a href="https://wilkelab.org/ggtext/reference/element_markdown.html">element_markdown</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-predictions-natural-logit" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="logistic-regression_files/figure-html/fig-predictions-natural-logit-1.png" class="img-fluid figure-img" width="3600"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;3: Predictions of the logistic regression model in the logit scale.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>First, these predictions are in the logit scale, which is <strong>not interpretable by itself</strong> as opposed to the probability scale. For instance, it is easy to understand what a 50% probability of a penguin being male means: if we pick one penguin at random from our population of penguins of interest, the chances of it being male is roughly the same as flipping a coin and getting tails. It is not possible to determine what a 0 logit (equivalent to 50% in the probability scale) of a penguin being male means if not by transforming it to the probability scale. For now, let’s just agree that negative values on the logit scale indicate that the chance of a penguin being male is lower than it being female, that positive values on the logit scale mean that the chance of a penguin being male is higher than it being female, and that a logit of 0 indicates that a penguin is equally likely to be male or female.</p>
<p>With this information, we can conclude from the <strong>intercept</strong> (<span class="math inline">\(\beta_0\)</span>) that a penguin with 0 mm flipper length is extremely likely to be female (-24.17 is a very large negative number in the logit scale). Another reason why interpreting the intercept of this model is troublesome stems precisely from this value corresponding to the likelihood of a penguin being male <strong>when flipper length is 0 mm</strong>. This value is uninterpretable because a flipper length of 0 mm would mean that the penguin has no flippers. We are not really interested in finding out the probability of a penguin with no flippers being male. I’m not an expert, but I assume that such a penguin would likely not be part of our population of interest here. Rather, we might be interested in <strong>getting the probability of a penguin with some specific flipper length of interest being male</strong>, such as the <strong>average flipper length</strong> (190.1 in our sample). We will address how to do this later.</p>
<p>Interpreting the <strong>slope</strong> of <code>flipper_length_mm</code> (<span class="math inline">\(\beta_1\)</span>) is also challenging. On the logit scale, the value of this coefficient (0.13) indicates how much the chance of a penguin being male increases for every unit increase in flipper length in the logit scale. Since <code>flipper_lenght_mm</code> is expressed in millimetres, we can conclude that for every millimetre increment in flipper length, the chance of the measure penguin being male increases in 0.13 logits. Again, we are not sure of how to interpret this quantity, since the logit scale is not interpretable by itself. We need to transform the coefficient of <code>flipper_length_mm</code> to the probability scale to get a better intuition of what it means.</p>
</section><section id="the-probability-scale" class="level1 page-columns page-full"><h1>The probability scale</h1>
<div class="page-columns page-full"><p>We previously tried to interpret the coefficients of a binomial logit regression model and encountered some difficulties. One of them related to the fact that coefficients are expressed in the logit scale. We can solve this by <strong>transforming</strong> these values—in our case the intercept and the coefficient of <code>flipper_length_mm</code>—to the probability scale. This way, the intercept will indicate the probability of a penguin being male when their flipper is 0 mm long<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>. The coefficient of <code>flipper_length_mm</code> will tell us how much such probability increases for every millimetre increase in flipper length.</p><div class="no-row-height column-margin column-container"><li id="fn4"><p><sup>4</sup>&nbsp;As we have already discussed, such penguin is unlikely to exist, and therefore this quantity will be uninteresting, but we will address this issue later.</p></li></div></div>
<p>Transforming values from the logit to the probability scale, however, is not very straightforward. This is because <strong>the relationship between probabilities and logits is non-linear</strong>. If you remember, we had transformed probabilities to logits precisely for this reason! In order to fit a linear model in a sensible way, we to transformed our response variable (probabilities) to a scale with more ideal properties. One of such transformations was the logit function, which we employed. Now we have to deal with its consequences. One first step to transforming logits to probabilities is to use the inverse of the logit function (see <a href="#eq-inv-logit">Equation&nbsp;9</a>).</p>
<p><span id="eq-inv-logit"><span class="math display">\[
\text{Logit}^{-1}(x) = \frac{e^x}{1 + e^x}
\tag{9}\]</span></span></p>
<p>Base R conveniently offers the function <code><a href="https://rdrr.io/r/stats/Logistic.html">plogis()</a></code>, which we can use to transform the intercept of the model to an interpretable probability value:</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">[</span><span class="st">"(Intercept)"</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> (Intercept) 
3.186166e-11 </code></pre>
</div>
</div>
<p>This quantity tells us that the probability of a penguin with flipper length of 0 mm being male (remember that the intercept tells us the value of the response variable when predictors are set at 0). As we suspected, this value is extremely close to zero: 0.000000003%. Obviously, if male penguins tend to have longer flippers, the model will predict that penguins with zero-length flippers as extremely likely to be female! (see <a href="#fig-logit-prob-intercept">Figure&nbsp;4</a>). But aside from this issue that we’ll deal with later, transforming the intercept from a logit model to the probability scale seems fairly simple.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.001</span><span class="op">)</span></span>
<span><span class="va">logit_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">x</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span><span class="va">prob</span>, logit <span class="op">=</span> <span class="fu">logit_fun</span><span class="op">(</span><span class="va">prob</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">txt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_wrap.html">str_wrap</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span></span>
<span>        <span class="st">"The intercept in our model is "</span>, </span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">[</span><span class="st">"(Intercept)"</span><span class="op">]</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>        <span class="st">" in the logit scale, which translates to an extremely "</span>,</span>
<span>        <span class="st">"low value in the probability scale, very close to zero!"</span><span class="op">)</span>,</span>
<span>    width <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">d</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">logit</span>, <span class="va">prob</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"curve"</span>, x <span class="op">=</span> <span class="op">-</span><span class="fl">5</span>, xend <span class="op">=</span> <span class="op">-</span><span class="fl">7.5</span>, y <span class="op">=</span> <span class="fl">0.35</span>, yend <span class="op">=</span> <span class="fl">0.05</span>, size <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>             arrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/arrow.html">arrow</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>, curvature <span class="op">=</span> <span class="op">-</span><span class="fl">0.45</span>, ncp <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, label <span class="op">=</span> <span class="va">txt</span>,</span>
<span>             x <span class="op">=</span> <span class="op">-</span><span class="fl">7.5</span>, y <span class="op">=</span> <span class="fl">0.5</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, linewidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Logit"</span>, y <span class="op">=</span> <span class="st">"Probability"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="va">percent</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-logit-prob-intercept" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="logistic-regression_files/figure-html/fig-logit-prob-intercept-1.png" class="img-fluid figure-img" width="3600"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4: The relationship between logits and probabilities.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Doing the same with the <strong>coefficients of the predictors</strong> is a different story. This is because the intercept of the model maps onto a single point in the logit scale, and so it does in the probability scale too. There is a one-to-one correspondence between each value of the logit and the probability scales. But <strong>a regression coefficient does not refer to single value</strong> in either scale, but to a <strong>difference in values</strong>.</p>
<p>A regression coefficient tells us the <strong>estimated increase in the response variable for every unit increment in the predictor</strong>—while any other predictor is set at zero. This is true for any linear regression model, including ours. As long as we remain in the logit scale, the coefficient of the <code>flipper_length_mm</code> predictor will inform us of the increase in logits of being male for every millimetre increment in flipper length. But as soon as we move to the probability scale, this stops being true. This is because of the non-linear relationship between logits and probabilities: <strong>a difference of one logit of being male is not the same for the entire range of flipper lengths</strong>. Take a look at <a href="#fig-logit-prob-slope">Figure&nbsp;5</a>.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.001</span><span class="op">)</span></span>
<span><span class="va">logit_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">x</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span><span class="va">prob</span>, logit <span class="op">=</span> <span class="fu">logit_fun</span><span class="op">(</span><span class="va">prob</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># model predictions (on the probability scale by default)</span></span>
<span><span class="va">my_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="va">my_data</span>, </span>
<span>                  sex_pred <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html">fitted</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>, </span>
<span>                  sex_pred_logit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit</span>, type <span class="op">=</span> <span class="st">"link"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">point_preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>flipper_length_mm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">180</span>, <span class="fl">185</span>, <span class="fl">190</span>, <span class="fl">195</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>sex_pred <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># predictions of model with unstandardised age</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">my_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">flipper_length_mm</span>, <span class="va">sex_pred</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="co"># plot observations</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>, </span>
<span>               shape <span class="op">=</span> <span class="fl">1</span>,</span>
<span>               size <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>               stroke <span class="op">=</span> <span class="fl">1</span>,</span>
<span>               position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_jitter.html">position_jitter</a></span><span class="op">(</span>height <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>               alpha <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>               colour <span class="op">=</span> <span class="st">"grey"</span>,</span>
<span>               linetype <span class="op">=</span> <span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">flipper_length_mm</span>, y <span class="op">=</span> <span class="va">sex_pred</span><span class="op">)</span>,</span>
<span>              linewidth <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>              colour <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="co"># plot intercept (y when x = 0)</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">[</span><span class="st">"(Intercept)"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>               linetype <span class="op">=</span> <span class="st">"dashed"</span>,</span>
<span>               colour <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span>  <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span>, xend <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">]</span>,</span>
<span>                     y <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span>, yend <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                 linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">]</span>, xend <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">]</span>, </span>
<span>                     y <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span>, yend <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                 linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>,</span>
<span>             label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent</a></span><span class="op">(</span><span class="va">point_preds</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span><span class="op">-</span><span class="va">point_preds</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="st">" increment"</span><span class="op">)</span>,</span>
<span>             x <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">]</span>, </span>
<span>             y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">point_preds</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span>, <span class="va">point_preds</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, </span>
<span>             hjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, </span>
<span>             label <span class="op">=</span> <span class="st">"5 cm difference"</span>,</span>
<span>             x <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span>, </span>
<span>             y <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span>, </span>
<span>             hjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>,</span>
<span>             vjust <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">]</span>, xend <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">4</span>, <span class="fl">1</span><span class="op">]</span>,</span>
<span>                     y <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">]</span>, yend <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                 linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">4</span>, <span class="fl">1</span><span class="op">]</span>, xend <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">4</span>, <span class="fl">1</span><span class="op">]</span>, </span>
<span>                     y <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">]</span>, yend <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">4</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                 linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, </span>
<span>             label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent</a></span><span class="op">(</span><span class="va">point_preds</span><span class="op">[</span><span class="fl">4</span>, <span class="fl">2</span><span class="op">]</span><span class="op">-</span><span class="va">point_preds</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="st">" increment"</span><span class="op">)</span>,</span>
<span>             x <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">4</span>, <span class="fl">1</span><span class="op">]</span>, </span>
<span>             y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">point_preds</span><span class="op">[</span><span class="fl">4</span>, <span class="fl">2</span><span class="op">]</span>, <span class="va">point_preds</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             hjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, </span>
<span>             label <span class="op">=</span> <span class="st">"5 cm difference"</span>,</span>
<span>             x <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">]</span>, </span>
<span>             y <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">]</span>, </span>
<span>             hjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>,</span>
<span>             vjust <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Flipper length (mm)"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"P(male)"</span>,</span>
<span>         title <span class="op">=</span> <span class="st">"&lt;span style = 'color:#003f5c;'&gt;Logistic curve&lt;/span&gt;,</span></span>
<span><span class="st">        &lt;span style = 'color:#ff6361;'&gt;intercept&lt;/span&gt;"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="va">percent</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.25</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>          plot.title <span class="op">=</span> <span class="fu"><a href="https://wilkelab.org/ggtext/reference/element_markdown.html">element_markdown</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-logit-prob-slope" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="logistic-regression_files/figure-html/fig-logit-prob-slope-1.png" class="img-fluid figure-img" width="3600"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;5: The coefficients of a logistic regression model scale differently for different values of their predictors.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>A difference in the logit scale does not scale equally to the probability scale. In the probability scale, a penguin with 190 mm long flipper is 0 more likely to be male than a penguin with 185 mm long flipper. Interestingly, a penguin with a 195 mm long flipper is 0 more likely to be male than a penguin with a 195 mm long flipper. In both cases, the difference in flipper length is the same (5 mm), but the estimated increase in male probability is different!</p>
<p>This non-linearity in the relationship between logits and probabilities should be considered when interpreting the coefficients of a logistic regression model and, more generally, whenever the response variable has been transformed before entering the model. One strategy to ease the interpretation of the regression coefficients is to calculate the <strong>marginal effects</strong> of the model for specific values of the predictor.</p>
<section id="marginal-effects" class="level2 page-columns page-full"><h2 class="anchored" data-anchor-id="marginal-effects">Marginal effects</h2>
<p>Defining <strong><em>marginal effect</em></strong> is tricky. As it happens with many concepts and labels in statistics, the same label may be used to refer to different concepts, and several labels may be used interchangeably to refer to the same concept. Each subfield of science seems to use a somewhat intrinsic lexicon, which sometimes leads to confusion. I will adopt the terminology in the documentation of the <strong>{marginaleffects}</strong> R package <span class="citation" data-cites="arel-bundock2022marginaleffects">(<a href="#ref-arel-bundock2022marginaleffects" role="doc-biblioref">Arel-Bundock, 2022</a>)</span>, in which a marginal effect is defined in the context of regression as:</p>
<div class="no-row-height column-margin column-container"><div id="ref-arel-bundock2022marginaleffects" class="csl-entry" role="doc-biblioentry">
Arel-Bundock, V. (2022). <em>Marginaleffects: Marginal effects, marginal means, predictions, and contrasts</em>. <a href="https://CRAN.R-project.org/package=marginaleffects">https://CRAN.R-project.org/package=marginaleffects</a>
</div><div class="">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><a href="https://user-images.githubusercontent.com/987057/134899484-e3392510-2e94-4c39-9830-53356fa5feed.png"><img src="https://user-images.githubusercontent.com/987057/134899484-e3392510-2e94-4c39-9830-53356fa5feed.png" class="img-fluid figure-img" width="100"></a></p>
<p></p><figcaption class="figure-caption">The <strong>{marginaleffects}</strong> R package</figcaption><p></p>
</figure>
</div>
</div></div>
<blockquote class="blockquote">
<p>[…] the association between a change in a regressor <span class="math inline">\(x\)</span> and a change in the response <span class="math inline">\(y\)</span>. Put differently, the marginal effect is the slope of the prediction function, measured at a specific value of the regressor <span class="math inline">\(x\)</span>.</p>
</blockquote>
<p>According to this definition, calculating the marginal effect of our predictor of interest <code>flipper_length_mm</code> means <strong>extracting its slope for a specific value of the predictor</strong>. For linear regression models, this is trivial: since the relationship between the predictor and the response variable is assumed linear, the slope is considered constant across the whole range of the values of the predictor, and therefore its marginal effect is identical for all of them.</p>
<p>We can prove this by looking at the estimates of our (linear) model in the logit scale. Let’s say that we are interested in finding out the slope of <code>flipper_length_mm</code> for its average, 190.1027397. A slope is just a difference. And a difference is a derivative. And the linear regression function, <span class="math inline">\(y = \beta_0 + \beta_1 x\)</span>, is a function that can be derived (see <a href="#eq-linear-derivative">Equation&nbsp;10</a>).</p>
<p><span id="eq-linear-derivative"><span class="math display">\[
\begin{aligned}
y &amp;= \beta_0 + \beta_1 \times \text{Flipper length} \\
y' &amp;= \beta_1 &amp; \text{First derivative}
\end{aligned}
\tag{10}\]</span></span></p>
<p>The derivative of the linear regression equation is a <strong>constant</strong>. This constant corresponds to the regression coefficient of <code>flipper_length_mm</code>, which means that the difference in probability of being a male penguin is going to be same for two penguins whose flippers are 180 mm and 185 mm, respectively, and for two penguins whose flippers are 190 and 195 mm, respectively.</p>
<p>Take a look at <a href="#fig-linear-derivative">Figure&nbsp;6</a>. The difference in chances of being male between each pair of penguins, in the logit scale, is the same: 0.64, which corresponds to five times the <code>flipper_length_mm</code> regression coefficient because in both cases the difference in flipper length is not 1 mm but 5 mm (<span class="math inline">\(5 \times 0.1271 = 0.635\)</span>). But, again, any value in the logit scale is difficult to interpret by itself, so we are interested in translating this to the scale of probabilities.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># predictions of model with unstandardised age</span></span>
<span><span class="va">point_preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>flipper_length_mm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">180</span>, <span class="fl">185</span>, <span class="fl">190</span>, <span class="fl">195</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>sex_pred <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">.</span>, type <span class="op">=</span> <span class="st">"link"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">my_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">flipper_length_mm</span>, <span class="va">sex_pred_logit</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>               colour <span class="op">=</span> <span class="st">"grey"</span>,</span>
<span>               linetype <span class="op">=</span> <span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">flipper_length_mm</span>, y <span class="op">=</span> <span class="va">sex_pred_logit</span><span class="op">)</span>,</span>
<span>              size <span class="op">=</span> <span class="fl">1</span>,</span>
<span>              colour <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span>, xend <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>                     y <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span>, yend <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                 linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span>, xend <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span>, </span>
<span>                     y <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span>, yend <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                 linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>,</span>
<span>             label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">point_preds</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span><span class="op">-</span><span class="va">point_preds</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">" increment"</span><span class="op">)</span>,</span>
<span>             x <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>             y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">point_preds</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span>, <span class="va">point_preds</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             hjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, </span>
<span>             label <span class="op">=</span> <span class="st">"5 cm difference"</span>,</span>
<span>             x <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">]</span>, </span>
<span>             y <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">]</span>, </span>
<span>             hjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>,</span>
<span>             vjust <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">]</span>, xend <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>                     y <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">]</span>, yend <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                 linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">1</span><span class="op">]</span>, xend <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">1</span><span class="op">]</span>, </span>
<span>                     y <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">]</span>, yend <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                 linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, </span>
<span>             label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent</a></span><span class="op">(</span><span class="va">point_preds</span><span class="op">[</span><span class="fl">4</span>, <span class="fl">2</span><span class="op">]</span><span class="op">-</span><span class="va">point_preds</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="st">" increment"</span><span class="op">)</span>,</span>
<span>             x <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">4</span>, <span class="fl">1</span><span class="op">]</span>, </span>
<span>             y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">point_preds</span><span class="op">[</span><span class="fl">4</span>, <span class="fl">2</span><span class="op">]</span>, <span class="va">point_preds</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             hjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, </span>
<span>             label <span class="op">=</span> <span class="st">"5 cm difference"</span>,</span>
<span>             x <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">]</span>, </span>
<span>             y <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">]</span>, </span>
<span>             hjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>,</span>
<span>             vjust <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, </span>
<span>             label <span class="op">=</span> <span class="st">"5 cm difference"</span>,</span>
<span>             x <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span>, </span>
<span>             y <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span>, </span>
<span>             hjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>,</span>
<span>             vjust <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Flipper length (mm)"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"P(male) [logit scale]"</span>,</span>
<span>         title <span class="op">=</span> <span class="st">"&lt;span style = 'color:#003f5c;'&gt;Slope (logit scale)&lt;/span&gt;"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">my_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">flipper_length_mm</span>, <span class="va">sex_pred</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">[</span><span class="st">"flipper_length_mm"</span><span class="op">]</span>,</span>
<span>               size <span class="op">=</span> <span class="fl">1</span>, colour <span class="op">=</span> <span class="st">"#ffa600"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"label"</span>, </span>
<span>             label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Constant = "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">[</span><span class="st">"flipper_length_mm"</span><span class="op">]</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             fill <span class="op">=</span> <span class="st">"#ffa600"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>, colour <span class="op">=</span> <span class="st">"black"</span>, label.size <span class="op">=</span> <span class="fl">0</span>,</span>
<span>             x <span class="op">=</span> <span class="va">my_data</span><span class="op">$</span><span class="va">flipper_length_mm</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span><span class="op">(</span><span class="va">my_data</span><span class="op">$</span><span class="va">derivative</span><span class="op">)</span><span class="op">]</span>,</span>
<span>             y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">[</span><span class="st">"flipper_length_mm"</span><span class="op">]</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>             vjust <span class="op">=</span> <span class="op">-</span><span class="fl">1.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Flipper length (mm)"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"Slope of flipper length (logit scale)"</span>,</span>
<span>         title <span class="op">=</span> <span class="st">"&lt;span style = 'color:#ffa600;'&gt;Derivative (logit scale)&lt;/span&gt;"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    </span>
<span>    <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html">plot_layout</a></span><span class="op">(</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>    <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html">plot_annotation</a></span><span class="op">(</span>tag_levels <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>          plot.title <span class="op">=</span> <span class="fu"><a href="https://wilkelab.org/ggtext/reference/element_markdown.html">element_markdown</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-linear-derivative" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="logistic-regression_files/figure-html/fig-linear-derivative-1.png" class="img-fluid figure-img" width="4800"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;6: The derivative of a linear regression equation is a constant.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>We have seen that regression coefficients do not behave identically for different values of their predictors when transformed into probabilities. The exact point of <code>flipper_length_mm</code> at which we calculate its marginal effect matters. This is because the derivative of the logistic function, which describes the behaviour of the probability scale we just moved to, is no longer a constant. See <a href="#eq-logistic-derivative">Equation&nbsp;11</a>.</p>
<p><span id="eq-logistic-derivative"><span class="math display">\[
\begin{aligned}
y &amp;= \frac{1}{1 + e^{(-\beta x)}} &amp; \text{Logistic function} \\
y' &amp;= \frac{\beta_1 · e^{\beta_0 + \beta_1 · \ \text{Flipper length}} }{(1 + e^{-(\beta_0 + \beta_1 · \ \text{Flipper length})})^2} &amp; \text{Derivative}
\end{aligned}
\tag{11}\]</span></span></p>
<p>The derivative of the logistic function still takes into account the value of the predictor (<span class="math inline">\(\text{Flipper length}\)</span>), which means that the value of the derivative changes depending on such value. Let’s try to visualise this. First, we are going to implement the derivative of the logistic function as an R function that computes it for the <code>fit</code> model:</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">logistic_derivative</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">object</span>, <span class="va">x</span>, <span class="va">value</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">slope</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span><span class="op">[</span><span class="va">x</span><span class="op">]</span></span>
<span>    <span class="va">intercept</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">object</span><span class="op">)</span><span class="op">[</span><span class="st">"(Intercept)"</span><span class="op">]</span></span>
<span>    <span class="va">numerator</span> <span class="op">&lt;-</span> <span class="va">slope</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="va">intercept</span> <span class="op">+</span> <span class="op">(</span><span class="va">slope</span> <span class="op">*</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">denominator</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="va">intercept</span> <span class="op">+</span> <span class="op">(</span><span class="va">slope</span> <span class="op">*</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span>
<span>    <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">numerator</span><span class="op">/</span><span class="va">denominator</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><a href="#fig-logistic-derivative">Figure&nbsp;7</a> shows how the derivative changes for each value of the predictor. As you can see, the difference in probability of being male is largest at around 190 mm, while such difference decreases as <code>flipper_length_mm</code> shifts away from 190 mm.</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># model predictions (on the probability scale by default)</span></span>
<span><span class="va">my_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    <span class="va">my_data</span>,</span>
<span>    derivative <span class="op">=</span> <span class="fu">logistic_derivative</span><span class="op">(</span></span>
<span>        <span class="va">fit</span>, </span>
<span>        <span class="st">"flipper_length_mm"</span>,</span>
<span>        <span class="va">flipper_length_mm</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">point_preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>flipper_length_mm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">180</span>, <span class="fl">185</span>, <span class="fl">190</span>, <span class="fl">195</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>sex_pred <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit</span>, <span class="va">.</span><span class="op">)</span><span class="op">)</span>,</span>
<span>           derivate <span class="op">=</span> <span class="fu">logistic_derivative</span><span class="op">(</span><span class="va">fit</span>, <span class="st">"flipper_length_mm"</span>, <span class="va">flipper_length_mm</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># predictions of model with unstandardised age</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">my_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">flipper_length_mm</span>, <span class="va">sex_pred</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="co"># plot observations</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>, </span>
<span>               shape <span class="op">=</span> <span class="fl">1</span>,</span>
<span>               size <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>               stroke <span class="op">=</span> <span class="fl">1</span>,</span>
<span>               position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_jitter.html">position_jitter</a></span><span class="op">(</span>height <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>               alpha <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>               colour <span class="op">=</span> <span class="st">"grey"</span>,</span>
<span>               linetype <span class="op">=</span> <span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">flipper_length_mm</span>, y <span class="op">=</span> <span class="va">sex_pred</span><span class="op">)</span>,</span>
<span>              size <span class="op">=</span> <span class="fl">1</span>,</span>
<span>              colour <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="co"># plot intercept (y when x = 0)</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">[</span><span class="st">"(Intercept)"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>               linetype <span class="op">=</span> <span class="st">"dashed"</span>,</span>
<span>               colour <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span>  <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span>, xend <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>                     y <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span>, yend <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                 linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span>, xend <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span>, </span>
<span>                     y <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span>, yend <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                 linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, </span>
<span>             label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent</a></span><span class="op">(</span><span class="va">point_preds</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span><span class="op">-</span><span class="va">point_preds</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="st">" increment"</span><span class="op">)</span>,</span>
<span>             x <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>             y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">point_preds</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span>, <span class="va">point_preds</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, hjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, </span>
<span>             label <span class="op">=</span> <span class="st">"5 cm difference"</span>,</span>
<span>             x <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span>, </span>
<span>             y <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span>, </span>
<span>             hjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>,</span>
<span>             vjust <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">1</span><span class="op">]</span>, xend <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>                     y <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">]</span>, yend <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                 linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">1</span><span class="op">]</span>, xend <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">1</span><span class="op">]</span>, </span>
<span>                     y <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">]</span>, yend <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>                 linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>,</span>
<span>             label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent</a></span><span class="op">(</span><span class="va">point_preds</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">2</span><span class="op">]</span><span class="op">-</span><span class="va">point_preds</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="st">" increment"</span><span class="op">)</span>,</span>
<span>             x <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>             y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">point_preds</span><span class="op">[</span><span class="fl">4</span>,<span class="fl">2</span><span class="op">]</span>, <span class="va">point_preds</span><span class="op">[</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, </span>
<span>             hjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, </span>
<span>             label <span class="op">=</span> <span class="st">"5 cm difference"</span>,</span>
<span>             x <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">]</span>, </span>
<span>             y <span class="op">=</span> <span class="va">point_preds</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">]</span>, </span>
<span>             hjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>,</span>
<span>             vjust <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Flipper length (mm)"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"P(male)"</span>,</span>
<span>         title <span class="op">=</span> <span class="st">"&lt;span style = 'color:#003f5c;'&gt;Logistic curve&lt;/span&gt;,</span></span>
<span><span class="st">        &lt;span style = 'color:#ff6361;'&gt;intercept&lt;/span&gt;"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="va">percent</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.25</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">my_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">flipper_length_mm</span>, </span>
<span>                        <span class="fu">logistic_derivative</span><span class="op">(</span><span class="va">fit</span>, <span class="st">"flipper_length_mm"</span>, value <span class="op">=</span> <span class="va">flipper_length_mm</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span>, colour <span class="op">=</span> <span class="st">"#ffa600"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">flipper_length_mm</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span><span class="op">(</span><span class="va">derivative</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                     xend <span class="op">=</span> <span class="va">flipper_length_mm</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span><span class="op">(</span><span class="va">derivative</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                     y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">derivative</span><span class="op">)</span>, yend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">derivative</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                 colour <span class="op">=</span> <span class="st">"grey"</span>, linetype <span class="op">=</span> <span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"label"</span>, label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Max = "</span>, <span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">my_data</span><span class="op">$</span><span class="va">derivative</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             fill <span class="op">=</span> <span class="st">"#ffa600"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>, colour <span class="op">=</span> <span class="st">"black"</span>, label.size <span class="op">=</span> <span class="fl">0</span>,</span>
<span>             x <span class="op">=</span> <span class="va">my_data</span><span class="op">$</span><span class="va">flipper_length_mm</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span><span class="op">(</span><span class="va">my_data</span><span class="op">$</span><span class="va">derivative</span><span class="op">)</span><span class="op">]</span>,</span>
<span>             y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">my_data</span><span class="op">$</span><span class="va">derivative</span><span class="op">)</span><span class="op">*</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Flipper length (mm)"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"Slope of flipper length  (probability scale)"</span>,</span>
<span>         title <span class="op">=</span> <span class="st">"&lt;span style = 'color:#ffa600;'&gt;Derivative&lt;/span&gt;"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="va">percent</span><span class="op">)</span> <span class="op">+</span></span>
<span>    </span>
<span>    <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html">plot_layout</a></span><span class="op">(</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>    <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html">plot_annotation</a></span><span class="op">(</span>tag_levels <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>          plot.title <span class="op">=</span> <span class="fu"><a href="https://wilkelab.org/ggtext/reference/element_markdown.html">element_markdown</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div id="fig-logistic-derivative" class="quarto-figure quarto-figure-center anchored">
<figure class="figure"><p><img src="logistic-regression_files/figure-html/fig-logistic-derivative-1.png" class="img-fluid figure-img" width="5400"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;7: The derivative of a non-linear regression equation is not constant.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>The maximum change in the probability of being male is 3%, which occurs at around 190 mm flipper length. There is a smarter way of calculating the maximum slope of <code>flipper_length_mm</code>. This value will always occur at the mid-point of the logistic curve, and it turns out that to find the derivative of the logistic function at the mid-point (i.e., for <span class="math inline">\(x = x_0\)</span>), we only need to find <span class="math inline">\(\beta /4\)</span>, where <span class="math inline">\(\beta\)</span> is the regression coefficient of our predictor of interest! This is called the divide-by-four-rule, and is a simple trick to report the coefficients of a logistic regression model in the scale of probabilities, and for meaningful values of the predictors (the value at which the slope is maximum). This way, we could just divide the regression coefficient of <code>flipper_length_mm</code> by four to get the maximum probability difference of being male between two penguins with flipper lengths <span class="math inline">\(x\)</span> and <span class="math inline">\(x + 1\)</span>.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
The divide-by-four rule
</div>
</div>
<div class="callout-body-container callout-body">
<p>Dividing the coefficients of a logistic regression model (in the logit scale) gets us the maximum slope of the predictor in the probability scale. We mentioned that this has to do with the derivative of the logistic function at the mid-point.</p>
<p>But since we dropped that term some equations ago after setting it at zero, it is no longer clear how one would derive the logistic function in such way that the divide-by-four rule holds. Let’s go back to <a href="#eq-upper">Equation&nbsp;2</a>, when the mid-point still appeared in our equation. We derive this formula:</p>
<p><span class="math display">\[
\begin{aligned}
\text{Logistic(x)} &amp;= \frac{1}{1 + e^{(-\beta \ · \ (x-x_0))}} &amp; \text{Logistic function}\\
\text{Logistic'(x)} &amp;= \frac{\beta · e^{-\beta (x-x_0)}}{(1 + e^{-\beta (x-x_0)})^2} &amp; \text{Derivative}
\end{aligned}
\]</span></p>
<p>And since <span class="math inline">\(x = x_0\)</span>, <span class="math inline">\(x-x_0 = 0\)</span>. We can simplify the derivative now, knowing that <span class="math inline">\(e^0 = 1\)</span>.</p>
<p><span class="math display">\[
\text{Logistic'(x)} = \frac{\beta · e^0}{(1 + e^0)^2} = \frac{\beta}{(1 + 1)^2} = \frac{\beta}{4}
\]</span></p>
<p>Take a look at the previously cited <a href="https://www.tjmahr.com/anatomy-of-a-logistic-growth-curve/">blog post by TJ Mahr</a> for a derivation that also includes the asymptote term in the logistic function.</p>
</div>
</div>
<p>Let’s put the divide-by-four rule to test. The output of <code>logistic_derivative()</code> that we defined before should, when solved for the mid-point of the logistic curve, return an equivalent value to <span class="math inline">\(\beta_1 / 4\)</span>, where <span class="math inline">\(\beta_1 = 0.1271495\)</span>, and therefore return something close to 0.0317874. We don’t know what value of <code>flipper_length_mm</code> corresponds to the mid-point. In <a href="#fig-logistic-derivative">Figure&nbsp;7</a> we calculated it my finding the value of <code>flipper_length_mm</code> for which <code>logistic_derivative()</code> returned the maximum value:</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">derivative_values</span> <span class="op">&lt;-</span> <span class="fu">logistic_derivative</span><span class="op">(</span><span class="va">fit</span>, <span class="st">"flipper_length_mm"</span>, <span class="va">my_data</span><span class="op">$</span><span class="va">flipper_length_mm</span><span class="op">)</span></span>
<span><span class="va">my_data</span><span class="op">$</span><span class="va">flipper_length_mm</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span><span class="op">(</span><span class="va">derivative_values</span><span class="op">)</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 190</code></pre>
</div>
</div>
<p>From our data, we find that the maximum slope of <code>flipper_length_mm</code> occurs at 190. But finding the mid-point this way requires us to have already calculated the derivative of the logistic function. There is an alternative way to compute this mid-point from the estimated coefficients of the regression model. An additional benefit of computing the mid-point this way is that we are doing so by relying on model-projections, and therefore in a way that does not entirely rely on the range of values of the predictor for which we have computed the derivative of the logistic function. This method consists of <a href="#eq-midpoint-coefs">Equation&nbsp;12</a>.</p>
<p><span id="eq-midpoint-coefs"><span class="math display">\[
x_0 = -\beta_0 / \beta_1
\tag{12}\]</span></span></p>
<p>Where <span class="math inline">\(\beta\)</span> is the intercept of the regression model, and <span class="math inline">\(\beta_1\)</span> is the regression coefficient of the predictor we are calculating the mid-point for. We can implement this formula in R as:</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># get point in x at the inflection point (where y = 0.5)</span></span>
<span><span class="va">get_mid</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">coefs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">mid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="op">-</span><span class="va">coefs</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">mid</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">get_mid</span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept) 
   190.0882 </code></pre>
</div>
</div>
<p>Using this function, we find that the mid-point is located at flipper length 190.0882 mm, pretty close to what we had estimated from our data. This value can sometimes be extremely interesting!</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
A personal experience
</div>
</div>
<div class="callout-body-container callout-body">
<p>In my PhD, I investigated how the age at which toddlers and children learn particular words is affected by participant-level (e.g., age, amount of linguistic exposure) and word-level characteristics (e.g., word length, lexical frequency). I used logistic regression to model the probability of a given toddler having learnt a word, adjusting for my predictors of interest, the most important of them being the age of the child. Older children are more likely to have learnt a given word than younger children.</p>
<p>My model returned, among others, a coefficient for <code>age</code> in the logit scale, but I wasn’t particularly interested in it, even after having transformed it to the probability scale. I was, however, more interested in finding the value of age at which most children were learning each word, which corresponded to the mid-point of the logistic curve for the age predictor!</p>
</div>
</div>
<p>Now that we have calculated the mid-point of our logistic function, we can finally compare the <strong>divide-by-four rule</strong> against the actual value of the <strong>derivative of the logistic function</strong>. If we solve <a href="#eq-logistic-derivative">Equation&nbsp;11</a> for <span class="math inline">\(x_0 = 190.0882\)</span> using <code>logistic_derivative(fit, "flipper_length_mm", 190.0882)</code>, we get that the mid-point is located at 0.0317874. If we use the divide-by-four rule, we get 0.0317874. Exactly the same!</p>
<p>So far, we have seen that the divide-by-four rule is a simple way to obtain the slope at the mid-point, which is a meaningful value: it tells us the upper limit of the distribution of the regression slope of the predictor. However, there might be other values of the predictor for which we might be interested in finding the slope of the coefficient. We might even want to compute the average of all slopes! These, an others, are different perspectives to adopt when thinking, computing, and reporting marginal effects.</p>
<p>I cannot say anything that has not already been explained better by Andrew Heiss in his blog post: <a href="https://www.andrewheiss.com/blog/2022/05/20/marginalia/">Marginalia: A guide to figuring out what the heck marginal effects, marginal slopes, average marginal effects, marginal effects at the mean, and all these other marginal things are</a> <span class="citation" data-cites="heiss2022marginalia">(<a href="#ref-heiss2022marginalia" role="doc-biblioref">Heiss, 2022</a>)</span>. I will only mention that to compute the marginal effects of your model, regardless of your strategy towards reporting marginal effects (maximum slope, average marginal effects, marginal effects at specific points), or the characteristics of your model (Gaussian vs.&nbsp;binomial, logit vs.&nbsp;probit, Bayesian vs.&nbsp;frequentist, etc.), the <code>marginaleffects</code> R package will be useful. Take a look at its documentation and functions, and play with them.</p>
<div class="no-row-height column-margin column-container"><div id="ref-heiss2022marginalia" class="csl-entry" role="doc-biblioentry">
Heiss, A. (2022, May 20). <em>Marginalia: A guide to figuring out what the heck marginal effects, marginal slopes, average marginal effects, marginal effects at the mean, and all these other marginal things are <span></span> andrew heiss. Andrew heiss</em>. <a href="https://www.andrewheiss.com/blog/2022/05/20/marginalia/">https://www.andrewheiss.com/blog/2022/05/20/marginalia/</a>
</div></div></section></section><section id="combining-our-findings" class="level1"><h1>Combining our findings</h1>
<p>We have learnt how logistic regression exploits the numerical properties of the <strong>logit</strong> function to use a simple linear regression model to model probabilities, or any other variable covering the <span class="math inline">\([0, 1]\)</span> interval. We have learnt that due to the <strong>non-linear relationship between probabilities and logits</strong>, we need to be careful when interpreting the outcome of the model. We have found that, depending on the value of the predictor for which we find the slope in the probability scale, we may find effects of different sizes, and that we can use the <strong>divide-by-four</strong> rule to report the maximum change in probabilities associated with any change in the predictor. We have also considered how to estimate the mid-point of the logistic curve, which is often interesting since it tells us the value of the predictor at which its effect is largert. We can express all those interesting values in the following graph:</p>
<div class="cell">
<details><summary>Code</summary><div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># get point in x at the intercept of a line with slope beta/4 that passes through 0.5</span></span>
<span><span class="co"># this function assumes that lower and upper bounds of the logistic curve are 0 and 1</span></span>
<span><span class="co"># under these conditions, 0.5 will always be the inflection point of the logistic curve</span></span>
<span><span class="va">get_mid_intercept</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">mid</span> <span class="op">&lt;-</span> <span class="fu">get_mid</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>    <span class="va">slope</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="fl">4</span></span>
<span>    <span class="va">mid_intercept</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">-</span><span class="va">slope</span><span class="op">*</span><span class="va">mid</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.5</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">mid_intercept</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># predictions of model with unstandardised age</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">my_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">flipper_length_mm</span>, <span class="va">sex_pred</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="co"># plot observations</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>, </span>
<span>               shape <span class="op">=</span> <span class="fl">1</span>,</span>
<span>               size <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>               stroke <span class="op">=</span> <span class="fl">1</span>,</span>
<span>               position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_jitter.html">position_jitter</a></span><span class="op">(</span>height <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>               alpha <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>               colour <span class="op">=</span> <span class="st">"grey"</span>,</span>
<span>               linetype <span class="op">=</span> <span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">flipper_length_mm</span>, y <span class="op">=</span> <span class="va">sex_pred</span><span class="op">)</span>,</span>
<span>              size <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>              colour <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="co"># plot intercept (y when x = 0)</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">[</span><span class="st">"(Intercept)"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>               linetype <span class="op">=</span> <span class="st">"dashed"</span>,</span>
<span>               colour <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span>  <span class="op">+</span></span>
<span>    <span class="co"># plot mid point (x when y = 0.5)</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu">get_mid</span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>,</span>
<span>               linetype <span class="op">=</span> <span class="st">"dashed"</span>,</span>
<span>               colour <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="co"># plot slope when x = mid point (approximated derivative of the logistic curve)</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span><span class="op">(</span></span>
<span>        slope <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">[</span><span class="st">"flipper_length_mm"</span><span class="op">]</span> <span class="op">/</span> <span class="fl">4</span>,</span>
<span>        intercept <span class="op">=</span> <span class="fu">get_mid_intercept</span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>,</span>
<span>        size <span class="op">=</span> <span class="fl">0.75</span>,</span>
<span>        colour <span class="op">=</span> <span class="va">clrs</span><span class="op">[</span><span class="fl">5</span><span class="op">]</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"label"</span>, label <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">[</span><span class="st">"flipper_length_mm"</span><span class="op">]</span> <span class="op">/</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>             fill <span class="op">=</span> <span class="st">"#ffa600"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>, colour <span class="op">=</span> <span class="st">"black"</span>, label.size <span class="op">=</span> <span class="fl">0</span>,</span>
<span>             x <span class="op">=</span> <span class="fu">get_mid</span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">+</span><span class="fl">5</span>, y <span class="op">=</span> <span class="fl">0.5</span>, label.r <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0</span>, <span class="st">"lines"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"label"</span>, label <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/percent_format.html">percent</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">[</span><span class="st">"(Intercept)"</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             fill <span class="op">=</span> <span class="st">"#ff6361"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>, colour <span class="op">=</span> <span class="st">"black"</span>, label.size <span class="op">=</span> <span class="fl">0</span>,</span>
<span>             x <span class="op">=</span> <span class="fl">200</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">[</span><span class="st">"(Intercept)"</span><span class="op">]</span><span class="op">)</span><span class="op">+</span><span class="fl">0.1</span>,</span>
<span>             label.r <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0</span>, <span class="st">"lines"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotate.html">annotate</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"label"</span>, label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu">get_mid</span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>             fill <span class="op">=</span> <span class="st">"#58508d"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>, colour <span class="op">=</span> <span class="st">"black"</span>, label.size <span class="op">=</span> <span class="fl">0</span>,</span>
<span>             x <span class="op">=</span> <span class="fu">get_mid</span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span>, y <span class="op">=</span> <span class="fl">0.6</span>, hjust <span class="op">=</span> <span class="fl">1</span>,</span>
<span>             label.r <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">0</span>, <span class="st">"lines"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Flipper length (mm)"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"Sex"</span>,</span>
<span>         title <span class="op">=</span> <span class="st">"&lt;span style = 'color:#003f5c;'&gt;Logistic curve&lt;/span&gt;,</span></span>
<span><span class="st">&lt;span style = 'color:#ff6361;'&gt;intercept&lt;/span&gt;,</span></span>
<span><span class="st">&lt;span style = 'color:#58508d;'&gt;mid-point&lt;/span&gt;,</span></span>
<span><span class="st">&lt;span style = 'color:#ffa600;'&gt;derivative at mid-point&lt;/span&gt;"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>linetype <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="va">percent</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.25</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>          plot.title <span class="op">=</span> <span class="fu"><a href="https://wilkelab.org/ggtext/reference/element_markdown.html">element_markdown</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details><div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="logistic-regression_files/figure-html/predictions-natural-probability-1.png" class="img-fluid figure-img" width="4800"></p>
<p></p><figcaption class="figure-caption">Intercept, mid-point, and derivative at mid-point of the logistic function, drawn with the parameters estimated by a logistic regression model on the {palmerpenguins} dataset.</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Expand for Session Info
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>─ Session info ───────────────────────────────────────────────────────────────
 setting  value
 version  R version 4.2.2 (2022-10-31 ucrt)
 os       Windows 10 x64 (build 19045)
 system   x86_64, mingw32
 ui       RTerm
 language (EN)
 collate  English_United Kingdom.utf8
 ctype    English_United Kingdom.utf8
 tz       Europe/Paris
 date     2023-02-02
 pandoc   2.19.2 @ C:/Program Files/RStudio/resources/app/bin/quarto/bin/tools/ (via rmarkdown)
 quarto   1.2.269 @ C:\\PROGRA~1\\RStudio\\RESOUR~1\\app\\bin\\quarto\\bin\\quarto.exe

─ Packages ───────────────────────────────────────────────────────────────────
 ! package        * version date (UTC) lib source
 P dplyr          * 1.0.10  2022-09-01 [?] CRAN (R 4.2.2)
 P ggdist         * 3.2.1   2023-01-18 [?] CRAN (R 4.2.2)
 P ggplot2        * 3.4.0   2022-11-04 [?] CRAN (R 4.2.2)
 P ggtext         * 0.1.2   2022-09-16 [?] CRAN (R 4.2.2)
 P glue           * 1.6.2   2022-02-24 [?] CRAN (R 4.2.2)
 P palmerpenguins * 0.1.1   2022-08-15 [?] CRAN (R 4.2.2)
 P patchwork      * 1.1.2   2022-08-19 [?] CRAN (R 4.2.2)
 P purrr          * 1.0.0   2022-12-20 [?] CRAN (R 4.2.2)
 P quarto         * 1.2     2022-07-06 [?] CRAN (R 4.2.2)
 P scales         * 1.2.1   2022-08-20 [?] CRAN (R 4.2.2)
 P sessioninfo    * 1.2.2   2021-12-06 [?] CRAN (R 4.2.2)
 P stringr        * 1.5.0   2022-12-02 [?] CRAN (R 4.2.2)
 P tibble         * 3.1.8   2022-07-22 [?] CRAN (R 4.2.2)
 P tidyr          * 1.2.1   2022-09-08 [?] CRAN (R 4.2.2)

 [1] C:/Users/u155880/Documents/gongcastro.github.io/renv/library/R-4.2/x86_64-w64-mingw32
 [2] C:/Users/u155880/AppData/Local/Temp/RtmpUPUz5H/renv-system-library

 P ── Loaded and on-disk path mismatch.

──────────────────────────────────────────────────────────────────────────────</code></pre>
</div>
</div>
</div>
</div>
</div>


<!-- -->


</section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div quarto-reuse="quarto-reuse" class="quarto-appendix-contents"><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{garcia-castro2023,
  author = {Gonzalo Garcia-Castro},
  title = {Getting the Most Out of Logistic Regression},
  date = {2023-01-22},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-garcia-castro2023" class="csl-entry quarto-appendix-citeas" role="doc-biblioentry">
Gonzalo Garcia-Castro. (2023, January 22). <em>Getting the most out of
logistic regression</em>.
</div></div></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
    var links = window.document.querySelectorAll('a:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script><script src="https://giscus.app/client.js" data-repo="gongcastro/gongcastro.github.io" data-repo-id="R_kgDOGJ9lfQ" data-category="Blog comments" data-category-id="R_kgDOGJ9lfQ" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb26" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Getting the most out of logistic regression"</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="an">description:</span><span class="co"> "Logistic regression models provide information way beyond a *p*-value. Using the {palmerpenguins} dataset, I review the relationship between the logistic and the logit functions, and how to interpret the coefficients of a logistic regression model, capitalising on marginal effects."</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> 2023-01-22</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="an">image:</span><span class="co"> predictions-natural-probability-1.png</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="an">categories:</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="co">  - r</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="co">  - tidyverse</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="co">  - regression</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="co">  - statistics</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="co">  - logistic</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> html</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="an">from:</span><span class="co"> markdown+emoji</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="an">code-fold:</span><span class="co"> true</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="an">reference-location:</span><span class="co"> margin</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="an">warning:</span><span class="co"> false</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="an">message:</span><span class="co"> false</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="an">fig-align:</span><span class="co"> center</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a><span class="an">fig-dpi:</span><span class="co"> 600</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: setup</span></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggtext)</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)</span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggdist)</span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(palmerpenguins)</span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(</span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme</span>(</span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a>            <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="fl">0.65</span>),</span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a>            <span class="at">panel.grid =</span> <span class="fu">element_blank</span>()</span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a>        ))</span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a>clrs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#003f5c"</span>, <span class="st">"#58508d"</span>, <span class="st">"#bc5090"</span>, <span class="st">"#ff6361"</span>, <span class="st">"#ffa600"</span>)</span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a><span class="al">![Some Adelie penguins ready to be logisticised.](penguins.jpg)</span></span>
<span id="cb26-50"><a href="#cb26-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; **Logistic regression** is a conventional way to model binary outcomes. This post is an attempt to summarise my recent learning progress on this topic, addressed to my previous self who knew how to *use* logistic regression but had very superficial knowledge of what happens under the hood. Not to mention writing this post has been a fantastic learning experience. I hope its useful.</span></span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true" tabindex="-1"></a><span class="fu"># The logistic function</span></span>
<span id="cb26-54"><a href="#cb26-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-55"><a href="#cb26-55" aria-hidden="true" tabindex="-1"></a>The **logistic function** is a mathematical function that defines how the values of an input variable $x$ that span the range of real values $x \in (-\infty, +\infty)$ are associated to an output variable $y$ that spans an interval of real values contained within the $[0, 1]$ interval or narrower. This function is **monotonic**: $y$ increases for $x &gt; 0$ and increases for $x &lt; 0$, or decreases for $x &gt; 0$ and increases for $x &lt; 0$. This function takes the general form shown in @eq-logistic-three:</span>
<span id="cb26-56"><a href="#cb26-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-57"><a href="#cb26-57" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb26-58"><a href="#cb26-58" aria-hidden="true" tabindex="-1"></a>\text{Logistic(x)} = \frac{L}{1 + e^{(-\beta \ · \ (x-x_0))}}</span>
<span id="cb26-59"><a href="#cb26-59" aria-hidden="true" tabindex="-1"></a>$$ {#eq-logistic-three}</span>
<span id="cb26-60"><a href="#cb26-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-61"><a href="#cb26-61" aria-hidden="true" tabindex="-1"></a>Where:</span>
<span id="cb26-62"><a href="#cb26-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-63"><a href="#cb26-63" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$L$ is the **upper limit** of $y$, which is commonly assumed to be 1, where $L \in (0, +\infty)$.</span>
<span id="cb26-64"><a href="#cb26-64" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$\beta$ is a coefficient that indicates the **steepness** of the logistic curve, or how fast the curve grows, where $\beta \in (-\infty, +\infty)$. Positive values of this coefficient lead to the logistic curve growing as $x$ increases, to the logistic curve decays when $x$ decreases.</span>
<span id="cb26-65"><a href="#cb26-65" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>$x_0$ is the **mid-point** of the logistic curve, indicating the value of $x$ where the maximum of $\beta$ is found, that is, when the logistic curve is steepest </span>
<span id="cb26-66"><a href="#cb26-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-67"><a href="#cb26-67" aria-hidden="true" tabindex="-1"></a>I first learnt about the logistic function and its parameters in <span class="co">[</span><span class="ot">this blog post by TJ Mahr</span><span class="co">](https://www.tjmahr.com/anatomy-of-a-logistic-growth-curve/)</span> <span class="co">[</span><span class="ot">@mahr2019anatomy</span><span class="co">]</span>, in which he describes the different parameters of the function, and how they relate to its behaviour. Let's take a look at how the logistic curve looks like for different values of these parameters. We can implement the logistic function in R like this:</span>
<span id="cb26-68"><a href="#cb26-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-71"><a href="#cb26-71" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-72"><a href="#cb26-72" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-logistic-curve</span></span>
<span id="cb26-73"><a href="#cb26-73" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "An ilustration of the behaviour of the logistic function with different parameter values."</span></span>
<span id="cb26-74"><a href="#cb26-74" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb26-75"><a href="#cb26-75" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb26-76"><a href="#cb26-76" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 9</span></span>
<span id="cb26-77"><a href="#cb26-77" aria-hidden="true" tabindex="-1"></a>logistic <span class="ot">&lt;-</span> <span class="cf">function</span>(x, slope, mid, upper) {</span>
<span id="cb26-78"><a href="#cb26-78" aria-hidden="true" tabindex="-1"></a>    upper <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span>slope <span class="sc">*</span> (x <span class="sc">-</span> mid)))</span>
<span id="cb26-79"><a href="#cb26-79" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-80"><a href="#cb26-80" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-81"><a href="#cb26-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-82"><a href="#cb26-82" aria-hidden="true" tabindex="-1"></a>Now we generate a logistic curve by applying <span class="in">`logistic()`</span> to a numeric vector <span class="in">`x`</span>. We will set the steepness ($\beta$, <span class="in">`slope`</span>), mid-point ($x_0$, <span class="in">`mid`</span>), and upper limit ($L$, <span class="in">`upper`</span>) at different values for illustration. In @fig-logistic-simulation we can see how larger values of $L$, the asymptote of the logistic curve occurs at higher values, how larger values of $\beta$ make the curve steeper, and how larger values of $x_0$ make the mid-point of the curve occur at higher values of the $x$ variable.</span>
<span id="cb26-83"><a href="#cb26-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-86"><a href="#cb26-86" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-87"><a href="#cb26-87" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-logistic-simulation</span></span>
<span id="cb26-88"><a href="#cb26-88" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Logistic curves under different parameter values for the slope, the upper limit, and the mid-point."</span></span>
<span id="cb26-89"><a href="#cb26-89" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb26-90"><a href="#cb26-90" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 7.5</span></span>
<span id="cb26-91"><a href="#cb26-91" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">7</span>, <span class="dv">7</span>, <span class="fl">0.1</span>)</span>
<span id="cb26-92"><a href="#cb26-92" aria-hidden="true" tabindex="-1"></a>slope <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">1.5</span>)</span>
<span id="cb26-93"><a href="#cb26-93" aria-hidden="true" tabindex="-1"></a>mid <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb26-94"><a href="#cb26-94" aria-hidden="true" tabindex="-1"></a>upper <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.7</span>, <span class="fl">0.9</span>, <span class="dv">1</span>)</span>
<span id="cb26-95"><a href="#cb26-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-96"><a href="#cb26-96" aria-hidden="true" tabindex="-1"></a>logistic_data <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(x, slope, mid, upper) <span class="sc">%&gt;%</span> </span>
<span id="cb26-97"><a href="#cb26-97" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">logistic</span>(x, slope, mid, upper),</span>
<span id="cb26-98"><a href="#cb26-98" aria-hidden="true" tabindex="-1"></a>           <span class="at">values =</span> <span class="fu">paste0</span>(<span class="st">"slope = "</span>, <span class="fu">round</span>(slope, <span class="dv">2</span>),</span>
<span id="cb26-99"><a href="#cb26-99" aria-hidden="true" tabindex="-1"></a>                           <span class="st">", mid = "</span>, <span class="fu">round</span>(mid, <span class="dv">2</span>)))</span>
<span id="cb26-100"><a href="#cb26-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-101"><a href="#cb26-101" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(logistic_data, <span class="fu">aes</span>(x, y, <span class="at">colour =</span> values)) <span class="sc">+</span></span>
<span id="cb26-102"><a href="#cb26-102" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>upper, <span class="at">labeller =</span> <span class="fu">labeller</span>(<span class="at">upper =</span> <span class="sc">~</span><span class="fu">paste0</span>(<span class="st">"upper = "</span>, .))) <span class="sc">+</span></span>
<span id="cb26-103"><a href="#cb26-103" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.25</span>) <span class="sc">+</span></span>
<span id="cb26-104"><a href="#cb26-104" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">colour =</span> <span class="st">"Parameter values"</span>) <span class="sc">+</span></span>
<span id="cb26-105"><a href="#cb26-105" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">colour =</span> <span class="fu">guide_legend</span>(<span class="at">ncol =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb26-106"><a href="#cb26-106" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> clrs[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>)]) <span class="sc">+</span></span>
<span id="cb26-107"><a href="#cb26-107" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_line</span>(<span class="at">linetype =</span> <span class="st">"dotted"</span>, <span class="at">colour =</span> <span class="st">"grey"</span>),</span>
<span id="cb26-108"><a href="#cb26-108" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb26-109"><a href="#cb26-109" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb26-110"><a href="#cb26-110" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb26-111"><a href="#cb26-111" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="st">"left"</span>, <span class="st">"top"</span>))</span>
<span id="cb26-112"><a href="#cb26-112" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-113"><a href="#cb26-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-114"><a href="#cb26-114" aria-hidden="true" tabindex="-1"></a>You might have seen the logistic function in different forms. This might be because it can parameterised in slightly different ways (as we'll see later), or because someone decided to pick different symbols for the same parameters. Sometimes, you might even find a formula for the logistic form that includes less parameters. This is because it is common to assume that some of the parameters we have seen are constant. For instance, whenever we assume that $y$ ranges from 0 to 1 (e.g., proportions), $L$ can be assumed to be 1. See @eq-upper and note how we have replaced $L$ with 1.</span>
<span id="cb26-115"><a href="#cb26-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-116"><a href="#cb26-116" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb26-117"><a href="#cb26-117" aria-hidden="true" tabindex="-1"></a>\text{Logistic(x)} = \frac{1}{1 + e^{(-\beta \ (x-x_0))}}</span>
<span id="cb26-118"><a href="#cb26-118" aria-hidden="true" tabindex="-1"></a>$$ {#eq-upper}</span>
<span id="cb26-119"><a href="#cb26-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-120"><a href="#cb26-120" aria-hidden="true" tabindex="-1"></a>This is called the **two-parameter logistic function** because, effectively, only two parameters are left to be estimated: the steepness of the curve ($\beta$) and its mid-point ($x_0$). The two-parameter logistic regression function is the one we usually encounter in logistic regression. More general cases like the three-parameter logistic function (@eq-logistic-three) are more flexible and are used when one is particularly interested in estimating them explicitly in a statistical model. This <span class="co">[</span><span class="ot">Wikipedia article</span><span class="co">](https://en.wikipedia.org/wiki/Logistic_function)</span> suggests some historical uses of these functions, like Item Response Theory (IRT) in Psychology and Cognitive Sciences.</span>
<span id="cb26-121"><a href="#cb26-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-122"><a href="#cb26-122" aria-hidden="true" tabindex="-1"></a>It is still not clear how @eq-upper relates to a regression model, right? The coefficients returned by a conventional linear regression model---the intercept and the slope of each predictor, usually noted as $\beta_0 + \beta_1 x$---do not map perfectly into the coefficients of the logistic function in @eq-upper. These regression coefficients are meant to be in the exponential of $e$, which is $-\beta \ (x-x_0)$, but we must first make a simple change:</span>
<span id="cb26-123"><a href="#cb26-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-124"><a href="#cb26-124" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb26-125"><a href="#cb26-125" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb26-126"><a href="#cb26-126" aria-hidden="true" tabindex="-1"></a>-\beta \ (x-x_0) = -(-\beta x_0 + \beta x) = -(\beta_0 + \beta_1x)</span>
<span id="cb26-127"><a href="#cb26-127" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb26-128"><a href="#cb26-128" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb26-129"><a href="#cb26-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-130"><a href="#cb26-130" aria-hidden="true" tabindex="-1"></a>We substitute this element in @eq-upper, and we get @eq-logistic-regression:</span>
<span id="cb26-131"><a href="#cb26-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-132"><a href="#cb26-132" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb26-133"><a href="#cb26-133" aria-hidden="true" tabindex="-1"></a>\text{Logistic(x)} = \frac{1}{1 + e^{-(\beta_0 + \beta_1x)}}</span>
<span id="cb26-134"><a href="#cb26-134" aria-hidden="true" tabindex="-1"></a>$$ {#eq-logistic-regression}</span>
<span id="cb26-135"><a href="#cb26-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-136"><a href="#cb26-136" aria-hidden="true" tabindex="-1"></a>Where $\beta_0 = -kx_0$ and $\beta_1 = k$. This is how the intercept and the slope of the predictors map onto the **logistic regression equation**! This regression equation, though, is not linear. The response variable and the parameters in the equation do not have a linear relationship. To be able to exploit the convenient properties of a linear model, we need to apply some transformation to the response variable, so that the outcome *does* hold a linear relationship with the parameters of the logistic function. Let's talk about the **logit** function.</span>
<span id="cb26-137"><a href="#cb26-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-138"><a href="#cb26-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-139"><a href="#cb26-139" aria-hidden="true" tabindex="-1"></a><span class="fu"># The logit function</span></span>
<span id="cb26-140"><a href="#cb26-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-141"><a href="#cb26-141" aria-hidden="true" tabindex="-1"></a>The *logit* scale, or the *log odds* scale, was created by Joseph Berkson in 1944 as a solution to apply linear regression to a variable whose values ranged from 0 to 1 (e.g., proportions). The name *logit* scale was derived from ***log**istic un**it***. The rationale behind this function was to transform the original variable contained in the $<span class="co">[</span><span class="ot">0, 1</span><span class="co">]</span>$ interval, to a set of values ranging from $-\infty$ to $\infty$. This way, it was possible to use linear regression to binary variables while holding the assumptions of linear regression. You will frequently see the logit function expressed as in @eq-logit next to the clarification that $p$ is a value comprehended between $<span class="co">[</span><span class="ot">0, 1</span><span class="co">]</span>$, and that this function is the the inverse of the logistic function. </span>
<span id="cb26-142"><a href="#cb26-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-143"><a href="#cb26-143" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb26-144"><a href="#cb26-144" aria-hidden="true" tabindex="-1"></a>\text{Logit(x)} = \text{ln} \bigg( \frac{p}{1-p} \bigg)</span>
<span id="cb26-145"><a href="#cb26-145" aria-hidden="true" tabindex="-1"></a>$${#eq-logit}</span>
<span id="cb26-146"><a href="#cb26-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-147"><a href="#cb26-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-148"><a href="#cb26-148" aria-hidden="true" tabindex="-1"></a>It can be a bit unclear how we ended up with this formula. Let's try to reconstruct this process^<span class="co">[</span><span class="ot">For a more detailed description of the derivation of the logit function from the logistic function---and also for a exhaustive explanation of logistic regression, see [this tutorial by Hause Lin](https://hausetutorials.netlify.app/posts/2019-04-13-logistic-regression/).</span><span class="co">] [@lin2019gentle]</span>. Starting from @eq-logistic-regression:</span>
<span id="cb26-149"><a href="#cb26-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-150"><a href="#cb26-150" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb26-151"><a href="#cb26-151" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb26-152"><a href="#cb26-152" aria-hidden="true" tabindex="-1"></a>\text{Logistic}(x) &amp;= \frac{1}{1 + e^{-(\beta_0 + \beta_1x)}} <span class="sc">\\</span></span>
<span id="cb26-153"><a href="#cb26-153" aria-hidden="true" tabindex="-1"></a>&amp;= \bigg(\frac{1}{1+e^{-\beta x}} \bigg) · \bigg( \frac{e^{\beta_0 + \beta_1x}}{e^{\beta_0 + \beta_1x}} \bigg) <span class="sc">\\</span></span>
<span id="cb26-154"><a href="#cb26-154" aria-hidden="true" tabindex="-1"></a>&amp; =\frac{e^{\beta_0 + \beta_1x}}{e^{\beta_0 + \beta_1x}+1} <span class="sc">\\</span></span>
<span id="cb26-155"><a href="#cb26-155" aria-hidden="true" tabindex="-1"></a>&amp;= \frac{e^{-(\beta_0 + \beta_1x)}}{e^{-(\beta_0 + \beta_1x)} + 1} <span class="sc">\\</span></span>
<span id="cb26-156"><a href="#cb26-156" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb26-157"><a href="#cb26-157" aria-hidden="true" tabindex="-1"></a>$$ {#eq-logistic-alternative}</span>
<span id="cb26-158"><a href="#cb26-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-159"><a href="#cb26-159" aria-hidden="true" tabindex="-1"></a>The inverse of $e^{\beta_0 + \beta_1x}$ is the natural logarithm of $\beta_0 + \beta_1x$, that is, $\text{ln}(\beta_0 + \beta_1x)$. The inverse of the logistic function as expressed in @eq-logistic-alternative, and therefore the logit function, is:</span>
<span id="cb26-160"><a href="#cb26-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-161"><a href="#cb26-161" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb26-162"><a href="#cb26-162" aria-hidden="true" tabindex="-1"></a>\text{Logit}(x) = \text{Logistic}^{-1}(x) = \text{ln} \bigg( \frac{p}{1-p} \bigg)</span>
<span id="cb26-163"><a href="#cb26-163" aria-hidden="true" tabindex="-1"></a>$${#eq-logistic-inverse}</span>
<span id="cb26-164"><a href="#cb26-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-165"><a href="#cb26-165" aria-hidden="true" tabindex="-1"></a>Here, $p$ is the outcome of the logistic function, or a value in the $<span class="co">[</span><span class="ot">0, 1</span><span class="co">]</span>$ interval. This is how we get from the logistic function to the *logit* function! There are more transformations available to make variables in the $[0, 1]$ interval suitable for linear regression, like *probit*, but we won't get into them^<span class="co">[</span><span class="ot">Maybe for an upcoming post Insha'Allah</span><span class="co">]</span>. Let's now see how this takes the form of logistic regression in real data.</span>
<span id="cb26-166"><a href="#cb26-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-167"><a href="#cb26-167" aria-hidden="true" tabindex="-1"></a><span class="fu"># Our dataset</span></span>
<span id="cb26-168"><a href="#cb26-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-169"><a href="#cb26-169" aria-hidden="true" tabindex="-1"></a>::: {.column-margin}</span>
<span id="cb26-170"><a href="#cb26-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-171"><a href="#cb26-171" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="al">![](palmerpenguins.png)</span><span class="ot">{width=100px}</span><span class="co">](https://allisonhorst.github.io/palmerpenguins/)</span></span>
<span id="cb26-172"><a href="#cb26-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-173"><a href="#cb26-173" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb26-174"><a href="#cb26-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-175"><a href="#cb26-175" aria-hidden="true" tabindex="-1"></a>We'll be using the <span class="in">`penguins`</span> dataset from the **[{palmerpenguins}](https://allisonhorst.github.io/palmerpenguins/) R package** <span class="co">[</span><span class="ot">@horst2020palmerpenguins</span><span class="co">]</span>. This dataset contains anatomical measurements by researchers at Palmer Station in Antarctica, of <span class="in">`r nrow(penguins)`</span> penguins, together with some information about the sex, species, and island (for more details, see <span class="in">`?palmerpenguins::penguins`</span>). Let's first load the data and take a look at them.</span>
<span id="cb26-176"><a href="#cb26-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-179"><a href="#cb26-179" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-180"><a href="#cb26-180" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load-data</span></span>
<span id="cb26-181"><a href="#cb26-181" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb26-182"><a href="#cb26-182" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(palmerpenguins)</span>
<span id="cb26-183"><a href="#cb26-183" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"penguins"</span>, <span class="at">package =</span> <span class="st">"palmerpenguins"</span>)</span>
<span id="cb26-184"><a href="#cb26-184" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(penguins)</span>
<span id="cb26-185"><a href="#cb26-185" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-186"><a href="#cb26-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-187"><a href="#cb26-187" aria-hidden="true" tabindex="-1"></a>Say we are interested in exploring **how the flipper length of a penguin is associated to its sex**. Depending on the specific research question at hand, we would model the data in different ways. Conventionally, we may compare the flipper length of male and female penguins using the latter as a predictor. But since we are interested in logistic regression, we will try to predict the sex of penguins (binary response variable, <span class="in">`female`</span>/<span class="in">`male`</span>), based on their flipper length (continuous predictor variable, in millimetres).</span>
<span id="cb26-188"><a href="#cb26-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-189"><a href="#cb26-189" aria-hidden="true" tabindex="-1"></a>For simplicity, let's say we are only interested in data from penguins of the *Adelie* species. We will create a data frame with only the relevant variables (<span class="in">`sex`</span> and <span class="in">`flipper_length`</span>) and observations (<span class="in">`Adelie`</span> species and now missing data). We will remove rows with missing data in any of these variables^<span class="co">[</span><span class="ot">Mind that removing observations with any missing values is a particular strategy to deal with missing data that should be taken with caution. Some other strategies (e.g., imputation) might be more appropriate in other occasions</span><span class="co">]</span>. Finally, we will explicitly recode the <span class="in">`sex`</span> variable so that R assigns 0s to <span class="in">`female`</span> and 1s to <span class="in">`male`</span>. This should be the default behaviour, since R recodes categorical variables in the alphabetical order by default, but it is generally a good idea to double-check.</span>
<span id="cb26-190"><a href="#cb26-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-193"><a href="#cb26-193" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-194"><a href="#cb26-194" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: data-processing</span></span>
<span id="cb26-195"><a href="#cb26-195" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb26-196"><a href="#cb26-196" aria-hidden="true" tabindex="-1"></a>my_data <span class="ot">&lt;-</span> penguins <span class="sc">%&gt;%</span></span>
<span id="cb26-197"><a href="#cb26-197" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(species <span class="sc">==</span> <span class="st">"Adelie"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb26-198"><a href="#cb26-198" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(flipper_length_mm, sex) <span class="sc">%&gt;%</span></span>
<span id="cb26-199"><a href="#cb26-199" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>(<span class="st">"id"</span>) <span class="sc">%&gt;%</span> <span class="co"># assign a unique ID to each penguin</span></span>
<span id="cb26-200"><a href="#cb26-200" aria-hidden="true" tabindex="-1"></a>    <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span></span>
<span id="cb26-201"><a href="#cb26-201" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">sex =</span> <span class="fu">factor</span>(sex, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"female"</span>, <span class="st">"male"</span>)))</span>
<span id="cb26-202"><a href="#cb26-202" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-203"><a href="#cb26-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-204"><a href="#cb26-204" aria-hidden="true" tabindex="-1"></a>Now let's do some exploratory visualisation on the data (see @fig-descriptives). We can see that male penguins have slightly longer flippers. We will now model the association between both variables and perform some statistical inference on it. We will use logistic regression using the <span class="in">`glm()`</span> function in base R.</span>
<span id="cb26-205"><a href="#cb26-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-208"><a href="#cb26-208" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-209"><a href="#cb26-209" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-descriptives</span></span>
<span id="cb26-210"><a href="#cb26-210" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Flipper length for female and male penguins in the `penguins` dataset from the {palmerpenguins} R package."</span></span>
<span id="cb26-211"><a href="#cb26-211" aria-hidden="true" tabindex="-1"></a>my_data <span class="sc">%&gt;%</span> </span>
<span id="cb26-212"><a href="#cb26-212" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(flipper_length_mm, sex, <span class="at">colour =</span> sex, <span class="at">fill =</span> sex)) <span class="sc">+</span></span>
<span id="cb26-213"><a href="#cb26-213" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_slab</span>(<span class="at">trim =</span> <span class="cn">FALSE</span>, <span class="at">colour =</span> <span class="st">"white"</span>,</span>
<span id="cb26-214"><a href="#cb26-214" aria-hidden="true" tabindex="-1"></a>              <span class="at">position =</span> <span class="fu">position_nudge</span>(<span class="at">y =</span> <span class="fl">0.3</span>), <span class="at">scale =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb26-215"><a href="#cb26-215" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>(<span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">size  =</span> <span class="fl">0.75</span>,</span>
<span id="cb26-216"><a href="#cb26-216" aria-hidden="true" tabindex="-1"></a>                 <span class="at">outlier.colour =</span> <span class="cn">NA</span>, <span class="at">position =</span> <span class="fu">position_nudge</span>(<span class="at">y =</span> <span class="fl">0.3</span>)) <span class="sc">+</span></span>
<span id="cb26-217"><a href="#cb26-217" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>, <span class="at">stroke =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="fl">2.5</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb26-218"><a href="#cb26-218" aria-hidden="true" tabindex="-1"></a>               <span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">height =</span> <span class="fl">0.1</span>), <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb26-219"><a href="#cb26-219" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> clrs[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>)]) <span class="sc">+</span></span>
<span id="cb26-220"><a href="#cb26-220" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> clrs[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>)]) <span class="sc">+</span></span>
<span id="cb26-221"><a href="#cb26-221" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Flipper length (mm)"</span>, <span class="at">y =</span> <span class="st">"Sex"</span>) <span class="sc">+</span></span>
<span id="cb26-222"><a href="#cb26-222" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">colour =</span> <span class="st">"none"</span>, <span class="at">fill =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb26-223"><a href="#cb26-223" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb26-224"><a href="#cb26-224" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-225"><a href="#cb26-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-226"><a href="#cb26-226" aria-hidden="true" tabindex="-1"></a><span class="fu"># Fitting the model</span></span>
<span id="cb26-227"><a href="#cb26-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-228"><a href="#cb26-228" aria-hidden="true" tabindex="-1"></a>Following @eq-logistic-inverse, we can express our regression model as:</span>
<span id="cb26-229"><a href="#cb26-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-230"><a href="#cb26-230" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb26-231"><a href="#cb26-231" aria-hidden="true" tabindex="-1"></a>\ln \bigg( \frac{p}{1-p} \bigg) = y = \beta_{0} + \beta_{1} \times \text{Flipper length}</span>
<span id="cb26-232"><a href="#cb26-232" aria-hidden="true" tabindex="-1"></a>$${#eq-linear-regression}</span>
<span id="cb26-233"><a href="#cb26-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-234"><a href="#cb26-234" aria-hidden="true" tabindex="-1"></a>As a reminder, we can also express our regression model as part of the logistic function, replacing the exponential bit in the denominator with our regression model. </span>
<span id="cb26-235"><a href="#cb26-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-236"><a href="#cb26-236" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb26-237"><a href="#cb26-237" aria-hidden="true" tabindex="-1"></a>p = \text{Logistic}(y) = \frac{1}{1 + e^{-(\beta_0 + \beta_1 · \ \text{Flipper length)}}}</span>
<span id="cb26-238"><a href="#cb26-238" aria-hidden="true" tabindex="-1"></a>$${#eq-logistic-regression}</span>
<span id="cb26-239"><a href="#cb26-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-240"><a href="#cb26-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-241"><a href="#cb26-241" aria-hidden="true" tabindex="-1"></a>We can implement the model using the base R function <span class="in">`glm(..., family = binomial("logit"))`</span> in which the <span class="in">`family`</span> argument tells the function what type of generalised regression family we are interesting in using, and where <span class="in">`binomial("logit")`</span> indicates that we want the logistic function to be used with the logit transformation (as opposed to probit).</span>
<span id="cb26-242"><a href="#cb26-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-245"><a href="#cb26-245" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-246"><a href="#cb26-246" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fit-model</span></span>
<span id="cb26-247"><a href="#cb26-247" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb26-248"><a href="#cb26-248" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">glm</span>(sex <span class="sc">~</span> flipper_length_mm, </span>
<span id="cb26-249"><a href="#cb26-249" aria-hidden="true" tabindex="-1"></a>           <span class="at">data =</span> my_data, </span>
<span id="cb26-250"><a href="#cb26-250" aria-hidden="true" tabindex="-1"></a>           <span class="at">family =</span> <span class="fu">binomial</span>(<span class="st">"logit"</span>))</span>
<span id="cb26-251"><a href="#cb26-251" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-252"><a href="#cb26-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-253"><a href="#cb26-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-254"><a href="#cb26-254" aria-hidden="true" tabindex="-1"></a>We have fitted a binomial logit regression model in which we estimate the probability of a given penguin being female or male, adjusting for their flipper length in millimetres. This is a **generalised linear model** (GLM): after we transform the response variable (sex, coded as 0s and 1s) to the logit scale, the resulting response variable is modelled as a conventional linear model. This means that we can interpret the coefficients of this model the same way we would in a linear model. These are our **coefficients**:</span>
<span id="cb26-255"><a href="#cb26-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-258"><a href="#cb26-258" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-259"><a href="#cb26-259" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: coefs</span></span>
<span id="cb26-260"><a href="#cb26-260" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb26-261"><a href="#cb26-261" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(fit)</span>
<span id="cb26-262"><a href="#cb26-262" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-263"><a href="#cb26-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-264"><a href="#cb26-264" aria-hidden="true" tabindex="-1"></a>We can generate and visualise the **predictions** of our model using the `predict` function. By setting `type = "link"`, we are asking the function to return the predictions in the **logit** scale.</span>
<span id="cb26-265"><a href="#cb26-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-268"><a href="#cb26-268" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-269"><a href="#cb26-269" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: predictions-natural-logit</span></span>
<span id="cb26-270"><a href="#cb26-270" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb26-271"><a href="#cb26-271" aria-hidden="true" tabindex="-1"></a><span class="co"># model predictions (on the probability scale by default)</span></span>
<span id="cb26-272"><a href="#cb26-272" aria-hidden="true" tabindex="-1"></a>my_data <span class="ot">&lt;-</span> <span class="fu">mutate</span>(my_data, <span class="at">sex_pred =</span> <span class="fu">predict</span>(fit, <span class="at">type =</span> <span class="st">"link"</span>))</span>
<span id="cb26-273"><a href="#cb26-273" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-274"><a href="#cb26-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-275"><a href="#cb26-275" aria-hidden="true" tabindex="-1"></a>@fig-predictions-natural-logit shows the predictions of the model in the logit scale. The intercept informs us of the **probability of an average penguin being male** (<span class="in">`sex = 1`</span>) in the logit scale when all predictors are set to zero: in our case, when <span class="in">`flipper_lenght_mm`</span> = 0. The value of the intercept <span class="in">`r round(coef(fit)["(Intercept)"], 2)`</span> is somewhat difficult to interpret for two reasons.</span>
<span id="cb26-276"><a href="#cb26-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-279"><a href="#cb26-279" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-280"><a href="#cb26-280" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-predictions-natural-logit</span></span>
<span id="cb26-281"><a href="#cb26-281" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Predictions of the logistic regression model in the logit scale."</span></span>
<span id="cb26-282"><a href="#cb26-282" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb26-283"><a href="#cb26-283" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb26-284"><a href="#cb26-284" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions of model with unstandardised age</span></span>
<span id="cb26-285"><a href="#cb26-285" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(my_data, <span class="fu">aes</span>(flipper_length_mm, sex_pred)) <span class="sc">+</span></span>
<span id="cb26-286"><a href="#cb26-286" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>,</span>
<span id="cb26-287"><a href="#cb26-287" aria-hidden="true" tabindex="-1"></a>               <span class="at">colour =</span> <span class="st">"grey"</span>,</span>
<span id="cb26-288"><a href="#cb26-288" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span></span>
<span id="cb26-289"><a href="#cb26-289" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> flipper_length_mm, <span class="at">y =</span> sex_pred),</span>
<span id="cb26-290"><a href="#cb26-290" aria-hidden="true" tabindex="-1"></a>              <span class="at">linewidth =</span> <span class="dv">2</span>,</span>
<span id="cb26-291"><a href="#cb26-291" aria-hidden="true" tabindex="-1"></a>              <span class="at">colour =</span> clrs[<span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb26-292"><a href="#cb26-292" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">label =</span> <span class="st">"Male more likely"</span>, <span class="at">x =</span> <span class="dv">170</span>, <span class="at">y =</span> <span class="fl">2.2</span>,</span>
<span id="cb26-293"><a href="#cb26-293" aria-hidden="true" tabindex="-1"></a>             <span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb26-294"><a href="#cb26-294" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"segment"</span>, <span class="at">y =</span> <span class="fl">0.75</span>, <span class="at">yend =</span> <span class="fl">2.2</span>, <span class="at">x =</span> <span class="dv">172</span>, <span class="at">xend =</span> <span class="dv">172</span>,</span>
<span id="cb26-295"><a href="#cb26-295" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">1</span>, <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"cm"</span>))) <span class="sc">+</span></span>
<span id="cb26-296"><a href="#cb26-296" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">label =</span> <span class="st">"Female more likely"</span>, <span class="at">x =</span> <span class="dv">170</span>, <span class="at">y =</span> <span class="sc">-</span><span class="fl">2.2</span>,</span>
<span id="cb26-297"><a href="#cb26-297" aria-hidden="true" tabindex="-1"></a>             <span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb26-298"><a href="#cb26-298" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"segment"</span>, <span class="at">y =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">yend =</span> <span class="sc">-</span><span class="fl">2.2</span>, <span class="at">x =</span> <span class="dv">172</span>, <span class="at">xend =</span> <span class="dv">172</span>,</span>
<span id="cb26-299"><a href="#cb26-299" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">1</span>, <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"cm"</span>))) <span class="sc">+</span></span>
<span id="cb26-300"><a href="#cb26-300" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Flipper length (mm)"</span>,</span>
<span id="cb26-301"><a href="#cb26-301" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"P(male) [logit scale]"</span>,</span>
<span id="cb26-302"><a href="#cb26-302" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> <span class="st">"&lt;span style = 'color:#003f5c;'&gt;Slope (logit scale)&lt;/span&gt;"</span>) <span class="sc">+</span></span>
<span id="cb26-303"><a href="#cb26-303" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">linetype =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb26-304"><a href="#cb26-304" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb26-305"><a href="#cb26-305" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title =</span> <span class="fu">element_markdown</span>())</span>
<span id="cb26-306"><a href="#cb26-306" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-307"><a href="#cb26-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-308"><a href="#cb26-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-309"><a href="#cb26-309" aria-hidden="true" tabindex="-1"></a>First, these predictions are in the logit scale, which is **not interpretable by itself** as opposed to the probability scale. For instance, it is easy to understand what a 50% probability of a penguin being male means: if we pick one penguin at random from our population of penguins of interest, the chances of it being male is roughly the same as flipping a coin and getting tails. It is not possible to determine what a 0 logit (equivalent to 50% in the probability scale) of a penguin being male means if not by transforming it to the probability scale. For now, let's just agree that negative values on the logit scale indicate that the chance of a penguin being male is lower than it being female, that positive values on the logit scale mean that the chance of a penguin being male is higher than it being female, and that a logit of 0 indicates that a penguin is equally likely to be male or female.</span>
<span id="cb26-310"><a href="#cb26-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-311"><a href="#cb26-311" aria-hidden="true" tabindex="-1"></a>With this information, we can conclude from the **intercept** ($\beta_0$) that a penguin with 0 mm flipper length is extremely likely to be female (`r round(coef(fit)["(Intercept)"], 2)` is a very large negative number in the logit scale). Another reason why interpreting the intercept of this model is troublesome stems precisely from this value corresponding to the likelihood of a penguin being male **when flipper length is 0 mm**. This value is uninterpretable because a flipper length of 0 mm would mean that the penguin has no flippers. We are not really interested in finding out the probability of a penguin with no flippers being male. I'm not an expert, but I assume that such a penguin would likely not be part of our population of interest here. Rather, we might be interested in **getting the probability of a penguin with some specific flipper length of interest being male**, such as the **average flipper length** (<span class="in">`r round(mean(my_data$flipper_length_mm), 2)`</span> in our sample). We will address how to do this later.</span>
<span id="cb26-312"><a href="#cb26-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-313"><a href="#cb26-313" aria-hidden="true" tabindex="-1"></a>Interpreting the **slope** of <span class="in">`flipper_length_mm`</span> ($\beta_1$) is also challenging. On the logit scale, the value of this coefficient (<span class="in">`r round(coef(fit)["flipper_length_mm"], 2)`</span>) indicates how much the chance of a penguin being male increases for every unit increase in flipper length in the logit scale. Since <span class="in">`flipper_lenght_mm`</span> is expressed in millimetres, we can conclude that for every millimetre increment in flipper length, the chance of the measure penguin being male increases in <span class="in">`r round(coef(fit)["flipper_length_mm"], 2)`</span> logits. Again, we are not sure of how to interpret this quantity, since the logit scale is not interpretable by itself. We need to transform the coefficient of <span class="in">`flipper_length_mm`</span> to the probability scale to get a better intuition of what it means.</span>
<span id="cb26-314"><a href="#cb26-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-315"><a href="#cb26-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-316"><a href="#cb26-316" aria-hidden="true" tabindex="-1"></a><span class="fu"># The probability scale</span></span>
<span id="cb26-317"><a href="#cb26-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-318"><a href="#cb26-318" aria-hidden="true" tabindex="-1"></a>We previously tried to interpret the coefficients of a binomial logit regression model and encountered some difficulties. One of them related to the fact that coefficients are expressed in the logit scale. We can solve this by **transforming** these values---in our case the intercept and the coefficient of <span class="in">`flipper_length_mm`</span>---to the probability scale. This way, the intercept will indicate the probability of a penguin being male when their flipper is 0 mm long^<span class="co">[</span><span class="ot">As we have already discussed, such penguin is unlikely to exist, and therefore this quantity will be uninteresting, but we will address this issue later.</span><span class="co">]</span>. The coefficient of <span class="in">`flipper_length_mm`</span> will tell us how much such probability increases for every millimetre increase in flipper length.</span>
<span id="cb26-319"><a href="#cb26-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-320"><a href="#cb26-320" aria-hidden="true" tabindex="-1"></a>Transforming values from the logit to the probability scale, however, is not very straightforward. This is because **the relationship between probabilities and logits is non-linear**. If you remember, we had transformed probabilities to logits precisely for this reason! In order to fit a linear model in a sensible way, we to transformed our response variable (probabilities) to a scale with more ideal properties. One of such transformations was the logit function, which we employed. Now we have to deal with its consequences. One first step to transforming logits to probabilities is to use the inverse of the logit function (see @eq-inv-logit).</span>
<span id="cb26-321"><a href="#cb26-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-322"><a href="#cb26-322" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb26-323"><a href="#cb26-323" aria-hidden="true" tabindex="-1"></a>\text{Logit}^{-1}(x) = \frac{e^x}{1 + e^x}</span>
<span id="cb26-324"><a href="#cb26-324" aria-hidden="true" tabindex="-1"></a>$${#eq-inv-logit}</span>
<span id="cb26-325"><a href="#cb26-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-326"><a href="#cb26-326" aria-hidden="true" tabindex="-1"></a>Base R conveniently offers the function <span class="in">`plogis()`</span>, which we can use to transform the intercept of the model to an interpretable probability value:</span>
<span id="cb26-327"><a href="#cb26-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-330"><a href="#cb26-330" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-331"><a href="#cb26-331" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: coefs-intercept</span></span>
<span id="cb26-332"><a href="#cb26-332" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb26-333"><a href="#cb26-333" aria-hidden="true" tabindex="-1"></a><span class="fu">plogis</span>(<span class="fu">coef</span>(fit)[<span class="st">"(Intercept)"</span>])</span>
<span id="cb26-334"><a href="#cb26-334" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-335"><a href="#cb26-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-336"><a href="#cb26-336" aria-hidden="true" tabindex="-1"></a>This quantity tells us that the probability of a penguin with flipper length of 0 mm being male (remember that the intercept tells us the value of the response variable when predictors are set at 0). As we suspected, this value is extremely close to zero: <span class="in">`r percent(plogis(coef(fit)["(Intercept)"]), accuracy = 0.000000001)`</span>. Obviously, if male penguins tend to have longer flippers, the model will predict that penguins with zero-length flippers as extremely likely to be female! (see @fig-logit-prob-intercept). But aside from this issue that we'll deal with later, transforming the intercept from a logit model to the probability scale seems fairly simple.</span>
<span id="cb26-337"><a href="#cb26-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-340"><a href="#cb26-340" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-341"><a href="#cb26-341" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-logit-prob-intercept</span></span>
<span id="cb26-342"><a href="#cb26-342" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "The relationship between logits and probabilities."</span></span>
<span id="cb26-343"><a href="#cb26-343" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb26-344"><a href="#cb26-344" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb26-345"><a href="#cb26-345" aria-hidden="true" tabindex="-1"></a>prob <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.001</span>)</span>
<span id="cb26-346"><a href="#cb26-346" aria-hidden="true" tabindex="-1"></a>logit_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">log</span>(x <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> x))</span>
<span id="cb26-347"><a href="#cb26-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-348"><a href="#cb26-348" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">tibble</span>(prob, <span class="at">logit =</span> <span class="fu">logit_fun</span>(prob)) </span>
<span id="cb26-349"><a href="#cb26-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-350"><a href="#cb26-350" aria-hidden="true" tabindex="-1"></a>txt <span class="ot">&lt;-</span> <span class="fu">str_wrap</span>(</span>
<span id="cb26-351"><a href="#cb26-351" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste0</span>(</span>
<span id="cb26-352"><a href="#cb26-352" aria-hidden="true" tabindex="-1"></a>        <span class="st">"The intercept in our model is "</span>, </span>
<span id="cb26-353"><a href="#cb26-353" aria-hidden="true" tabindex="-1"></a>        <span class="fu">round</span>(<span class="fu">coef</span>(fit)[<span class="st">"(Intercept)"</span>], <span class="dv">2</span>),</span>
<span id="cb26-354"><a href="#cb26-354" aria-hidden="true" tabindex="-1"></a>        <span class="st">" in the logit scale, which translates to an extremely "</span>,</span>
<span id="cb26-355"><a href="#cb26-355" aria-hidden="true" tabindex="-1"></a>        <span class="st">"low value in the probability scale, very close to zero!"</span>),</span>
<span id="cb26-356"><a href="#cb26-356" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">30</span>)</span>
<span id="cb26-357"><a href="#cb26-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-358"><a href="#cb26-358" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(d, <span class="fu">aes</span>(logit, prob)) <span class="sc">+</span></span>
<span id="cb26-359"><a href="#cb26-359" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"curve"</span>, <span class="at">x =</span> <span class="sc">-</span><span class="dv">5</span>, <span class="at">xend =</span> <span class="sc">-</span><span class="fl">7.5</span>, <span class="at">y =</span> <span class="fl">0.35</span>, <span class="at">yend =</span> <span class="fl">0.05</span>, <span class="at">size =</span> <span class="fl">0.75</span>,</span>
<span id="cb26-360"><a href="#cb26-360" aria-hidden="true" tabindex="-1"></a>             <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">"cm"</span>)), <span class="at">curvature =</span> <span class="sc">-</span><span class="fl">0.45</span>, <span class="at">ncp =</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb26-361"><a href="#cb26-361" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">label =</span> txt,</span>
<span id="cb26-362"><a href="#cb26-362" aria-hidden="true" tabindex="-1"></a>             <span class="at">x =</span> <span class="sc">-</span><span class="fl">7.5</span>, <span class="at">y =</span> <span class="fl">0.5</span>, <span class="at">hjust =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb26-363"><a href="#cb26-363" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">colour =</span> clrs[<span class="dv">1</span>], <span class="at">linewidth =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb26-364"><a href="#cb26-364" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Logit"</span>, <span class="at">y =</span> <span class="st">"Probability"</span>) <span class="sc">+</span></span>
<span id="cb26-365"><a href="#cb26-365" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> percent)</span>
<span id="cb26-366"><a href="#cb26-366" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-367"><a href="#cb26-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-368"><a href="#cb26-368" aria-hidden="true" tabindex="-1"></a>Doing the same with the **coefficients of the predictors** is a different story. This is because the intercept of the model maps onto a single point in the logit scale, and so it does in the probability scale too. There is a one-to-one correspondence between each value of the logit and the probability scales. But **a regression coefficient does not refer to single value** in either scale, but to a **difference in values**.</span>
<span id="cb26-369"><a href="#cb26-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-370"><a href="#cb26-370" aria-hidden="true" tabindex="-1"></a>A regression coefficient tells us the **estimated increase in the response variable for every unit increment in the predictor**---while any other predictor is set at zero. This is true for any linear regression model, including ours. As long as we remain in the logit scale, the coefficient of the `flipper_length_mm` predictor will inform us of the increase in logits of being male for every millimetre increment in flipper length. But as soon as we move to the probability scale, this stops being true. This is because of the non-linear relationship between logits and probabilities: **a difference of one logit of being male is not the same for the entire range of flipper lengths**. Take a look at @fig-logit-prob-slope.</span>
<span id="cb26-371"><a href="#cb26-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-374"><a href="#cb26-374" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-375"><a href="#cb26-375" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-logit-prob-slope</span></span>
<span id="cb26-376"><a href="#cb26-376" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "The coefficients of a logistic regression model scale differently for different values of their predictors."</span></span>
<span id="cb26-377"><a href="#cb26-377" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb26-378"><a href="#cb26-378" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb26-379"><a href="#cb26-379" aria-hidden="true" tabindex="-1"></a>prob <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.001</span>)</span>
<span id="cb26-380"><a href="#cb26-380" aria-hidden="true" tabindex="-1"></a>logit_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">log</span>(x <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> x))</span>
<span id="cb26-381"><a href="#cb26-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-382"><a href="#cb26-382" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">tibble</span>(prob, <span class="at">logit =</span> <span class="fu">logit_fun</span>(prob)) </span>
<span id="cb26-383"><a href="#cb26-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-384"><a href="#cb26-384" aria-hidden="true" tabindex="-1"></a><span class="co"># model predictions (on the probability scale by default)</span></span>
<span id="cb26-385"><a href="#cb26-385" aria-hidden="true" tabindex="-1"></a>my_data <span class="ot">&lt;-</span> <span class="fu">mutate</span>(my_data, </span>
<span id="cb26-386"><a href="#cb26-386" aria-hidden="true" tabindex="-1"></a>                  <span class="at">sex_pred =</span> <span class="fu">fitted</span>(fit), </span>
<span id="cb26-387"><a href="#cb26-387" aria-hidden="true" tabindex="-1"></a>                  <span class="at">sex_pred_logit =</span> <span class="fu">predict</span>(fit, <span class="at">type =</span> <span class="st">"link"</span>))</span>
<span id="cb26-388"><a href="#cb26-388" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-389"><a href="#cb26-389" aria-hidden="true" tabindex="-1"></a>point_preds <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">flipper_length_mm =</span> <span class="fu">c</span>(<span class="dv">180</span>, <span class="dv">185</span>, <span class="dv">190</span>, <span class="dv">195</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb26-390"><a href="#cb26-390" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">sex_pred =</span> <span class="fu">plogis</span>(<span class="fu">predict</span>(fit, .)))</span>
<span id="cb26-391"><a href="#cb26-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-392"><a href="#cb26-392" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions of model with unstandardised age</span></span>
<span id="cb26-393"><a href="#cb26-393" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(my_data, <span class="fu">aes</span>(flipper_length_mm, sex_pred)) <span class="sc">+</span></span>
<span id="cb26-394"><a href="#cb26-394" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plot observations</span></span>
<span id="cb26-395"><a href="#cb26-395" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">as.numeric</span>(sex)<span class="sc">-</span><span class="dv">1</span>), </span>
<span id="cb26-396"><a href="#cb26-396" aria-hidden="true" tabindex="-1"></a>               <span class="at">shape =</span> <span class="dv">1</span>,</span>
<span id="cb26-397"><a href="#cb26-397" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="fl">1.5</span>,</span>
<span id="cb26-398"><a href="#cb26-398" aria-hidden="true" tabindex="-1"></a>               <span class="at">stroke =</span> <span class="dv">1</span>,</span>
<span id="cb26-399"><a href="#cb26-399" aria-hidden="true" tabindex="-1"></a>               <span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">height =</span> <span class="fl">0.1</span>),</span>
<span id="cb26-400"><a href="#cb26-400" aria-hidden="true" tabindex="-1"></a>               <span class="at">alpha =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb26-401"><a href="#cb26-401" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.5</span>,</span>
<span id="cb26-402"><a href="#cb26-402" aria-hidden="true" tabindex="-1"></a>               <span class="at">colour =</span> <span class="st">"grey"</span>,</span>
<span id="cb26-403"><a href="#cb26-403" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span></span>
<span id="cb26-404"><a href="#cb26-404" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> flipper_length_mm, <span class="at">y =</span> sex_pred),</span>
<span id="cb26-405"><a href="#cb26-405" aria-hidden="true" tabindex="-1"></a>              <span class="at">linewidth =</span> <span class="fl">1.5</span>,</span>
<span id="cb26-406"><a href="#cb26-406" aria-hidden="true" tabindex="-1"></a>              <span class="at">colour =</span> clrs[<span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb26-407"><a href="#cb26-407" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plot intercept (y when x = 0)</span></span>
<span id="cb26-408"><a href="#cb26-408" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">plogis</span>(<span class="fu">coef</span>(fit)[<span class="st">"(Intercept)"</span>]),</span>
<span id="cb26-409"><a href="#cb26-409" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb26-410"><a href="#cb26-410" aria-hidden="true" tabindex="-1"></a>               <span class="at">colour =</span> clrs[<span class="dv">4</span>])  <span class="sc">+</span></span>
<span id="cb26-411"><a href="#cb26-411" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> point_preds[<span class="dv">1</span>, <span class="dv">1</span>], <span class="at">xend =</span> point_preds[<span class="dv">2</span>, <span class="dv">1</span>],</span>
<span id="cb26-412"><a href="#cb26-412" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> point_preds[<span class="dv">1</span>, <span class="dv">2</span>], <span class="at">yend =</span> point_preds[<span class="dv">1</span>, <span class="dv">2</span>]),</span>
<span id="cb26-413"><a href="#cb26-413" aria-hidden="true" tabindex="-1"></a>                 <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb26-414"><a href="#cb26-414" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> point_preds[<span class="dv">2</span>, <span class="dv">1</span>], <span class="at">xend =</span> point_preds[<span class="dv">2</span>, <span class="dv">1</span>], </span>
<span id="cb26-415"><a href="#cb26-415" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> point_preds[<span class="dv">1</span>, <span class="dv">2</span>], <span class="at">yend =</span> point_preds[<span class="dv">2</span>, <span class="dv">2</span>]),</span>
<span id="cb26-416"><a href="#cb26-416" aria-hidden="true" tabindex="-1"></a>                 <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb26-417"><a href="#cb26-417" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>,</span>
<span id="cb26-418"><a href="#cb26-418" aria-hidden="true" tabindex="-1"></a>             <span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">percent</span>(point_preds[<span class="dv">2</span>,<span class="dv">2</span>]<span class="sc">-</span>point_preds[<span class="dv">1</span>, <span class="dv">2</span>]), <span class="st">" increment"</span>),</span>
<span id="cb26-419"><a href="#cb26-419" aria-hidden="true" tabindex="-1"></a>             <span class="at">x =</span> point_preds[<span class="dv">2</span>, <span class="dv">1</span>], </span>
<span id="cb26-420"><a href="#cb26-420" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> <span class="fu">mean</span>(<span class="fu">c</span>(point_preds[<span class="dv">1</span>, <span class="dv">2</span>], point_preds[<span class="dv">2</span>,<span class="dv">2</span>])), </span>
<span id="cb26-421"><a href="#cb26-421" aria-hidden="true" tabindex="-1"></a>             <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb26-422"><a href="#cb26-422" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, </span>
<span id="cb26-423"><a href="#cb26-423" aria-hidden="true" tabindex="-1"></a>             <span class="at">label =</span> <span class="st">"5 cm difference"</span>,</span>
<span id="cb26-424"><a href="#cb26-424" aria-hidden="true" tabindex="-1"></a>             <span class="at">x =</span> point_preds[<span class="dv">1</span>, <span class="dv">1</span>], </span>
<span id="cb26-425"><a href="#cb26-425" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> point_preds[<span class="dv">1</span>, <span class="dv">2</span>], </span>
<span id="cb26-426"><a href="#cb26-426" aria-hidden="true" tabindex="-1"></a>             <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>,</span>
<span id="cb26-427"><a href="#cb26-427" aria-hidden="true" tabindex="-1"></a>             <span class="at">vjust =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb26-428"><a href="#cb26-428" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-429"><a href="#cb26-429" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> point_preds[<span class="dv">3</span>, <span class="dv">1</span>], <span class="at">xend =</span> point_preds[<span class="dv">4</span>, <span class="dv">1</span>],</span>
<span id="cb26-430"><a href="#cb26-430" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> point_preds[<span class="dv">3</span>, <span class="dv">2</span>], <span class="at">yend =</span> point_preds[<span class="dv">3</span>, <span class="dv">2</span>]),</span>
<span id="cb26-431"><a href="#cb26-431" aria-hidden="true" tabindex="-1"></a>                 <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb26-432"><a href="#cb26-432" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> point_preds[<span class="dv">4</span>, <span class="dv">1</span>], <span class="at">xend =</span> point_preds[<span class="dv">4</span>, <span class="dv">1</span>], </span>
<span id="cb26-433"><a href="#cb26-433" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> point_preds[<span class="dv">3</span>, <span class="dv">2</span>], <span class="at">yend =</span> point_preds[<span class="dv">4</span>, <span class="dv">2</span>]),</span>
<span id="cb26-434"><a href="#cb26-434" aria-hidden="true" tabindex="-1"></a>                 <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb26-435"><a href="#cb26-435" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, </span>
<span id="cb26-436"><a href="#cb26-436" aria-hidden="true" tabindex="-1"></a>             <span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">percent</span>(point_preds[<span class="dv">4</span>, <span class="dv">2</span>]<span class="sc">-</span>point_preds[<span class="dv">3</span>, <span class="dv">2</span>]), <span class="st">" increment"</span>),</span>
<span id="cb26-437"><a href="#cb26-437" aria-hidden="true" tabindex="-1"></a>             <span class="at">x =</span> point_preds[<span class="dv">4</span>, <span class="dv">1</span>], </span>
<span id="cb26-438"><a href="#cb26-438" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> <span class="fu">mean</span>(<span class="fu">c</span>(point_preds[<span class="dv">4</span>, <span class="dv">2</span>], point_preds[<span class="dv">3</span>, <span class="dv">2</span>])),</span>
<span id="cb26-439"><a href="#cb26-439" aria-hidden="true" tabindex="-1"></a>             <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb26-440"><a href="#cb26-440" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, </span>
<span id="cb26-441"><a href="#cb26-441" aria-hidden="true" tabindex="-1"></a>             <span class="at">label =</span> <span class="st">"5 cm difference"</span>,</span>
<span id="cb26-442"><a href="#cb26-442" aria-hidden="true" tabindex="-1"></a>             <span class="at">x =</span> point_preds[<span class="dv">3</span>, <span class="dv">1</span>], </span>
<span id="cb26-443"><a href="#cb26-443" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> point_preds[<span class="dv">3</span>, <span class="dv">2</span>], </span>
<span id="cb26-444"><a href="#cb26-444" aria-hidden="true" tabindex="-1"></a>             <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>,</span>
<span id="cb26-445"><a href="#cb26-445" aria-hidden="true" tabindex="-1"></a>             <span class="at">vjust =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb26-446"><a href="#cb26-446" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Flipper length (mm)"</span>,</span>
<span id="cb26-447"><a href="#cb26-447" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"P(male)"</span>,</span>
<span id="cb26-448"><a href="#cb26-448" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> <span class="st">"&lt;span style = 'color:#003f5c;'&gt;Logistic curve&lt;/span&gt;,</span></span>
<span id="cb26-449"><a href="#cb26-449" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;span style = 'color:#ff6361;'&gt;intercept&lt;/span&gt;"</span>) <span class="sc">+</span></span>
<span id="cb26-450"><a href="#cb26-450" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">linetype =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb26-451"><a href="#cb26-451" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> percent, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.25</span>)) <span class="sc">+</span></span>
<span id="cb26-452"><a href="#cb26-452" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb26-453"><a href="#cb26-453" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title =</span> <span class="fu">element_markdown</span>())</span>
<span id="cb26-454"><a href="#cb26-454" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-455"><a href="#cb26-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-456"><a href="#cb26-456" aria-hidden="true" tabindex="-1"></a>A difference in the logit scale does not scale equally to the probability scale. In the probability scale, a penguin with 190 mm long flipper is <span class="in">`r round(point_preds[2,2]-point_preds[1,2])`</span> more likely to be male than a penguin with 185 mm long flipper. Interestingly, a penguin with a 195 mm long flipper is <span class="in">`r round(point_preds[4,2]-point_preds[3,2])`</span> more likely to be male than a penguin with a 195 mm long flipper. In both cases, the difference in flipper length is the same (5 mm), but the estimated increase in male probability is different!</span>
<span id="cb26-457"><a href="#cb26-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-458"><a href="#cb26-458" aria-hidden="true" tabindex="-1"></a>This non-linearity in the relationship between logits and probabilities should be considered when interpreting the coefficients of a logistic regression model and, more generally, whenever the response variable has been transformed before entering the model. One strategy to ease the interpretation of the regression coefficients is to calculate the **marginal effects** of the model for specific values of the predictor.</span>
<span id="cb26-459"><a href="#cb26-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-460"><a href="#cb26-460" aria-hidden="true" tabindex="-1"></a><span class="fu">## Marginal effects</span></span>
<span id="cb26-461"><a href="#cb26-461" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-462"><a href="#cb26-462" aria-hidden="true" tabindex="-1"></a>Defining ***marginal effect*** is tricky. As it happens with many concepts and labels in statistics, the same label may be used to refer to different concepts, and several labels may be used interchangeably to refer to the same concept. Each subfield of science seems to use a somewhat intrinsic lexicon, which sometimes leads to confusion. I will adopt the terminology in the documentation of the **{marginaleffects}** R package <span class="co">[</span><span class="ot">@arel-bundock2022marginaleffects</span><span class="co">]</span>, in which a marginal effect is defined in the context of regression as:</span>
<span id="cb26-463"><a href="#cb26-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-464"><a href="#cb26-464" aria-hidden="true" tabindex="-1"></a>::: {.column-margin}</span>
<span id="cb26-465"><a href="#cb26-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-466"><a href="#cb26-466" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="al">![The **{marginaleffects}** R package](https://user-images.githubusercontent.com/987057/134899484-e3392510-2e94-4c39-9830-53356fa5feed.png)</span><span class="ot">{width=100px}</span><span class="co">](https://user-images.githubusercontent.com/987057/134899484-e3392510-2e94-4c39-9830-53356fa5feed.png)</span></span>
<span id="cb26-467"><a href="#cb26-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-468"><a href="#cb26-468" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb26-469"><a href="#cb26-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-470"><a href="#cb26-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-471"><a href="#cb26-471" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; </span><span class="co">[</span><span class="ot">...</span><span class="co">]</span><span class="at"> the association between a change in a regressor $x$ and a change in the response $y$. Put differently, the marginal effect is the slope of the prediction function, measured at a specific value of the regressor $x$.</span></span>
<span id="cb26-472"><a href="#cb26-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-473"><a href="#cb26-473" aria-hidden="true" tabindex="-1"></a>According to this definition, calculating the marginal effect of our predictor of interest <span class="in">`flipper_length_mm`</span> means **extracting its slope for a specific value of the predictor**. For linear regression models, this is trivial: since the relationship between the predictor and the response variable is assumed linear, the slope is considered constant across the whole range of the values of the predictor, and therefore its marginal effect is identical for all of them.</span>
<span id="cb26-474"><a href="#cb26-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-475"><a href="#cb26-475" aria-hidden="true" tabindex="-1"></a>We can prove this by looking at the estimates of our (linear) model in the logit scale. Let's say that we are interested in finding out the slope of <span class="in">`flipper_length_mm`</span> for its average, <span class="in">`r mean(my_data$flipper_length_mm)`</span>. A slope is just a difference. And a difference is a derivative. And the linear regression function, $y = \beta_0 + \beta_1 x$, is a function that can be derived (see @eq-linear-derivative).</span>
<span id="cb26-476"><a href="#cb26-476" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-477"><a href="#cb26-477" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb26-478"><a href="#cb26-478" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb26-479"><a href="#cb26-479" aria-hidden="true" tabindex="-1"></a>y &amp;= \beta_0 + \beta_1 \times \text{Flipper length} <span class="sc">\\</span></span>
<span id="cb26-480"><a href="#cb26-480" aria-hidden="true" tabindex="-1"></a>y' &amp;= \beta_1 &amp; \text{First derivative}</span>
<span id="cb26-481"><a href="#cb26-481" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb26-482"><a href="#cb26-482" aria-hidden="true" tabindex="-1"></a>$$ {#eq-linear-derivative}</span>
<span id="cb26-483"><a href="#cb26-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-484"><a href="#cb26-484" aria-hidden="true" tabindex="-1"></a>The derivative of the linear regression equation is a **constant**. This constant corresponds to the regression coefficient of <span class="in">`flipper_length_mm`</span>, which means that the difference in probability of being a male penguin is going to be same for two penguins whose flippers are 180 mm and 185 mm, respectively, and for two penguins whose flippers are 190 and 195 mm, respectively.</span>
<span id="cb26-485"><a href="#cb26-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-486"><a href="#cb26-486" aria-hidden="true" tabindex="-1"></a>Take a look at @fig-linear-derivative. The difference in chances of being male between each pair of penguins, in the logit scale, is the same: <span class="in">`r round(coef(fit)["flipper_length_mm"]*5, 2)`</span>, which corresponds to five times the <span class="in">`flipper_length_mm`</span> regression coefficient because in both cases the difference in flipper length is not 1 mm but 5 mm ($5 \times 0.1271 = 0.635$). But, again, any value in the logit scale is difficult to interpret by itself, so we are interested in translating this to the scale of probabilities.</span>
<span id="cb26-487"><a href="#cb26-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-490"><a href="#cb26-490" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-491"><a href="#cb26-491" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-linear-derivative</span></span>
<span id="cb26-492"><a href="#cb26-492" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "The derivative of a linear regression equation is a constant."</span></span>
<span id="cb26-493"><a href="#cb26-493" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb26-494"><a href="#cb26-494" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb26-495"><a href="#cb26-495" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions of model with unstandardised age</span></span>
<span id="cb26-496"><a href="#cb26-496" aria-hidden="true" tabindex="-1"></a>point_preds <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">flipper_length_mm =</span> <span class="fu">c</span>(<span class="dv">180</span>, <span class="dv">185</span>, <span class="dv">190</span>, <span class="dv">195</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb26-497"><a href="#cb26-497" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">sex_pred =</span> <span class="fu">predict</span>(fit, ., <span class="at">type =</span> <span class="st">"link"</span>))</span>
<span id="cb26-498"><a href="#cb26-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-499"><a href="#cb26-499" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(my_data, <span class="fu">aes</span>(flipper_length_mm, sex_pred_logit)) <span class="sc">+</span></span>
<span id="cb26-500"><a href="#cb26-500" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.5</span>,</span>
<span id="cb26-501"><a href="#cb26-501" aria-hidden="true" tabindex="-1"></a>               <span class="at">colour =</span> <span class="st">"grey"</span>,</span>
<span id="cb26-502"><a href="#cb26-502" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span></span>
<span id="cb26-503"><a href="#cb26-503" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> flipper_length_mm, <span class="at">y =</span> sex_pred_logit),</span>
<span id="cb26-504"><a href="#cb26-504" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb26-505"><a href="#cb26-505" aria-hidden="true" tabindex="-1"></a>              <span class="at">colour =</span> clrs[<span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb26-506"><a href="#cb26-506" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> point_preds[<span class="dv">1</span>,<span class="dv">1</span>], <span class="at">xend =</span> point_preds[<span class="dv">2</span>,<span class="dv">1</span>],</span>
<span id="cb26-507"><a href="#cb26-507" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> point_preds[<span class="dv">1</span>,<span class="dv">2</span>], <span class="at">yend =</span> point_preds[<span class="dv">1</span>,<span class="dv">2</span>]),</span>
<span id="cb26-508"><a href="#cb26-508" aria-hidden="true" tabindex="-1"></a>                 <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb26-509"><a href="#cb26-509" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> point_preds[<span class="dv">2</span>,<span class="dv">1</span>], <span class="at">xend =</span> point_preds[<span class="dv">2</span>,<span class="dv">1</span>], </span>
<span id="cb26-510"><a href="#cb26-510" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> point_preds[<span class="dv">1</span>,<span class="dv">2</span>], <span class="at">yend =</span> point_preds[<span class="dv">2</span>,<span class="dv">2</span>]),</span>
<span id="cb26-511"><a href="#cb26-511" aria-hidden="true" tabindex="-1"></a>                 <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb26-512"><a href="#cb26-512" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>,</span>
<span id="cb26-513"><a href="#cb26-513" aria-hidden="true" tabindex="-1"></a>             <span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(point_preds[<span class="dv">2</span>,<span class="dv">2</span>]<span class="sc">-</span>point_preds[<span class="dv">1</span>,<span class="dv">2</span>], <span class="dv">3</span>), <span class="st">" increment"</span>),</span>
<span id="cb26-514"><a href="#cb26-514" aria-hidden="true" tabindex="-1"></a>             <span class="at">x =</span> point_preds[<span class="dv">2</span>,<span class="dv">1</span>],</span>
<span id="cb26-515"><a href="#cb26-515" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> <span class="fu">mean</span>(<span class="fu">c</span>(point_preds[<span class="dv">1</span>,<span class="dv">2</span>], point_preds[<span class="dv">2</span>,<span class="dv">2</span>])),</span>
<span id="cb26-516"><a href="#cb26-516" aria-hidden="true" tabindex="-1"></a>             <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb26-517"><a href="#cb26-517" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, </span>
<span id="cb26-518"><a href="#cb26-518" aria-hidden="true" tabindex="-1"></a>             <span class="at">label =</span> <span class="st">"5 cm difference"</span>,</span>
<span id="cb26-519"><a href="#cb26-519" aria-hidden="true" tabindex="-1"></a>             <span class="at">x =</span> point_preds[<span class="dv">3</span>, <span class="dv">1</span>], </span>
<span id="cb26-520"><a href="#cb26-520" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> point_preds[<span class="dv">3</span>, <span class="dv">2</span>], </span>
<span id="cb26-521"><a href="#cb26-521" aria-hidden="true" tabindex="-1"></a>             <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>,</span>
<span id="cb26-522"><a href="#cb26-522" aria-hidden="true" tabindex="-1"></a>             <span class="at">vjust =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb26-523"><a href="#cb26-523" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> point_preds[<span class="dv">3</span>,<span class="dv">1</span>], <span class="at">xend =</span> point_preds[<span class="dv">4</span>,<span class="dv">1</span>],</span>
<span id="cb26-524"><a href="#cb26-524" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> point_preds[<span class="dv">3</span>,<span class="dv">2</span>], <span class="at">yend =</span> point_preds[<span class="dv">3</span>,<span class="dv">2</span>]),</span>
<span id="cb26-525"><a href="#cb26-525" aria-hidden="true" tabindex="-1"></a>                 <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb26-526"><a href="#cb26-526" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> point_preds[<span class="dv">4</span>,<span class="dv">1</span>], <span class="at">xend =</span> point_preds[<span class="dv">4</span>,<span class="dv">1</span>], </span>
<span id="cb26-527"><a href="#cb26-527" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> point_preds[<span class="dv">3</span>,<span class="dv">2</span>], <span class="at">yend =</span> point_preds[<span class="dv">4</span>,<span class="dv">2</span>]),</span>
<span id="cb26-528"><a href="#cb26-528" aria-hidden="true" tabindex="-1"></a>                 <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb26-529"><a href="#cb26-529" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, </span>
<span id="cb26-530"><a href="#cb26-530" aria-hidden="true" tabindex="-1"></a>             <span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">percent</span>(point_preds[<span class="dv">4</span>, <span class="dv">2</span>]<span class="sc">-</span>point_preds[<span class="dv">3</span>, <span class="dv">2</span>]), <span class="st">" increment"</span>),</span>
<span id="cb26-531"><a href="#cb26-531" aria-hidden="true" tabindex="-1"></a>             <span class="at">x =</span> point_preds[<span class="dv">4</span>, <span class="dv">1</span>], </span>
<span id="cb26-532"><a href="#cb26-532" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> <span class="fu">mean</span>(<span class="fu">c</span>(point_preds[<span class="dv">4</span>, <span class="dv">2</span>], point_preds[<span class="dv">3</span>, <span class="dv">2</span>])),</span>
<span id="cb26-533"><a href="#cb26-533" aria-hidden="true" tabindex="-1"></a>             <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb26-534"><a href="#cb26-534" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, </span>
<span id="cb26-535"><a href="#cb26-535" aria-hidden="true" tabindex="-1"></a>             <span class="at">label =</span> <span class="st">"5 cm difference"</span>,</span>
<span id="cb26-536"><a href="#cb26-536" aria-hidden="true" tabindex="-1"></a>             <span class="at">x =</span> point_preds[<span class="dv">3</span>, <span class="dv">1</span>], </span>
<span id="cb26-537"><a href="#cb26-537" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> point_preds[<span class="dv">3</span>, <span class="dv">2</span>], </span>
<span id="cb26-538"><a href="#cb26-538" aria-hidden="true" tabindex="-1"></a>             <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>,</span>
<span id="cb26-539"><a href="#cb26-539" aria-hidden="true" tabindex="-1"></a>             <span class="at">vjust =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb26-540"><a href="#cb26-540" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, </span>
<span id="cb26-541"><a href="#cb26-541" aria-hidden="true" tabindex="-1"></a>             <span class="at">label =</span> <span class="st">"5 cm difference"</span>,</span>
<span id="cb26-542"><a href="#cb26-542" aria-hidden="true" tabindex="-1"></a>             <span class="at">x =</span> point_preds[<span class="dv">1</span>, <span class="dv">1</span>], </span>
<span id="cb26-543"><a href="#cb26-543" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> point_preds[<span class="dv">1</span>, <span class="dv">2</span>], </span>
<span id="cb26-544"><a href="#cb26-544" aria-hidden="true" tabindex="-1"></a>             <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>,</span>
<span id="cb26-545"><a href="#cb26-545" aria-hidden="true" tabindex="-1"></a>             <span class="at">vjust =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb26-546"><a href="#cb26-546" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Flipper length (mm)"</span>,</span>
<span id="cb26-547"><a href="#cb26-547" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"P(male) [logit scale]"</span>,</span>
<span id="cb26-548"><a href="#cb26-548" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> <span class="st">"&lt;span style = 'color:#003f5c;'&gt;Slope (logit scale)&lt;/span&gt;"</span>) <span class="sc">+</span></span>
<span id="cb26-549"><a href="#cb26-549" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">linetype =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb26-550"><a href="#cb26-550" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-551"><a href="#cb26-551" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(my_data, <span class="fu">aes</span>(flipper_length_mm, sex_pred)) <span class="sc">+</span></span>
<span id="cb26-552"><a href="#cb26-552" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">colour =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb26-553"><a href="#cb26-553" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">coef</span>(fit)[<span class="st">"flipper_length_mm"</span>],</span>
<span id="cb26-554"><a href="#cb26-554" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">1</span>, <span class="at">colour =</span> <span class="st">"#ffa600"</span>) <span class="sc">+</span></span>
<span id="cb26-555"><a href="#cb26-555" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"label"</span>, </span>
<span id="cb26-556"><a href="#cb26-556" aria-hidden="true" tabindex="-1"></a>             <span class="at">label =</span> <span class="fu">paste0</span>(<span class="st">"Constant = "</span>, <span class="fu">round</span>(<span class="fu">coef</span>(fit)[<span class="st">"flipper_length_mm"</span>], <span class="dv">2</span>)),</span>
<span id="cb26-557"><a href="#cb26-557" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">"#ffa600"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">label.size =</span> <span class="dv">0</span>,</span>
<span id="cb26-558"><a href="#cb26-558" aria-hidden="true" tabindex="-1"></a>             <span class="at">x =</span> my_data<span class="sc">$</span>flipper_length_mm[<span class="fu">which.max</span>(my_data<span class="sc">$</span>derivative)],</span>
<span id="cb26-559"><a href="#cb26-559" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> <span class="fu">round</span>(<span class="fu">coef</span>(fit)[<span class="st">"flipper_length_mm"</span>], <span class="dv">2</span>),</span>
<span id="cb26-560"><a href="#cb26-560" aria-hidden="true" tabindex="-1"></a>             <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">1.25</span>) <span class="sc">+</span></span>
<span id="cb26-561"><a href="#cb26-561" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Flipper length (mm)"</span>,</span>
<span id="cb26-562"><a href="#cb26-562" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Slope of flipper length (logit scale)"</span>,</span>
<span id="cb26-563"><a href="#cb26-563" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> <span class="st">"&lt;span style = 'color:#ffa600;'&gt;Derivative (logit scale)&lt;/span&gt;"</span>) <span class="sc">+</span></span>
<span id="cb26-564"><a href="#cb26-564" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb26-565"><a href="#cb26-565" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-566"><a href="#cb26-566" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_layout</span>() <span class="sc">&amp;</span></span>
<span id="cb26-567"><a href="#cb26-567" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">"A"</span>) <span class="sc">&amp;</span></span>
<span id="cb26-568"><a href="#cb26-568" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb26-569"><a href="#cb26-569" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title =</span> <span class="fu">element_markdown</span>())</span>
<span id="cb26-570"><a href="#cb26-570" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-571"><a href="#cb26-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-572"><a href="#cb26-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-573"><a href="#cb26-573" aria-hidden="true" tabindex="-1"></a>We have seen that regression coefficients do not behave identically for different values of their predictors when transformed into probabilities. The exact point of <span class="in">`flipper_length_mm`</span> at which we calculate its marginal effect matters. This is because the derivative of the logistic function, which describes the behaviour of the probability scale we just moved to, is no longer a constant. See @eq-logistic-derivative.</span>
<span id="cb26-574"><a href="#cb26-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-575"><a href="#cb26-575" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb26-576"><a href="#cb26-576" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb26-577"><a href="#cb26-577" aria-hidden="true" tabindex="-1"></a>y &amp;= \frac{1}{1 + e^{(-\beta x)}} &amp; \text{Logistic function} <span class="sc">\\</span></span>
<span id="cb26-578"><a href="#cb26-578" aria-hidden="true" tabindex="-1"></a>y' &amp;= \frac{\beta_1 · e^{\beta_0 + \beta_1 · \ \text{Flipper length}} }{(1 + e^{-(\beta_0 + \beta_1 · \ \text{Flipper length})})^2} &amp; \text{Derivative}</span>
<span id="cb26-579"><a href="#cb26-579" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb26-580"><a href="#cb26-580" aria-hidden="true" tabindex="-1"></a>$$ {#eq-logistic-derivative}</span>
<span id="cb26-581"><a href="#cb26-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-582"><a href="#cb26-582" aria-hidden="true" tabindex="-1"></a>The derivative of the logistic function still takes into account the value of the predictor ($\text{Flipper length}$), which means that the value of the derivative changes depending on such value. Let's try to visualise this. First, we are going to implement the derivative of the logistic function as an R function that computes it for the <span class="in">`fit`</span> model:</span>
<span id="cb26-583"><a href="#cb26-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-586"><a href="#cb26-586" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-587"><a href="#cb26-587" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: logistic-derivative</span></span>
<span id="cb26-588"><a href="#cb26-588" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb26-589"><a href="#cb26-589" aria-hidden="true" tabindex="-1"></a>logistic_derivative <span class="ot">&lt;-</span> <span class="cf">function</span>(object, x, value) {</span>
<span id="cb26-590"><a href="#cb26-590" aria-hidden="true" tabindex="-1"></a>    slope <span class="ot">&lt;-</span> <span class="fu">coef</span>(object)[x]</span>
<span id="cb26-591"><a href="#cb26-591" aria-hidden="true" tabindex="-1"></a>    intercept <span class="ot">&lt;-</span> <span class="fu">coef</span>(object)[<span class="st">"(Intercept)"</span>]</span>
<span id="cb26-592"><a href="#cb26-592" aria-hidden="true" tabindex="-1"></a>    numerator <span class="ot">&lt;-</span> slope <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>(intercept <span class="sc">+</span> (slope <span class="sc">*</span> value)))</span>
<span id="cb26-593"><a href="#cb26-593" aria-hidden="true" tabindex="-1"></a>    denominator <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span>(intercept <span class="sc">+</span> (slope <span class="sc">*</span> value))))<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb26-594"><a href="#cb26-594" aria-hidden="true" tabindex="-1"></a>    y <span class="ot">&lt;-</span> numerator<span class="sc">/</span>denominator</span>
<span id="cb26-595"><a href="#cb26-595" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(y) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb26-596"><a href="#cb26-596" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(y)</span>
<span id="cb26-597"><a href="#cb26-597" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-598"><a href="#cb26-598" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-599"><a href="#cb26-599" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-600"><a href="#cb26-600" aria-hidden="true" tabindex="-1"></a>@fig-logistic-derivative shows how the derivative changes for each value of the predictor. As you can see, the difference in probability of being male is largest at around 190 mm, while such difference decreases as <span class="in">`flipper_length_mm`</span> shifts away from 190 mm.</span>
<span id="cb26-601"><a href="#cb26-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-604"><a href="#cb26-604" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-605"><a href="#cb26-605" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: fig-logistic-derivative</span></span>
<span id="cb26-606"><a href="#cb26-606" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "The derivative of a non-linear regression equation is not constant."</span></span>
<span id="cb26-607"><a href="#cb26-607" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 5</span></span>
<span id="cb26-608"><a href="#cb26-608" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 9</span></span>
<span id="cb26-609"><a href="#cb26-609" aria-hidden="true" tabindex="-1"></a><span class="co"># model predictions (on the probability scale by default)</span></span>
<span id="cb26-610"><a href="#cb26-610" aria-hidden="true" tabindex="-1"></a>my_data <span class="ot">&lt;-</span> <span class="fu">mutate</span>(</span>
<span id="cb26-611"><a href="#cb26-611" aria-hidden="true" tabindex="-1"></a>    my_data,</span>
<span id="cb26-612"><a href="#cb26-612" aria-hidden="true" tabindex="-1"></a>    <span class="at">derivative =</span> <span class="fu">logistic_derivative</span>(</span>
<span id="cb26-613"><a href="#cb26-613" aria-hidden="true" tabindex="-1"></a>        fit, </span>
<span id="cb26-614"><a href="#cb26-614" aria-hidden="true" tabindex="-1"></a>        <span class="st">"flipper_length_mm"</span>,</span>
<span id="cb26-615"><a href="#cb26-615" aria-hidden="true" tabindex="-1"></a>        flipper_length_mm</span>
<span id="cb26-616"><a href="#cb26-616" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb26-617"><a href="#cb26-617" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-618"><a href="#cb26-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-619"><a href="#cb26-619" aria-hidden="true" tabindex="-1"></a>point_preds <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">flipper_length_mm =</span> <span class="fu">c</span>(<span class="dv">180</span>, <span class="dv">185</span>, <span class="dv">190</span>, <span class="dv">195</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb26-620"><a href="#cb26-620" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">sex_pred =</span> <span class="fu">plogis</span>(<span class="fu">predict</span>(fit, .)),</span>
<span id="cb26-621"><a href="#cb26-621" aria-hidden="true" tabindex="-1"></a>           <span class="at">derivate =</span> <span class="fu">logistic_derivative</span>(fit, <span class="st">"flipper_length_mm"</span>, flipper_length_mm))</span>
<span id="cb26-622"><a href="#cb26-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-623"><a href="#cb26-623" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions of model with unstandardised age</span></span>
<span id="cb26-624"><a href="#cb26-624" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(my_data, <span class="fu">aes</span>(flipper_length_mm, sex_pred)) <span class="sc">+</span></span>
<span id="cb26-625"><a href="#cb26-625" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plot observations</span></span>
<span id="cb26-626"><a href="#cb26-626" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">as.numeric</span>(sex)<span class="sc">-</span><span class="dv">1</span>), </span>
<span id="cb26-627"><a href="#cb26-627" aria-hidden="true" tabindex="-1"></a>               <span class="at">shape =</span> <span class="dv">1</span>,</span>
<span id="cb26-628"><a href="#cb26-628" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="fl">1.5</span>,</span>
<span id="cb26-629"><a href="#cb26-629" aria-hidden="true" tabindex="-1"></a>               <span class="at">stroke =</span> <span class="dv">1</span>,</span>
<span id="cb26-630"><a href="#cb26-630" aria-hidden="true" tabindex="-1"></a>               <span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">height =</span> <span class="fl">0.1</span>),</span>
<span id="cb26-631"><a href="#cb26-631" aria-hidden="true" tabindex="-1"></a>               <span class="at">alpha =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb26-632"><a href="#cb26-632" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.5</span>,</span>
<span id="cb26-633"><a href="#cb26-633" aria-hidden="true" tabindex="-1"></a>               <span class="at">colour =</span> <span class="st">"grey"</span>,</span>
<span id="cb26-634"><a href="#cb26-634" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span></span>
<span id="cb26-635"><a href="#cb26-635" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> flipper_length_mm, <span class="at">y =</span> sex_pred),</span>
<span id="cb26-636"><a href="#cb26-636" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb26-637"><a href="#cb26-637" aria-hidden="true" tabindex="-1"></a>              <span class="at">colour =</span> clrs[<span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb26-638"><a href="#cb26-638" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plot intercept (y when x = 0)</span></span>
<span id="cb26-639"><a href="#cb26-639" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">plogis</span>(<span class="fu">coef</span>(fit)[<span class="st">"(Intercept)"</span>]),</span>
<span id="cb26-640"><a href="#cb26-640" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb26-641"><a href="#cb26-641" aria-hidden="true" tabindex="-1"></a>               <span class="at">colour =</span> clrs[<span class="dv">4</span>])  <span class="sc">+</span></span>
<span id="cb26-642"><a href="#cb26-642" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> point_preds[<span class="dv">1</span>,<span class="dv">1</span>], <span class="at">xend =</span> point_preds[<span class="dv">2</span>,<span class="dv">1</span>],</span>
<span id="cb26-643"><a href="#cb26-643" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> point_preds[<span class="dv">1</span>,<span class="dv">2</span>], <span class="at">yend =</span> point_preds[<span class="dv">1</span>,<span class="dv">2</span>]),</span>
<span id="cb26-644"><a href="#cb26-644" aria-hidden="true" tabindex="-1"></a>                 <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb26-645"><a href="#cb26-645" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> point_preds[<span class="dv">2</span>,<span class="dv">1</span>], <span class="at">xend =</span> point_preds[<span class="dv">2</span>,<span class="dv">1</span>], </span>
<span id="cb26-646"><a href="#cb26-646" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> point_preds[<span class="dv">1</span>,<span class="dv">2</span>], <span class="at">yend =</span> point_preds[<span class="dv">2</span>,<span class="dv">2</span>]),</span>
<span id="cb26-647"><a href="#cb26-647" aria-hidden="true" tabindex="-1"></a>                 <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb26-648"><a href="#cb26-648" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, </span>
<span id="cb26-649"><a href="#cb26-649" aria-hidden="true" tabindex="-1"></a>             <span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">percent</span>(point_preds[<span class="dv">2</span>,<span class="dv">2</span>]<span class="sc">-</span>point_preds[<span class="dv">1</span>,<span class="dv">2</span>]), <span class="st">" increment"</span>),</span>
<span id="cb26-650"><a href="#cb26-650" aria-hidden="true" tabindex="-1"></a>             <span class="at">x =</span> point_preds[<span class="dv">2</span>,<span class="dv">1</span>],</span>
<span id="cb26-651"><a href="#cb26-651" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> <span class="fu">mean</span>(<span class="fu">c</span>(point_preds[<span class="dv">1</span>,<span class="dv">2</span>], point_preds[<span class="dv">2</span>,<span class="dv">2</span>])), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb26-652"><a href="#cb26-652" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, </span>
<span id="cb26-653"><a href="#cb26-653" aria-hidden="true" tabindex="-1"></a>             <span class="at">label =</span> <span class="st">"5 cm difference"</span>,</span>
<span id="cb26-654"><a href="#cb26-654" aria-hidden="true" tabindex="-1"></a>             <span class="at">x =</span> point_preds[<span class="dv">1</span>, <span class="dv">1</span>], </span>
<span id="cb26-655"><a href="#cb26-655" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> point_preds[<span class="dv">1</span>, <span class="dv">2</span>], </span>
<span id="cb26-656"><a href="#cb26-656" aria-hidden="true" tabindex="-1"></a>             <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>,</span>
<span id="cb26-657"><a href="#cb26-657" aria-hidden="true" tabindex="-1"></a>             <span class="at">vjust =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb26-658"><a href="#cb26-658" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> point_preds[<span class="dv">3</span>,<span class="dv">1</span>], <span class="at">xend =</span> point_preds[<span class="dv">4</span>,<span class="dv">1</span>],</span>
<span id="cb26-659"><a href="#cb26-659" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> point_preds[<span class="dv">3</span>,<span class="dv">2</span>], <span class="at">yend =</span> point_preds[<span class="dv">3</span>,<span class="dv">2</span>]),</span>
<span id="cb26-660"><a href="#cb26-660" aria-hidden="true" tabindex="-1"></a>                 <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb26-661"><a href="#cb26-661" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> point_preds[<span class="dv">4</span>,<span class="dv">1</span>], <span class="at">xend =</span> point_preds[<span class="dv">4</span>,<span class="dv">1</span>], </span>
<span id="cb26-662"><a href="#cb26-662" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> point_preds[<span class="dv">3</span>,<span class="dv">2</span>], <span class="at">yend =</span> point_preds[<span class="dv">4</span>,<span class="dv">2</span>]),</span>
<span id="cb26-663"><a href="#cb26-663" aria-hidden="true" tabindex="-1"></a>                 <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb26-664"><a href="#cb26-664" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>,</span>
<span id="cb26-665"><a href="#cb26-665" aria-hidden="true" tabindex="-1"></a>             <span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">percent</span>(point_preds[<span class="dv">4</span>,<span class="dv">2</span>]<span class="sc">-</span>point_preds[<span class="dv">3</span>,<span class="dv">2</span>]), <span class="st">" increment"</span>),</span>
<span id="cb26-666"><a href="#cb26-666" aria-hidden="true" tabindex="-1"></a>             <span class="at">x =</span> point_preds[<span class="dv">4</span>,<span class="dv">1</span>],</span>
<span id="cb26-667"><a href="#cb26-667" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> <span class="fu">mean</span>(<span class="fu">c</span>(point_preds[<span class="dv">4</span>,<span class="dv">2</span>], point_preds[<span class="dv">3</span>,<span class="dv">2</span>])), </span>
<span id="cb26-668"><a href="#cb26-668" aria-hidden="true" tabindex="-1"></a>             <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb26-669"><a href="#cb26-669" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, </span>
<span id="cb26-670"><a href="#cb26-670" aria-hidden="true" tabindex="-1"></a>             <span class="at">label =</span> <span class="st">"5 cm difference"</span>,</span>
<span id="cb26-671"><a href="#cb26-671" aria-hidden="true" tabindex="-1"></a>             <span class="at">x =</span> point_preds[<span class="dv">3</span>, <span class="dv">1</span>], </span>
<span id="cb26-672"><a href="#cb26-672" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> point_preds[<span class="dv">3</span>, <span class="dv">2</span>], </span>
<span id="cb26-673"><a href="#cb26-673" aria-hidden="true" tabindex="-1"></a>             <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>,</span>
<span id="cb26-674"><a href="#cb26-674" aria-hidden="true" tabindex="-1"></a>             <span class="at">vjust =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb26-675"><a href="#cb26-675" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Flipper length (mm)"</span>,</span>
<span id="cb26-676"><a href="#cb26-676" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"P(male)"</span>,</span>
<span id="cb26-677"><a href="#cb26-677" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> <span class="st">"&lt;span style = 'color:#003f5c;'&gt;Logistic curve&lt;/span&gt;,</span></span>
<span id="cb26-678"><a href="#cb26-678" aria-hidden="true" tabindex="-1"></a><span class="st">        &lt;span style = 'color:#ff6361;'&gt;intercept&lt;/span&gt;"</span>) <span class="sc">+</span></span>
<span id="cb26-679"><a href="#cb26-679" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">linetype =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb26-680"><a href="#cb26-680" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> percent, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.25</span>)) <span class="sc">+</span></span>
<span id="cb26-681"><a href="#cb26-681" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-682"><a href="#cb26-682" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(my_data, <span class="fu">aes</span>(flipper_length_mm, </span>
<span id="cb26-683"><a href="#cb26-683" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">logistic_derivative</span>(fit, <span class="st">"flipper_length_mm"</span>, <span class="at">value =</span> flipper_length_mm))) <span class="sc">+</span></span>
<span id="cb26-684"><a href="#cb26-684" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">colour =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb26-685"><a href="#cb26-685" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">colour =</span> <span class="st">"#ffa600"</span>) <span class="sc">+</span></span>
<span id="cb26-686"><a href="#cb26-686" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> flipper_length_mm[<span class="fu">which.max</span>(derivative)],</span>
<span id="cb26-687"><a href="#cb26-687" aria-hidden="true" tabindex="-1"></a>                     <span class="at">xend =</span> flipper_length_mm[<span class="fu">which.max</span>(derivative)],</span>
<span id="cb26-688"><a href="#cb26-688" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> <span class="fu">min</span>(derivative), <span class="at">yend =</span> <span class="fu">max</span>(derivative)),</span>
<span id="cb26-689"><a href="#cb26-689" aria-hidden="true" tabindex="-1"></a>                 <span class="at">colour =</span> <span class="st">"grey"</span>, <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span></span>
<span id="cb26-690"><a href="#cb26-690" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"label"</span>, <span class="at">label =</span> <span class="fu">paste0</span>(<span class="st">"Max = "</span>, <span class="fu">percent</span>(<span class="fu">max</span>(my_data<span class="sc">$</span>derivative))),</span>
<span id="cb26-691"><a href="#cb26-691" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">"#ffa600"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">label.size =</span> <span class="dv">0</span>,</span>
<span id="cb26-692"><a href="#cb26-692" aria-hidden="true" tabindex="-1"></a>             <span class="at">x =</span> my_data<span class="sc">$</span>flipper_length_mm[<span class="fu">which.max</span>(my_data<span class="sc">$</span>derivative)],</span>
<span id="cb26-693"><a href="#cb26-693" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> <span class="fu">max</span>(my_data<span class="sc">$</span>derivative)<span class="sc">*</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb26-694"><a href="#cb26-694" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Flipper length (mm)"</span>,</span>
<span id="cb26-695"><a href="#cb26-695" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Slope of flipper length  (probability scale)"</span>,</span>
<span id="cb26-696"><a href="#cb26-696" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> <span class="st">"&lt;span style = 'color:#ffa600;'&gt;Derivative&lt;/span&gt;"</span>) <span class="sc">+</span></span>
<span id="cb26-697"><a href="#cb26-697" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> percent) <span class="sc">+</span></span>
<span id="cb26-698"><a href="#cb26-698" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-699"><a href="#cb26-699" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_layout</span>() <span class="sc">&amp;</span></span>
<span id="cb26-700"><a href="#cb26-700" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">"A"</span>) <span class="sc">&amp;</span></span>
<span id="cb26-701"><a href="#cb26-701" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb26-702"><a href="#cb26-702" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title =</span> <span class="fu">element_markdown</span>())</span>
<span id="cb26-703"><a href="#cb26-703" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-704"><a href="#cb26-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-705"><a href="#cb26-705" aria-hidden="true" tabindex="-1"></a>The maximum change in the probability of being male is <span class="in">`r percent(max(my_data$derivative))`</span>, which occurs at around 190 mm flipper length. There is a smarter way of calculating the maximum slope of <span class="in">`flipper_length_mm`</span>. This value will always occur at the mid-point of the logistic curve, and it turns out that to find the derivative of the logistic function at the mid-point (i.e., for $x = x_0$), we only need to find $\beta /4$, where $\beta$ is the regression coefficient of our predictor of interest! This is called the divide-by-four-rule, and is a simple trick to report the coefficients of a logistic regression model in the scale of probabilities, and for meaningful values of the predictors (the value at which the slope is maximum). This way, we could just divide the regression coefficient of <span class="in">`flipper_length_mm`</span> by four to get the maximum probability difference of being male between two penguins with flipper lengths $x$ and $x + 1$.</span>
<span id="cb26-706"><a href="#cb26-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-707"><a href="#cb26-707" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb26-708"><a href="#cb26-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-709"><a href="#cb26-709" aria-hidden="true" tabindex="-1"></a><span class="fu">## The divide-by-four rule</span></span>
<span id="cb26-710"><a href="#cb26-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-711"><a href="#cb26-711" aria-hidden="true" tabindex="-1"></a>Dividing the coefficients of a logistic regression model (in the logit scale) gets us the maximum slope of the predictor in the probability scale. We mentioned that this has to do with the derivative of the logistic function at the mid-point.</span>
<span id="cb26-712"><a href="#cb26-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-713"><a href="#cb26-713" aria-hidden="true" tabindex="-1"></a>But since we dropped that term some equations ago after setting it at zero, it is no longer clear how one would derive the logistic function in such way that the divide-by-four rule holds. Let's go back to @eq-upper, when the mid-point still appeared in our equation. We derive this formula:</span>
<span id="cb26-714"><a href="#cb26-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-715"><a href="#cb26-715" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb26-716"><a href="#cb26-716" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb26-717"><a href="#cb26-717" aria-hidden="true" tabindex="-1"></a>\text{Logistic(x)} &amp;= \frac{1}{1 + e^{(-\beta \ · \ (x-x_0))}} &amp; \text{Logistic function}<span class="sc">\\</span></span>
<span id="cb26-718"><a href="#cb26-718" aria-hidden="true" tabindex="-1"></a>\text{Logistic'(x)} &amp;= \frac{\beta · e^{-\beta (x-x_0)}}{(1 + e^{-\beta (x-x_0)})^2} &amp; \text{Derivative}</span>
<span id="cb26-719"><a href="#cb26-719" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb26-720"><a href="#cb26-720" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb26-721"><a href="#cb26-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-722"><a href="#cb26-722" aria-hidden="true" tabindex="-1"></a>And since $x = x_0$, $x-x_0 = 0$. We can simplify the derivative now, knowing that $e^0 = 1$.</span>
<span id="cb26-723"><a href="#cb26-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-724"><a href="#cb26-724" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb26-725"><a href="#cb26-725" aria-hidden="true" tabindex="-1"></a>\text{Logistic'(x)} = \frac{\beta · e^0}{(1 + e^0)^2} = \frac{\beta}{(1 + 1)^2} = \frac{\beta}{4} </span>
<span id="cb26-726"><a href="#cb26-726" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb26-727"><a href="#cb26-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-728"><a href="#cb26-728" aria-hidden="true" tabindex="-1"></a>Take a look at the previously cited <span class="co">[</span><span class="ot">blog post by TJ Mahr</span><span class="co">](https://www.tjmahr.com/anatomy-of-a-logistic-growth-curve/)</span> for a derivation that also includes the asymptote term in the logistic function.</span>
<span id="cb26-729"><a href="#cb26-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-730"><a href="#cb26-730" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb26-731"><a href="#cb26-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-732"><a href="#cb26-732" aria-hidden="true" tabindex="-1"></a>Let's put the divide-by-four rule to test. The output of <span class="in">`logistic_derivative()`</span> that we defined before should, when solved for the mid-point of the logistic curve, return an equivalent value to $\beta_1 / 4$, where $\beta_1 = 0.1271495$, and therefore return something close to <span class="in">`r coef(fit)["flipper_length_mm"]/4`</span>. We don't know what value of <span class="in">`flipper_length_mm`</span> corresponds to the mid-point. In @fig-logistic-derivative we calculated it my finding the value of <span class="in">`flipper_length_mm`</span> for which <span class="in">`logistic_derivative()`</span> returned the maximum value:</span>
<span id="cb26-733"><a href="#cb26-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-736"><a href="#cb26-736" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-737"><a href="#cb26-737" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: manual-midpoint</span></span>
<span id="cb26-738"><a href="#cb26-738" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb26-739"><a href="#cb26-739" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb26-740"><a href="#cb26-740" aria-hidden="true" tabindex="-1"></a>derivative_values <span class="ot">&lt;-</span> <span class="fu">logistic_derivative</span>(fit, <span class="st">"flipper_length_mm"</span>, my_data<span class="sc">$</span>flipper_length_mm)</span>
<span id="cb26-741"><a href="#cb26-741" aria-hidden="true" tabindex="-1"></a>my_data<span class="sc">$</span>flipper_length_mm[<span class="fu">which.max</span>(derivative_values)]</span>
<span id="cb26-742"><a href="#cb26-742" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-743"><a href="#cb26-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-744"><a href="#cb26-744" aria-hidden="true" tabindex="-1"></a>From our data, we find that the maximum slope of <span class="in">`flipper_length_mm`</span> occurs at <span class="in">`r my_data$flipper_length_mm[which.max(derivative_values)]`</span>. But finding the mid-point this way requires us to have already calculated the derivative of the logistic function. There is an alternative way to compute this mid-point from the estimated coefficients of the regression model. An additional benefit of computing the mid-point this way is that we are doing so by relying on model-projections, and therefore in a way that does not entirely rely on the range of values of the predictor for which we have computed the derivative of the logistic function. This method consists of @eq-midpoint-coefs.</span>
<span id="cb26-745"><a href="#cb26-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-746"><a href="#cb26-746" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb26-747"><a href="#cb26-747" aria-hidden="true" tabindex="-1"></a>x_0 = -\beta_0 / \beta_1</span>
<span id="cb26-748"><a href="#cb26-748" aria-hidden="true" tabindex="-1"></a>$${#eq-midpoint-coefs}</span>
<span id="cb26-749"><a href="#cb26-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-750"><a href="#cb26-750" aria-hidden="true" tabindex="-1"></a>Where $\beta$ is the intercept of the regression model, and $\beta_1$ is the regression coefficient of the predictor we are calculating the mid-point for. We can implement this formula in R as:</span>
<span id="cb26-751"><a href="#cb26-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-754"><a href="#cb26-754" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-755"><a href="#cb26-755" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: mid-point-fun</span></span>
<span id="cb26-756"><a href="#cb26-756" aria-hidden="true" tabindex="-1"></a><span class="co">#| code-fold: false</span></span>
<span id="cb26-757"><a href="#cb26-757" aria-hidden="true" tabindex="-1"></a><span class="co"># get point in x at the inflection point (where y = 0.5)</span></span>
<span id="cb26-758"><a href="#cb26-758" aria-hidden="true" tabindex="-1"></a>get_mid <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb26-759"><a href="#cb26-759" aria-hidden="true" tabindex="-1"></a>    coefs <span class="ot">&lt;-</span> <span class="fu">coef</span>(x)[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb26-760"><a href="#cb26-760" aria-hidden="true" tabindex="-1"></a>    mid <span class="ot">&lt;-</span> <span class="fu">coef</span>(x)[<span class="dv">1</span>]<span class="sc">/-</span>coefs</span>
<span id="cb26-761"><a href="#cb26-761" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(mid)</span>
<span id="cb26-762"><a href="#cb26-762" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-763"><a href="#cb26-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-764"><a href="#cb26-764" aria-hidden="true" tabindex="-1"></a><span class="fu">get_mid</span>(fit)</span>
<span id="cb26-765"><a href="#cb26-765" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-766"><a href="#cb26-766" aria-hidden="true" tabindex="-1"></a>Using this function, we find that the mid-point is located at flipper length <span class="in">`r round(get_mid(fit), 4)`</span> mm, pretty close to what we had estimated from our data. This value can sometimes be extremely interesting!</span>
<span id="cb26-767"><a href="#cb26-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-768"><a href="#cb26-768" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb26-769"><a href="#cb26-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-770"><a href="#cb26-770" aria-hidden="true" tabindex="-1"></a><span class="fu">## A personal experience</span></span>
<span id="cb26-771"><a href="#cb26-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-772"><a href="#cb26-772" aria-hidden="true" tabindex="-1"></a>In my PhD, I investigated how the age at which toddlers and children learn particular words is affected by participant-level (e.g., age, amount of linguistic exposure) and word-level characteristics (e.g., word length, lexical frequency). I used logistic regression to model the probability of a given toddler having learnt a word, adjusting for my predictors of interest, the most important of them being the age of the child. Older children are more likely to have learnt a given word than younger children.</span>
<span id="cb26-773"><a href="#cb26-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-774"><a href="#cb26-774" aria-hidden="true" tabindex="-1"></a>My model returned, among others, a coefficient for <span class="in">`age`</span> in the logit scale, but I wasn't particularly interested in it, even after having transformed it to the probability scale. I was, however, more interested in finding the value of age at which most children were learning each word, which corresponded to the mid-point of the logistic curve for the age predictor!</span>
<span id="cb26-775"><a href="#cb26-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-776"><a href="#cb26-776" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb26-777"><a href="#cb26-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-778"><a href="#cb26-778" aria-hidden="true" tabindex="-1"></a>Now that we have calculated the mid-point of our logistic function, we can finally compare the **divide-by-four rule** against the actual value of the **derivative of the logistic function**. If we solve @eq-logistic-derivative for $x_0 = 190.0882$ using <span class="in">`logistic_derivative(fit, "flipper_length_mm", 190.0882)`</span>, we get that the mid-point is located at <span class="in">`r logistic_derivative(fit, "flipper_length_mm", 190.0882)`</span>. If we use the divide-by-four rule, we get <span class="in">`r coef(fit)["flipper_length_mm"] / 4`</span>. Exactly the same!</span>
<span id="cb26-779"><a href="#cb26-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-780"><a href="#cb26-780" aria-hidden="true" tabindex="-1"></a>So far, we have seen that the divide-by-four rule is a simple way to obtain the slope at the mid-point, which is a meaningful value: it tells us the upper limit of the distribution of the regression slope of the predictor. However, there might be other values of the predictor for which we might be interested in finding the slope of the coefficient. We might even want to compute the average of all slopes! These, an others, are different perspectives to adopt when thinking, computing, and reporting marginal effects.</span>
<span id="cb26-781"><a href="#cb26-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-782"><a href="#cb26-782" aria-hidden="true" tabindex="-1"></a>I cannot say anything that has not already been explained better by Andrew Heiss in his blog post: <span class="co">[</span><span class="ot">Marginalia: A guide to figuring out what the heck marginal effects, marginal slopes, average marginal effects, marginal effects at the mean, and all these other marginal things are</span><span class="co">](https://www.andrewheiss.com/blog/2022/05/20/marginalia/)</span> <span class="co">[</span><span class="ot">@heiss2022marginalia</span><span class="co">]</span>. I will only mention that to compute the marginal effects of your model, regardless of your strategy towards reporting marginal effects (maximum slope, average marginal effects, marginal effects at specific points), or the characteristics of your model (Gaussian vs. binomial, logit vs. probit, Bayesian vs. frequentist, etc.), the <span class="in">`marginaleffects`</span> R package will be useful. Take a look at its documentation and functions, and play with them.</span>
<span id="cb26-783"><a href="#cb26-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-784"><a href="#cb26-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-785"><a href="#cb26-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-786"><a href="#cb26-786" aria-hidden="true" tabindex="-1"></a><span class="fu"># Combining our findings</span></span>
<span id="cb26-787"><a href="#cb26-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-788"><a href="#cb26-788" aria-hidden="true" tabindex="-1"></a>We have learnt how logistic regression exploits the numerical properties of the **logit** function to use a simple linear regression model to model probabilities, or any other variable covering the  $[0, 1]$ interval. We have learnt that due to the **non-linear relationship between probabilities and logits**, we need to be careful when interpreting the outcome of the model. We have found that, depending on the value of the predictor for which we find the slope in the probability scale, we may find effects of different sizes, and that we can use the **divide-by-four** rule to report the maximum change in probabilities associated with any change in the predictor. We have also considered how to estimate the mid-point of the logistic curve, which is often interesting since it tells us the value of the predictor at which its effect is largert. We can express all those interesting values in the following graph:</span>
<span id="cb26-789"><a href="#cb26-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-792"><a href="#cb26-792" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb26-793"><a href="#cb26-793" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: predictions-natural-probability</span></span>
<span id="cb26-794"><a href="#cb26-794" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb26-795"><a href="#cb26-795" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb26-796"><a href="#cb26-796" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Intercept, mid-point, and derivative at mid-point of the logistic function, drawn with the parameters estimated by a logistic regression model on the {palmerpenguins} dataset."</span></span>
<span id="cb26-797"><a href="#cb26-797" aria-hidden="true" tabindex="-1"></a><span class="co"># get point in x at the intercept of a line with slope beta/4 that passes through 0.5</span></span>
<span id="cb26-798"><a href="#cb26-798" aria-hidden="true" tabindex="-1"></a><span class="co"># this function assumes that lower and upper bounds of the logistic curve are 0 and 1</span></span>
<span id="cb26-799"><a href="#cb26-799" aria-hidden="true" tabindex="-1"></a><span class="co"># under these conditions, 0.5 will always be the inflection point of the logistic curve</span></span>
<span id="cb26-800"><a href="#cb26-800" aria-hidden="true" tabindex="-1"></a>get_mid_intercept <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb26-801"><a href="#cb26-801" aria-hidden="true" tabindex="-1"></a>    mid <span class="ot">&lt;-</span> <span class="fu">get_mid</span>(x)</span>
<span id="cb26-802"><a href="#cb26-802" aria-hidden="true" tabindex="-1"></a>    slope <span class="ot">&lt;-</span> <span class="fu">coef</span>(x)[<span class="sc">-</span><span class="dv">1</span>]<span class="sc">/</span><span class="dv">4</span></span>
<span id="cb26-803"><a href="#cb26-803" aria-hidden="true" tabindex="-1"></a>    mid_intercept <span class="ot">&lt;-</span> (<span class="sc">-</span>slope<span class="sc">*</span>mid) <span class="sc">+</span> <span class="fl">0.5</span></span>
<span id="cb26-804"><a href="#cb26-804" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(mid_intercept)</span>
<span id="cb26-805"><a href="#cb26-805" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-806"><a href="#cb26-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-807"><a href="#cb26-807" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions of model with unstandardised age</span></span>
<span id="cb26-808"><a href="#cb26-808" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(my_data, <span class="fu">aes</span>(flipper_length_mm, sex_pred)) <span class="sc">+</span></span>
<span id="cb26-809"><a href="#cb26-809" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plot observations</span></span>
<span id="cb26-810"><a href="#cb26-810" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">as.numeric</span>(sex)<span class="sc">-</span><span class="dv">1</span>), </span>
<span id="cb26-811"><a href="#cb26-811" aria-hidden="true" tabindex="-1"></a>               <span class="at">shape =</span> <span class="dv">1</span>,</span>
<span id="cb26-812"><a href="#cb26-812" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="fl">1.5</span>,</span>
<span id="cb26-813"><a href="#cb26-813" aria-hidden="true" tabindex="-1"></a>               <span class="at">stroke =</span> <span class="dv">1</span>,</span>
<span id="cb26-814"><a href="#cb26-814" aria-hidden="true" tabindex="-1"></a>               <span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">height =</span> <span class="fl">0.1</span>),</span>
<span id="cb26-815"><a href="#cb26-815" aria-hidden="true" tabindex="-1"></a>               <span class="at">alpha =</span> <span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb26-816"><a href="#cb26-816" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.5</span>,</span>
<span id="cb26-817"><a href="#cb26-817" aria-hidden="true" tabindex="-1"></a>               <span class="at">colour =</span> <span class="st">"grey"</span>,</span>
<span id="cb26-818"><a href="#cb26-818" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span></span>
<span id="cb26-819"><a href="#cb26-819" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> flipper_length_mm, <span class="at">y =</span> sex_pred),</span>
<span id="cb26-820"><a href="#cb26-820" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> <span class="fl">1.5</span>,</span>
<span id="cb26-821"><a href="#cb26-821" aria-hidden="true" tabindex="-1"></a>              <span class="at">colour =</span> clrs[<span class="dv">1</span>]) <span class="sc">+</span></span>
<span id="cb26-822"><a href="#cb26-822" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plot intercept (y when x = 0)</span></span>
<span id="cb26-823"><a href="#cb26-823" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">plogis</span>(<span class="fu">coef</span>(fit)[<span class="st">"(Intercept)"</span>]),</span>
<span id="cb26-824"><a href="#cb26-824" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb26-825"><a href="#cb26-825" aria-hidden="true" tabindex="-1"></a>               <span class="at">colour =</span> clrs[<span class="dv">4</span>])  <span class="sc">+</span></span>
<span id="cb26-826"><a href="#cb26-826" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plot mid point (x when y = 0.5)</span></span>
<span id="cb26-827"><a href="#cb26-827" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">get_mid</span>(fit),</span>
<span id="cb26-828"><a href="#cb26-828" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb26-829"><a href="#cb26-829" aria-hidden="true" tabindex="-1"></a>               <span class="at">colour =</span> clrs[<span class="dv">2</span>]) <span class="sc">+</span></span>
<span id="cb26-830"><a href="#cb26-830" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plot slope when x = mid point (approximated derivative of the logistic curve)</span></span>
<span id="cb26-831"><a href="#cb26-831" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_abline</span>(</span>
<span id="cb26-832"><a href="#cb26-832" aria-hidden="true" tabindex="-1"></a>        <span class="at">slope =</span> <span class="fu">coef</span>(fit)[<span class="st">"flipper_length_mm"</span>] <span class="sc">/</span> <span class="dv">4</span>,</span>
<span id="cb26-833"><a href="#cb26-833" aria-hidden="true" tabindex="-1"></a>        <span class="at">intercept =</span> <span class="fu">get_mid_intercept</span>(fit),</span>
<span id="cb26-834"><a href="#cb26-834" aria-hidden="true" tabindex="-1"></a>        <span class="at">size =</span> <span class="fl">0.75</span>,</span>
<span id="cb26-835"><a href="#cb26-835" aria-hidden="true" tabindex="-1"></a>        <span class="at">colour =</span> clrs[<span class="dv">5</span>]</span>
<span id="cb26-836"><a href="#cb26-836" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb26-837"><a href="#cb26-837" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"label"</span>, <span class="at">label =</span> <span class="fu">percent</span>(<span class="fu">coef</span>(fit)[<span class="st">"flipper_length_mm"</span>] <span class="sc">/</span> <span class="dv">4</span>),</span>
<span id="cb26-838"><a href="#cb26-838" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">"#ffa600"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">label.size =</span> <span class="dv">0</span>,</span>
<span id="cb26-839"><a href="#cb26-839" aria-hidden="true" tabindex="-1"></a>             <span class="at">x =</span> <span class="fu">get_mid</span>(fit)<span class="sc">+</span><span class="dv">5</span>, <span class="at">y =</span> <span class="fl">0.5</span>, <span class="at">label.r =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">"lines"</span>)) <span class="sc">+</span></span>
<span id="cb26-840"><a href="#cb26-840" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"label"</span>, <span class="at">label =</span> <span class="fu">percent</span>(<span class="fu">plogis</span>(<span class="fu">coef</span>(fit)[<span class="st">"(Intercept)"</span>])),</span>
<span id="cb26-841"><a href="#cb26-841" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">"#ff6361"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">label.size =</span> <span class="dv">0</span>,</span>
<span id="cb26-842"><a href="#cb26-842" aria-hidden="true" tabindex="-1"></a>             <span class="at">x =</span> <span class="dv">200</span>, <span class="at">y =</span> <span class="fu">plogis</span>(<span class="fu">coef</span>(fit)[<span class="st">"(Intercept)"</span>])<span class="sc">+</span><span class="fl">0.1</span>,</span>
<span id="cb26-843"><a href="#cb26-843" aria-hidden="true" tabindex="-1"></a>             <span class="at">label.r =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">"lines"</span>)) <span class="sc">+</span></span>
<span id="cb26-844"><a href="#cb26-844" aria-hidden="true" tabindex="-1"></a>    <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"label"</span>, <span class="at">label =</span> <span class="fu">round</span>(<span class="fu">get_mid</span>(fit), <span class="dv">2</span>),</span>
<span id="cb26-845"><a href="#cb26-845" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="st">"#58508d"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">label.size =</span> <span class="dv">0</span>,</span>
<span id="cb26-846"><a href="#cb26-846" aria-hidden="true" tabindex="-1"></a>             <span class="at">x =</span> <span class="fu">get_mid</span>(fit)<span class="sc">-</span><span class="dv">1</span>, <span class="at">y =</span> <span class="fl">0.6</span>, <span class="at">hjust =</span> <span class="dv">1</span>,</span>
<span id="cb26-847"><a href="#cb26-847" aria-hidden="true" tabindex="-1"></a>             <span class="at">label.r =</span> <span class="fu">unit</span>(<span class="dv">0</span>, <span class="st">"lines"</span>)) <span class="sc">+</span></span>
<span id="cb26-848"><a href="#cb26-848" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Flipper length (mm)"</span>,</span>
<span id="cb26-849"><a href="#cb26-849" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Sex"</span>,</span>
<span id="cb26-850"><a href="#cb26-850" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> <span class="st">"&lt;span style = 'color:#003f5c;'&gt;Logistic curve&lt;/span&gt;,</span></span>
<span id="cb26-851"><a href="#cb26-851" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;span style = 'color:#ff6361;'&gt;intercept&lt;/span&gt;,</span></span>
<span id="cb26-852"><a href="#cb26-852" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;span style = 'color:#58508d;'&gt;mid-point&lt;/span&gt;,</span></span>
<span id="cb26-853"><a href="#cb26-853" aria-hidden="true" tabindex="-1"></a><span class="st">&lt;span style = 'color:#ffa600;'&gt;derivative at mid-point&lt;/span&gt;"</span>) <span class="sc">+</span></span>
<span id="cb26-854"><a href="#cb26-854" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">linetype =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb26-855"><a href="#cb26-855" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> percent, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.25</span>)) <span class="sc">+</span></span>
<span id="cb26-856"><a href="#cb26-856" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb26-857"><a href="#cb26-857" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title =</span> <span class="fu">element_markdown</span>())</span>
<span id="cb26-858"><a href="#cb26-858" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-859"><a href="#cb26-859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-860"><a href="#cb26-860" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-861"><a href="#cb26-861" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip collapse="true"}</span>
<span id="cb26-862"><a href="#cb26-862" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-863"><a href="#cb26-863" aria-hidden="true" tabindex="-1"></a><span class="fu">## Expand for Session Info</span></span>
<span id="cb26-864"><a href="#cb26-864" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-865"><a href="#cb26-865" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo = FALSE}</span></span>
<span id="cb26-866"><a href="#cb26-866" aria-hidden="true" tabindex="-1"></a><span class="co"># from https://themockup.blog/posts/2022-04-18-session-info/</span></span>
<span id="cb26-867"><a href="#cb26-867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-868"><a href="#cb26-868" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sessioninfo)</span>
<span id="cb26-869"><a href="#cb26-869" aria-hidden="true" tabindex="-1"></a><span class="co"># save the session info as an object</span></span>
<span id="cb26-870"><a href="#cb26-870" aria-hidden="true" tabindex="-1"></a>pkg_sesh <span class="ot">&lt;-</span> <span class="fu">session_info</span>(<span class="at">pkgs =</span> <span class="st">"attached"</span>)</span>
<span id="cb26-871"><a href="#cb26-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-872"><a href="#cb26-872" aria-hidden="true" tabindex="-1"></a><span class="co"># get the quarto version</span></span>
<span id="cb26-873"><a href="#cb26-873" aria-hidden="true" tabindex="-1"></a>quarto_version <span class="ot">&lt;-</span> <span class="fu">system</span>(<span class="st">"quarto --version"</span>, <span class="at">intern =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-874"><a href="#cb26-874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-875"><a href="#cb26-875" aria-hidden="true" tabindex="-1"></a><span class="co"># inject the quarto info</span></span>
<span id="cb26-876"><a href="#cb26-876" aria-hidden="true" tabindex="-1"></a>pkg_sesh<span class="sc">$</span>platform<span class="sc">$</span>quarto <span class="ot">&lt;-</span> <span class="fu">paste</span>(</span>
<span id="cb26-877"><a href="#cb26-877" aria-hidden="true" tabindex="-1"></a>    <span class="fu">system</span>(<span class="st">"quarto --version"</span>, <span class="at">intern =</span> <span class="cn">TRUE</span>), </span>
<span id="cb26-878"><a href="#cb26-878" aria-hidden="true" tabindex="-1"></a>    <span class="st">"@"</span>, </span>
<span id="cb26-879"><a href="#cb26-879" aria-hidden="true" tabindex="-1"></a>    quarto<span class="sc">::</span><span class="fu">quarto_path</span>()</span>
<span id="cb26-880"><a href="#cb26-880" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-881"><a href="#cb26-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-882"><a href="#cb26-882" aria-hidden="true" tabindex="-1"></a><span class="co"># print it out</span></span>
<span id="cb26-883"><a href="#cb26-883" aria-hidden="true" tabindex="-1"></a>pkg_sesh</span>
<span id="cb26-884"><a href="#cb26-884" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb26-885"><a href="#cb26-885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-886"><a href="#cb26-886" aria-hidden="true" tabindex="-1"></a>:::</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left"><span class="faux-block"><i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i> 2020–2023 Gonzalo Garcia-Castro</span> <span class="faux-block">All content licensed under<br><a href="https://creativecommons.org/licenses/by-sa/4.0/"><i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i> <i class="fa-brands fa-creative-commons-by" aria-label="creative-commons-by"></i> <i class="fa-brands fa-creative-commons-sa" aria-label="creative-commons-sa"></i> Creative Commons CC BY-SA 4.0</a></span><br></div>   
      <div class="nav-footer-center"><span class="faux-block"><i class="fa-brands fa-orcid" aria-label="orcid"></i> <strong>ORCID</strong> <a href="https://orcid.org/0000-0002-8553-4209">0000-0002-8553-4209</a></span></div>
    <div class="nav-footer-right"><span class="faux-block">Made with <i class="fa-brands fa-r-project" aria-label="r-project"></i> and <a href="https://quarto.org/">Quarto</a></span> <span class="faux-block"><a href="https://github.com/gongcastro/gongcastro.github.io">View the source at <i class="fa-brands fa-github" aria-label="github"></i> GitHub</a></span></div>
  </div>
</footer>


</body></html>