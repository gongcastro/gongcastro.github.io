<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="Gonzalo Garcia-Castro">
<meta name="description" content="A veces necesitamos instalar versiones diferentes del mismo paquete de R en proyectos diferentes. El paquete {renv} nos permite almacenar los paquetes de R de cada proyecto de forma independiente, evitando posibles conflictos entre proyectos. De paso, incrementar√° la reproducibilidad computacional de nuestro c√≥digo.
El problemaPonte en la siguiente situaci√≥n: tienes entre manos un proyecto de R que necesita varios paquetes. Cada uno de estos paquetes depende, a su vez, de terceros paquetes." />
<meta name="keywords" content=", r, reproducibility" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="#fcba03" />
<link rel="canonical" href="http://gongcastro.github.io/2022/02/27/renv/" />


    <title>
        
            renv (o c√≥mo usar paquetes de R sin ataques de p√°nico) :: Gonzalo Garc√≠a-Castro  ‚Äî Developmental sycholinguistics and R
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="/main.6fc0dda7eae4695eb0cc3ae224c0caa1661a01707aa87efdcae0334f7af73ef4.css">


    
        <link rel="stylesheet" type="text/css" href="/css/custom.css">
    





<meta itemprop="name" content="renv (o c√≥mo usar paquetes de R sin ataques de p√°nico)">
<meta itemprop="description" content="A veces necesitamos instalar versiones diferentes del mismo paquete de R en proyectos diferentes. El paquete {renv} nos permite almacenar los paquetes de R de cada proyecto de forma independiente, evitando posibles conflictos entre proyectos. De paso, incrementar√° la reproducibilidad computacional de nuestro c√≥digo.
El problemaPonte en la siguiente situaci√≥n: tienes entre manos un proyecto de R que necesita varios paquetes. Cada uno de estos paquetes depende, a su vez, de terceros paquetes.">
<meta itemprop="datePublished" content="2022-02-27T00:00:00+00:00" />
<meta itemprop="dateModified" content="2022-02-27T18:19:47+01:00" />
<meta itemprop="wordCount" content="1233">



<meta itemprop="keywords" content="r,reproducibility," />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="renv (o c√≥mo usar paquetes de R sin ataques de p√°nico)"/>
<meta name="twitter:description" content="A veces necesitamos instalar versiones diferentes del mismo paquete de R en proyectos diferentes. El paquete {renv} nos permite almacenar los paquetes de R de cada proyecto de forma independiente, evitando posibles conflictos entre proyectos. De paso, incrementar√° la reproducibilidad computacional de nuestro c√≥digo.
El problemaPonte en la siguiente situaci√≥n: tienes entre manos un proyecto de R que necesita varios paquetes. Cada uno de estos paquetes depende, a su vez, de terceros paquetes."/>






    <meta property="article:section" content="rstats" />

    <meta property="article:section" content="r" />



    <meta property="article:published_time" content="2022-02-27 00:00:00 &#43;0000 UTC" />










<link rel="stylesheet" href="http://gongcastro.github.io/css/github-dark.min.css" rel="stylesheet" id="theme-stylesheet">
<script src="http://gongcastro.github.io/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">$ cd /gongcastro/</span>
            <span class="logo__cursor" style=
                  "
                   background-color:lightsalmon;
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/post/">Posts</a></li><li><a href="/cv/">CV</a></li><li><a href="/about/">About</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="http://gongcastro.github.io/2022/02/27/renv/">renv (o c√≥mo usar paquetes de R sin ataques de p√°nico)</a></h2>

            
            
            

            <div class="post-content">
                
<script src="http://gongcastro.github.io/2022/02/27/renv/index_files/header-attrs/header-attrs.js"></script>


<p>A veces necesitamos instalar versiones diferentes del mismo paquete de R en proyectos diferentes. El paquete <strong>{renv}</strong> nos permite <strong>almacenar los paquetes de R de cada proyecto de forma independiente</strong>, evitando posibles conflictos entre proyectos. De paso, incrementar√° la <strong>reproducibilidad computacional</strong> de nuestro c√≥digo.</p>
<p><img src="/img/containers.jpg" /></p>
<div id="el-problema" class="section level1">
<h1>El problema</h1>
<p>Ponte en la siguiente situaci√≥n: tienes entre manos un proyecto de R que necesita varios paquetes. Cada uno de estos paquetes depende, a su vez, de terceros paquetes. De hecho, dos paquetes pueden depender del mismo paquete, o incluso de <strong>versiones diferentes</strong> del mismo paquete. Si hay mala suerte, una de las versiones no ser√° lo suficientemente reciente como para funcionar correctamente con ambos paquetes. Resultado: uno de los dos paquetes no funcionar√°.</p>
<div class="figure">
<img src="/img/panic.gif" alt="" />
<p class="caption">Usuarie de R promedio despu√©s de tirar dos horas a la basura intentando instalar los paquetes que necesita para trabajar en un proyecto de R que no tocaba desde hac√≠a cuatro meses.</p>
</div>
<p>Este problema se extiende al caso de que necesitemos versiones diferentes del mismo paquete en proyectos de R diferentes en los que estamos trabajando de forma simult√°nea en el mismo ordenador. Para hacerlos funcionar necesitar√≠amos instalar de nuevo la versi√≥n correspondiente del mismo paquete cada vez que cambiemos de proyecto.</p>
</div>
<div id="instalando-paquetes-de-r" class="section level1">
<h1>Instalando paquetes de R</h1>
<p>En resumidas cuentas, cada vez que instalamos o actualizamos un paquete de R, lo hacemos para todos nuestros proyectos de R de forma <em>global</em>. Esto se debe a que por defecto R busca todos los paquete de R en la misma carpeta. Para ver d√≥nde instala R tus paquetes puedes ejecutar el siguiente comando:</p>
<pre><code>.libPaths()</code></pre>
<p>Este comando te mostrar√° el directorio o <strong>directorios donde R instala sus paquetes por defecto</strong>. Si hay m√°s de un directorio significa que, en caso de que no sea posible encontrar un paquete en el primer directorio, R lo buscar√° en el segundo, tercero, etc., hasta que te devuelva un error indicando que no has instalado ese paquete.</p>
<p>Si accedes al primer directorio que muestra <code>.libPaths()</code> ver√°s que <strong>cada paquete tiene una carpeta</strong>. Cada carpeta incluye el c√≥digo de R, los datos y la documentaci√≥n asociada a cada paquete (entre otras cosas). Cada vez que instalamos o actualizamos un paquete, se crea o reemplaza su carpeta correspondiente en nuestro directorio, es decir, en nuestra ‚Äúbiblioteca global‚Äù de paquetes de R.</p>
<div class="figure">
<img src="/img/boxes.jpg" alt="" />
<p class="caption">As√≠ es como tienes tu carpeta de paquetes de R. Que lo s√© yo. Que te he visto. Verg√ºenza me dar√≠a a m√≠.</p>
</div>
<p>Hemos visto que esto no es ideal. ¬øNo ser√° mejor tener una carpeta diferente para cada proyecto en la que instalamos sus paquetes de forma independente, sin afectar a los paquetes de otros proyectos? S√≠. De hecho este procedimiento es est√°ndar en otros lenguajes de programaci√≥n como JavaScript<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> o Julia <a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>. Existe un paquete de R que nos permite hacer esto: <a href="https://github.com/rstudio/renv/"><strong>renv</strong></a>. Veamos c√≥mo funciona.</p>
<p><img src="https://www.youtube.com/watch?v=yjlEbIDevOs" /></p>
</div>
<div id="usando-renv" class="section level1">
<h1>Usando renv</h1>
<p>Primero hay que <strong>instalar renv</strong>. Como est√° incluido en el CRAN, podemos hacerlo usando <code>install.packages()</code>:</p>
<pre class="r"><code>install.packages(&quot;renv&quot;)</code></pre>
<p>Ahora abrimos una sesi√≥n de R en la carpeta de nuestro proyecto. Digamos que nuestra carpeta tiene la siguiente estructura:</p>
<pre><code>data
 |-some-data.csv
docs
 |-index.Rmd
 |-index.html
R
 |-main.R
 |-functions.R
.Rprofile</code></pre>
<p>As√≠ es la estructura de la mayor√≠a de carpetas de mis proyectos de R. Tiene su raz√≥n de ser, pero eso es material para otro post. Lo importante es c√≥mo cambiar√° esta estructura en unos momentos. La <a href="https://rstudio.github.io/renv/articles/renv.html">documentaci√≥n de renv</a> incluye los pasos para usar renv, pero explicar√© los principales. Primero inicializaremos renv en nuestra consola de R:</p>
<pre class="r"><code>renv::init()</code></pre>
<p>Esto crear√° una carpeta (<code>renv</code>) y un archivo (<code>renv.lock</code>) nuevos en nuestro directorio:</p>
<pre><code>.Rprofile
data
    |-some-data.csv
docs
    |-index.Rmd
    |-index.html
R
    |-main.R
    |-functions.R
renv
    |-.gitignore
    |-activate.R
    |-library
        |-...
    |-local
        |-...
    |-settings.dcf
renv.lock</code></pre>
<p>No necesitaremos modificar ni consultar nunca ningunos de los archivos creados, pero vamos a curiosear un poco. Al usar <code>init()</code>, renv ha echado un vistazo a los scripts de R de la carpeta (achivos con la extensi√≥n .R, como <code>main.R</code> y <code>functions.R</code>), y <strong>ha detectado los paquetes que necesita nuestro c√≥digo para ejecutarse</strong> (puedes consultar las dependencias de tu proyecto usando <code>renv::dependencies()</code>). Por ejemplo, si <code>main.R</code> incluye <code>library(dplyr)</code> o <code>dplyr::mutate()</code>, detectar√° el paquete dplyr como una dependencia.</p>
<div class="figure">
<img src="/img/detector.gif" alt="" />
<p class="caption">renv detectando tus dependencias.</p>
</div>
<p>A continuaci√≥n, renv ha <strong>instalado todas los paquetes necesarios</strong> en <code>renv/library/</code>. Si comparas esa carpeta con el directorio mostrado en <code>.libPaths()</code> (como hicimos hace un momento), ver√°s que ambas carpetas son muy parecidas. Eso es porque ahora R buscar√° los paquetes que necesites en esa carpeta, y no en la ‚Äúbiblioteca global‚Äù de paquetes de R. Esa es la magia de renv: podr√°s <strong>instalar y actualizar paquetes de R de forma independiente</strong> para cada uno de tus proyectos. Para instalar nuevos paquetes deber√°s hacerlo usando la funci√≥n <code>renv::install()</code>. Por ejemplo:</p>
<pre class="r"><code>renv::install(&quot;tidyr&quot;)</code></pre>
<p>Esta funci√≥n es el <strong>equivalente a <code>install.packages()</code></strong> en renv. esta funci√≥n asumir√° que el paquete que quieres se encuentra en CRAN y ser√° all√≠ donde lo buscar√°. Si el paquete que quieres instalar se encuentra alojado en otro sitio (o quieres instalar una versi√≥n experimental del mismo, en un repositorio de GitHub, por ejemplo), puedes indicar el repositorio de la siguiente forma:</p>
<pre class="r"><code>renv::install(&quot;crsh/papaja&quot;)</code></pre>
<p>Si echas un vistazo a <code>renv.lock</code> ver√°s que incluye una <strong>lista de todas las dependencias de tu proyecto</strong>, en un formato un poco raro, con muchos par√©ntesis, y la extensi√≥n <code>.lock</code>. No necesitas entender este archivo, s√≥lo que sigue un formato parecido al que usan otros leguajes de programaci√≥n para hacer lo mismo. Es el equivalente al archivo <code>package-lock.json</code> de un proyecto de JavaScript o al archivo <code>Manifest.toml</code> de un proyecto de Julia. Si te fijas, ver√°s que simplemente incluye <strong>informaci√≥n m√≠nima para cada paquete</strong>: nombre, versi√≥n, origen y un c√≥digo que lo identifica. Por ejemplo, el <code>renv.lock</code> de nuestro proyecto incluye lo siguiente:</p>
<pre class="json"><code>{
  &quot;R&quot;: {
    &quot;Version&quot;: &quot;4.0.4&quot;,
    &quot;Repositories&quot;: [
      {
        &quot;Name&quot;: &quot;CRAN&quot;,
        &quot;URL&quot;: &quot;https://cran.rstudio.com&quot;
      }
    ]
  },
  &quot;Packages&quot;: {
    &quot;dplyr&quot;: {
      &quot;Package&quot;: &quot;dplyr&quot;,
      &quot;Version&quot;: &quot;1.0.8&quot;,
      &quot;Source&quot;: &quot;Repository&quot;,
      &quot;Repository&quot;: &quot;CRAN&quot;,
      &quot;Hash&quot;: &quot;ef47665e64228a17609d6df877bf86f2&quot;
    },
    &quot;papaja&quot;: {
      &quot;Package&quot;: &quot;papaja&quot;,
      &quot;Version&quot;: &quot;0.1.0.9997&quot;,
      &quot;Source&quot;: &quot;GitHub&quot;,
      &quot;RemoteType&quot;: &quot;github&quot;,
      &quot;RemoteHost&quot;: &quot;api.github.com&quot;,
      &quot;RemoteUsername&quot;: &quot;crsh&quot;,
      &quot;RemoteRepo&quot;: &quot;papaja&quot;,
      &quot;RemoteRef&quot;: &quot;master&quot;,
      &quot;RemoteSha&quot;: &quot;a231c3628ccf24359cc17f11a5bbc743e3fed920&quot;,
      &quot;Remotes&quot;: &quot;tidymodels/broom&quot;,
      &quot;Hash&quot;: &quot;3df0637229690f807616c46d3ff77113&quot;
    },
    &quot;tidyr&quot;: {
      &quot;Package&quot;: &quot;tidyr&quot;,
      &quot;Version&quot;: &quot;1.2.0&quot;,
      &quot;Source&quot;: &quot;Repository&quot;,
      &quot;Repository&quot;: &quot;CRAN&quot;,
      &quot;Hash&quot;: &quot;d8b95b7fee945d7da6888cf7eb71a49c&quot;
    },
  }
}</code></pre>
<p>Una ventaja enorme de usar renv es que si descargas o copias y pegas esta carpeta en un ordenador diferente (en el que posiblemente tengas una colecci√≥n de paquetes diferente a la del ordenador donde trabajaste con el proyecto por √∫ltima vez), <strong>renv podr√° consultar este archivo para instalar por t√≠ los paquetes necesarios en sus versiones correspondientes</strong>. Esto se puede hacer usando el comando:</p>
<pre class="r"><code>renv::restore()</code></pre>
<p><strong><em>Importante</em></strong>: cuando instales nuevos paquetes usando <code>renv::install()</code>, el archivo <code>renv.lock</code> no se actualizar√° de forma autom√°tica. Para incluir los nuevos paquetes en este archivo, tendremos que usar el siguiente comando:</p>
<pre class="r"><code>renv::snapshot()</code></pre>
<p>Como podr√°s imaginar, poder instalar los paquetes que necesita un proyecto en su versi√≥n adecuada resuelve uno de los problemas m√°s frecuentes que amenazan la <strong>reproducibilidad computacional</strong> de nuestros proyectos.</p>
<div class="figure">
<img src="/img/happy.gif" alt="" />
<p class="caption">Imaginando un mundo donde todo el mundo se preocupa lo suficiente por la reproducibilidad computacional de sus proyectos.</p>
</div>
</div>
<div id="conclusiones" class="section level1">
<h1>Conclusiones</h1>
<p>Te recomiendo empezar a usar <strong>renv</strong> en alg√∫n proyecto ‚Äúde juguete‚Äù con el que puedas experimentar, e ir poco a poco incorporando esta rutina en tus proyectos por el bien de tu salud mental y de la de les dem√°s. üòÑ</p>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Echa un vistazo a este post de Nikola ƒêuza: <a href="https://blog.appsignal.com/2020/04/09/ride-down-the-javascript-dependency-hell.html">Ride Down Into JavaScript Dependency Hell</a><a href="#fnref1" class="footnote-back">‚Ü©Ô∏é</a></p></li>
<li id="fn2"><p>Echa un vistazo a este post de Bogumi≈Ç Kami≈Ñski: <a href="https://bkamins.github.io/julialang/2020/05/18/project-workflow.html">My practices for managing project dependencies in Julia</a><a href="#fnref2" class="footnote-back">‚Ü©Ô∏é</a></p></li>
</ol>
</div>

            </div>
        </article>

        <hr />

        <div class="post-info">
            
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>

        <span class="tag"><a href="http://gongcastro.github.io/tags/r/">r</a></span>
        <span class="tag"><a href="http://gongcastro.github.io/tags/reproducibility/">reproducibility</a></span>
        
    </p>

            
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path></svg>

        <span class="tag"><a href="http://gongcastro.github.io/categories/rstats/">rstats</a></span>
        <span class="tag"><a href="http://gongcastro.github.io/categories/r/">r</a></span>
        
    </p>

			    <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-git-commit"><circle cx="12" cy="12" r="4"></circle><line x1="1.05" y1="12" x2="7" y2="12"></line><line x1="17.01" y1="12" x2="22.96" y2="12"></line></svg><a href="7a40d292743cbef33d5f0ab8de2a73cac6068f7a" target="_blank" rel="noopener">7a40d29</a> @ 2022-02-27</p>
  		</div>
    </main>

            </div>

            
                <footer class="footer">
    
    
</footer>

            
        </div>

        



<script type="text/javascript" src="/bundle.min.ace63d93098bf623f7c286a9084a4c22bfc482944c734f87fe0b685c7c6c7fa0ad2edb028c3b4b60d3343720c8ab490b320ad7f8edf4f6e9a6b898fc529057a9.js" integrity="sha512-rOY9kwmL9iP3woapCEpMIr/EgpRMc0&#43;H/gtoXHxsf6CtLtsCjDtLYNM0NyDIq0kLMgrX&#43;O309ummuJj8UpBXqQ=="></script>





    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
    
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
            processEscapes: true,
            processEnvironments: true
        },
        // Center justify equations in code and markdown cells. Elsewhere
        // we use CSS to left justify single line equations in code cells.
        displayAlign: 'center',
        "HTML-CSS": {
            styles: {'.MathJax_Display': {"margin": 0}},
            linebreaks: { automatic: true }
        }
    });
    </script>
    
    </body>
</html>
